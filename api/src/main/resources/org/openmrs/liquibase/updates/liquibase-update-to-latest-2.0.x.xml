<?xml version="1.0" encoding="UTF-8"?>
<!--

    This Source Code Form is subject to the terms of the Mozilla Public License,
    v. 2.0. If a copy of the MPL was not distributed with this file, You can
    obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under
    the terms of the Healthcare Disclaimer located at http://openmrs.org/license.

    Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS
    graphic logo is a trademark of OpenMRS Inc.

-->
<!--
    This file contains all changesets that have been introduced on top of liquibase-snapshots/1.9.x/liquibase-*.xml.
-->
<databaseChangeLog 
	logicalFilePath="liquibase-update-to-latest.xml" 
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext 
    	http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
		http://www.liquibase.org/xml/ns/dbchangelog 
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

	<!-- 
		See http://www.liquibase.org/manual/home#available_database_refactorings 
		for a list of supported elements and attributes 
	-->

	<changeSet id="0" author="bwolfe">
		<preConditions onError="MARK_RAN" onFail="MARK_RAN">
			<sqlCheck expectedResult="The update-to-latest.sql file needs to be run on this db.">
				<![CDATA[
				SELECT case when REPLACE(property_value, '.', '0') >= REPLACE('1.4.0.20', '.', '0') then 'database_version greater than 1.4.0.20' else 'The update-to-latest.sql file needs to be run on this db.' end FROM global_property WHERE property = 'database_version';
				]]>
			</sqlCheck>
		</preConditions>
		<comment>Run the old sqldiff file to get database up to the 1.4.0.20 version if needed. (Requires 'mysql' to be on the PATH)</comment>
		<customChange class="org.openmrs.util.databasechange.SourceMySqldiffFile">
			<param name="sqlFile">update-to-1.4.2.01-db.mysqldiff.sql</param>
		</customChange>
	</changeSet>
	
	<changeSet id="1" author="upul" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="person_attribute_type" columnName="edit_privilege"/></not>
		</preConditions>
		<comment>
			Add the column to person_attribute type to connect each type to a privilege
		</comment>
		<addColumn tableName="person_attribute_type">
			<column name="edit_privilege" type="varchar(255)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="2" author="upul" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="privilege_which_can_edit"/></not>
		</preConditions>
		<comment>
			Create the foreign key from the privilege required for to edit
			a person attribute type and the privilege.privilege column
		</comment>
		<addForeignKeyConstraint constraintName="privilege_which_can_edit"
			baseTableName="person_attribute_type" baseColumnNames="edit_privilege"
			referencedTableName="privilege" referencedColumnNames="privilege"/>
	</changeSet>
	
	<changeSet id="200811261102" author="bwolfe" dbms="mysql">
		<comment>
			Fix field property for new Tribe person attribute
		</comment>
		<update tableName="field">
			<column name="default_value" value="$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}"/>
			<where>default_value='$!{patient.getTribe().getTribeId()}^$!{patient.getTribe().getName()}'</where>
		</update>
	</changeSet>
	
	<changeSet id="200805281223" author="bmckown" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="concept_complex"/></not>
		</preConditions>
		<comment>
			Create the concept_complex table
		</comment>
		<createTable tableName="concept_complex">
			<column name="concept_id" type="int">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="handler" type="varchar(255)"/>
		</createTable>
		
		<addForeignKeyConstraint constraintName="concept_attributes"
			baseTableName="concept_complex" baseColumnNames="concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id"/>		
	</changeSet>
	
	<changeSet id="200805281224" author="bmckown" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="obs" columnName="value_complex"/></not>
		</preConditions>
		<comment>
			Adding the value_complex column to obs.  This may take a long time if you have a large number of observations.
		</comment>
		<addColumn tableName="obs">
			<column name="value_complex" type="varchar(255)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="200805281225" author="bmckown" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				<![CDATA[
				SELECT count(*) FROM concept_datatype where name='Complex';
				]]>
			</sqlCheck>
		</preConditions>
		<comment>
			Adding a 'complex' Concept Datatype
		</comment>
		<insert tableName="concept_datatype">
			<column name="name" value="Complex"/>
			<column name="hl7_abbreviation" value="ED"/>
			<column name="description" value="Complex value.  Analogous to HL7 Embedded Datatype"/>
			<column name="creator" valueNumeric="1"/>
			<column name="date_created" valueDate="2008-05-28T12:25:34" />
		</insert>
	</changeSet>
	
	<changeSet id="200805281226" author="bmckown" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="complex_obs"/>
		</preConditions>
		<comment>
			Dropping the mimetype and complex_obs tables as they aren't needed in the new complex obs setup
		</comment>
		<dropTable tableName="complex_obs"/>
		<dropTable tableName="mime_type"/>
	</changeSet>
	
	<changeSet id="200809191226" author="smbugua" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="hl7_in_archive" columnName="message_state"/></not>
		</preConditions>
		<comment>
			Adding the hl7 archive message_state column so that archives can be tracked
			(preCondition database_version check in place because this change was in the old format in trunk for a while)
		</comment>
		<addColumn tableName="hl7_in_archive">
			<column name="message_state" type="int(1)" defaultValueNumeric="0" remarks="2=processed, 4=deleted" />
		</addColumn>
	</changeSet>

	<changeSet id="200809191927" author="smbugua" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="hl7_in_queue" columnName="message_state"/></not>
		</preConditions>
		<comment>
			Adding the hl7 archive message_state column so that archives can be tracked
		</comment>
		<renameColumn tableName="hl7_in_queue" oldColumnName="state" newColumnName="message_state" columnDataType="int(1)"/>
		<ext:modifyColumn tableName="hl7_in_queue">
			<column name="message_state" type="int(1)" defaultValueNumeric="0" remarks="0=pending, 1=processing, 2=processed, 3=error">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200901101524" author="Knoll_Frank" dbms="mysql">
		<comment>
			Changing datatype of drug.retire_reason from DATETIME to varchar(255)
		</comment>
		<ext:modifyColumn tableName="drug">
		    <column name="retire_reason" type="varchar(255)"/>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200901130950" author="bwolfe" dbms="mysql">
		<comment>
			Remove Manage Tribes and View Tribes privileges from all roles
		</comment>
		<delete tableName="role_privilege">
			<where>privilege='Manage Tribes' and not exists (select * from privilege where privilege = 'Manage Tribes')</where>
		</delete>
		<delete tableName="role_privilege">
			<where>privilege='View Tribes' and not exists (select * from privilege where privilege = 'View Tribes')</where>
		</delete>
	</changeSet>
	
	<changeSet id="200901130951" author="bwolfe" dbms="mysql">
		<comment>
			Remove Manage Mime Types, View Mime Types, and Purge Mime Types privilege
		</comment>
		<delete tableName="role_privilege">
			<where>privilege in ('Manage Mime Types', 'View Mime Types', 'Purge Mime Types')</where>
		</delete>
		<delete tableName="privilege">
			<where>privilege in ('Manage Mime Types', 'View Mime Types', 'Purge Mime Types')</where>
		</delete>
	</changeSet>
	
	<changeSet id="200901161126" author="bwolfe" dbms="mysql">
		<comment>
			Removed the database_version global property
		</comment>
		<delete tableName="global_property">
			<where>property = 'database_version'</where>
		</delete>
	</changeSet>
	
	<changeSet id="20090121-0949" author="bwolfe" dbms="mysql">
		<comment>
			Switched the default xslt to use PV1-19 instead of PV1-1
		</comment>
		<!-- using the <sql> tag instead of the <update> tag here so that xml syntax highlighting doesn't bog down editors -->
		<sql splitStatements="false">
			<![CDATA[
				UPDATE form
				SET xslt = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>'
				WHERE xslt LIKE '%\r\n@version 1.9.6\r\n%';
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="20090122-0853" author="bwolfe" dbms="mysql">
		<preConditions onFail="CONTINUE">
			<not><dbms type="hsql" /></not> <!-- skip over this changeset in unit tests -->
		</preConditions>
		<comment>
			Remove duplicate concept name tags
		</comment>
		<sql>
			UPDATE 
				concept_name_tag_map map 
			SET 
				concept_name_tag_id = (SELECT 
										 min(concept_name_tag_id)
									   FROM concept_name_tag
									   WHERE 
									     tag = (select tag from concept_name_tag where concept_name_tag_id = map.concept_name_tag_id)
									  );
		</sql>
		<!-- Copy the concept_name_map_ids to a new table -->
		<addLookupTable
			existingTableName="concept_name_tag" existingColumnName="concept_name_tag_id"
			newTableName="tmp_concept_name_tag_duplicates" newColumnName="concept_name_tag_id" 
			newColumnDataType="int" constraintName="concept_name_tag_ids_dupes"/>
		
		<dropForeignKeyConstraint
			constraintName="concept_name_tag_ids_dupes"
			baseTableName="concept_name_tag"/>
		
		<!-- Leave only ids that have duplicates in the table -->
		<delete tableName="tmp_concept_name_tag_duplicates">
			<where>concept_name_tag_id not in (select concept_name_tag_id from concept_name_tag where tag in (select tag from concept_name_tag group by tag having count(*) > 1))</where>
		</delete>
		
		<!-- Now delete all  -->
		<delete tableName="concept_name_tag">
			<where>
				concept_name_tag_id in (select concept_name_tag_id from tmp_concept_name_tag_duplicates)
				and
				concept_name_tag_id not in (select distinct(concept_name_tag_id) from concept_name_tag_map)
			</where>
		</delete>
		<dropTable tableName="tmp_concept_name_tag_duplicates" />
	</changeSet>
	
	<changeSet id="20090123-0305" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="concept_name_tag_unique_tags" />
			</not>
		</preConditions>
		<comment>
			Add unique constraint to the tags table
		</comment>
		<addUniqueConstraint tableName="concept_name_tag" columnNames="tag" constraintName="concept_name_tag_unique_tags"/>
	</changeSet>
	
	<changeSet id="20090224-1229" author="Keelhaul+bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="location_tag"/></not>
		</preConditions>
		<comment>
			Add location tags table
		</comment>
		<createTable tableName="location_tag">
			<column name="location_tag_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(255)" defaultValue="null"/>
			<column name="creator" type="int(11)" >
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime" >
				<constraints nullable="false"/>
			</column>
			<column name="retired" type="tinyint" defaultValueNumeric="0">
				<constraints nullable="false"/>
			</column>
			<column name="retired_by" type="int(11)" />
			<column name="date_retired" type="datetime" />
			<column name="retired_reason" type="varchar(255)" defaultValue="null"/>
		</createTable>
		<addForeignKeyConstraint constraintName="location_tag_creator"
			baseTableName="location_tag" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="location_tag_retired_by"
			baseTableName="location_tag" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id"/>
	</changeSet>
	
	<changeSet id="20090224-1250" author="Keelhaul+bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="location_tag_map"/></not>
		</preConditions>
		<comment>
			Add location tag map table
		</comment>
		<createTable tableName="location_tag_map">
			<column name="location_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="location_tag_id" type="int">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="location_tag_map_location"
			baseTableName="location_tag_map" baseColumnNames="location_id"
			referencedTableName="location" referencedColumnNames="location_id"/>
	    <addForeignKeyConstraint constraintName="location_tag_map_tag"
			baseTableName="location_tag_map" baseColumnNames="location_tag_id"
			referencedTableName="location_tag" referencedColumnNames="location_tag_id"/>
		<addPrimaryKey tableName="location_tag_map"
			columnNames="location_id,location_tag_id"
			constraintName="key_for_location_tag_map"/>
	</changeSet>
	
	<changeSet id="20090224-1256" author="Keelhaul+bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="location" columnName="parent_location"/></not>
		</preConditions>
		<comment>
			Add parent_location column to location table
		</comment>
		<addColumn tableName="location">
			<column name="parent_location" type="int(11)" />
		</addColumn>
		<addForeignKeyConstraint constraintName="parent_location"
			baseTableName="location" baseColumnNames="parent_location"
			referencedTableName="location" referencedColumnNames="location_id"/>
	</changeSet>
	
	<changeSet id="20090225-1551" author="dthomas" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location_tag" columnName="name"/>
		</preConditions>
		<comment>
			Change location_tag.name to location_tag.tag and location_tag.retired_reason to location_tag.retire_reason
		</comment>
		<renameColumn tableName="location_tag"
   			 oldColumnName="name" newColumnName="tag" columnDataType="varchar(50)"/>
		<renameColumn tableName="location_tag"
   			 oldColumnName="retired_reason" newColumnName="retire_reason" columnDataType="varchar(255)"/>
	</changeSet>

	<changeSet id="02232009-1141" author="nribeka" dbms="mysql">
		<comment>
			Modify the password column to fit the output of SHA-512 function
		</comment>
		<ext:modifyColumn tableName="users">
			<column name="password" type="varchar(128)"/>
			<column name="salt" type="varchar(128)"/>
		</ext:modifyColumn>
	</changeSet>	
	
	<changeSet id="20090301-1259" author="bwolfe" dbms="mysql">
		<comment>
			Fixes the description for name layout global property
		</comment>
		<update tableName="global_property">
			<column name="description" value="Format in which to display the person names.  Valid values are short, long"/>
			<where>property='layout.name.format'</where>
		</update>
		<update tableName="global_property">
			<column name="property_value" value="short"/>
			<where>property='layout.name.format' and property_value='Format in which to display the person names.  Valid values are short, long'</where>
		</update>
	</changeSet>
	
	<changeSet id="20090214-2246" author="isherman" dbms="mysql">
		<comment>
			Add weight and cd4 to patientGraphConcepts user property (mysql specific)
		</comment>
		<sql>
			UPDATE user_property
				SET property_value = CONCAT(
					'-', 
					(SELECT property_value FROM global_property WHERE property = 'concept.weight'),
					'-',
					(SELECT property_value FROM global_property WHERE property = 'concept.cd4_count'),
					property_value
				) WHERE property = 'patientGraphConcepts';			
		</sql>
	</changeSet>
	
	<changeSet id="20090214-2247" author="isherman">
		<validCheckSum><comment>Fixing sql extra bracket</comment>3:e4eeb4a09c2ab695bbde832cd7b6047d</validCheckSum>
		<validCheckSum>3:27ccd45178be533e880f88abbae24c2d</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<or>
				<dbms type="postgresql" />
				<dbms type="oracle" />
				<dbms type="db2" />
				<dbms type="mssql" />
			</or>
		</preConditions>
		<comment>
			Add weight and cd4 to patientGraphConcepts user property (using standard sql)
		</comment>
		<sql>
			UPDATE user_property
				SET property_value = 
					'-' || 
					(SELECT property_value FROM global_property WHERE property = 'concept.weight') ||
					'-' ||
					(SELECT property_value FROM global_property WHERE property = 'concept.cd4_count') ||
					property_value
				WHERE property = 'patientGraphConcepts';
		</sql>
		<modifySql dbms="mssql">
			<replace replace="||" with="+"/>
		</modifySql>
	</changeSet>
	
	<changeSet id="20090316-1008" author="vanand" dbms="mysql">
		<validCheckSum>cf32d07af2933e9a3555395737b5142</validCheckSum><!-- old checksum before adding in person.birthdate_estimated cleanup -->
		<validCheckSum>fcdde237e04473db1e6fd16f56bf80e9</validCheckSum><!-- new checksum after adding in person.birthdate_estimated cleanup -->
		<comment>
			Change column types of all boolean columns to smallint. The columns used to be either tinyint(4) or MySQL's BIT.
			(This may take a while on large patient or obs tables)
		</comment>
		<ext:modifyColumn tableName="cohort">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="is_set" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_class">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_datatype">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_name">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_name_tag">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_numeric">
			<column name="precise" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<update tableName="concept_source">
			<column name="voided" value="0" />
			<where>voided is null</where>
		</update>
		<ext:modifyColumn tableName="concept_source">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="drug">
			<column name="combination" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="drug_order">
			<column name="prn" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="complex" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="encounter">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="encounter_type">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="field">
			<column name="select_multiple" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="field_type">
			<column name="is_set" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="form">
			<column name="published" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>		
		<ext:modifyColumn tableName="form_field">
			<column name="required" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>		
		<ext:modifyColumn tableName="location_tag">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>		
		<ext:modifyColumn tableName="obs">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>		
		<ext:modifyColumn tableName="order_type">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="orders">
			<column name="discontinued" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient_identifier">
			<column name="preferred" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient_identifier_type">
			<column name="check_digit" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="required" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient_program">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient_state">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<update tableName="person">
			<column name="birthdate_estimated" value="0" />
			<where>birthdate_estimated is null</where>
		</update>
		<ext:modifyColumn tableName="person">
			<column name="birthdate_estimated" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="dead" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="person_address">
			<column name="preferred" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="person_attribute">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="person_attribute_type">
			<column name="searchable" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="person_name">
			<column name="preferred" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="program">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="program_workflow">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="program_workflow_state">
			<column name="initial" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="terminal" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="relationship">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="report_object">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="users">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200903210905" author="mseaton" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="serialized_object"/></not>
		</preConditions>
		<comment>
			Add a table to enable generic storage of serialized objects
		</comment>		
		<createTable tableName="serialized_object">
			<column name="serialized_object_id" type="int" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>			
			<column name="name" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(5000)"/>
			<column name="type" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="subtype" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="serialization_class" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="serialized_data" type="text">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column name="creator" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="date_changed" type="DATETIME" />
			<column name="changed_by" type="int"/>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false"/>
			</column>
			<column name="date_retired" type="DATETIME"/>
			<column name="retired_by" type="int"/>
			<column name="retire_reason" type="varchar(1000)"/>
		</createTable>
		<addForeignKeyConstraint constraintName="serialized_object_creator" 
					baseTableName="serialized_object" baseColumnNames="creator"
					referencedTableName="users" referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="serialized_object_changed_by" 
					baseTableName="serialized_object" baseColumnNames="changed_by"
					referencedTableName="users" referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="serialized_object_retired_by" 
					baseTableName="serialized_object" baseColumnNames="retired_by"
					referencedTableName="users" referencedColumnNames="user_id"/>
	</changeSet>
	<changeSet id="200903210905-fix" author="sunbiz" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="serialized_object"/>
		</preConditions>
		<comment>(Fixed)Add a table to enable generic storage of serialized objects</comment>		
		<ext:modifyColumn tableName="serialized_object">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200904091023" author="bwolfe" dbms="mysql">
		<comment>
			Remove Manage Tribes and View Tribes privileges from the privilege table and role_privilege table.
			The privileges will be recreated by the Tribe module if it is installed.
		</comment>
		<delete tableName="role_privilege">
			<where>privilege='Manage Tribes'</where>
		</delete>
		
		<delete tableName="role_privilege">
			<where>privilege='View Tribes'</where>
		</delete>
		
		<delete tableName="privilege">
			<where>privilege='Manage Tribes'</where>
		</delete>
		
		<delete tableName="privilege">
			<where>privilege='View Tribes'</where>
		</delete>
	</changeSet>
	
	<changeSet author="Cory McCarthy" id="20090408-1298" dbms="mysql">
		<comment>Changed the datatype for encounter_type to 'text' instead of just 50 chars</comment>
		<ext:modifyColumn tableName="encounter_type">
			<column name="description" type="text" />
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200905150814" author="bwolfe" dbms="mysql">
		<comment>Deleting invalid concept words</comment>
		<delete tableName="concept_word">
			<where>concept_name_id = 0</where>
		</delete>
	</changeSet>
	
	<changeSet id="200905071626" author="bwolfe" failOnError="false" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="concept_word_concept_idx"/>
			</not>
		</preConditions>
		<comment>
			Add an index to the concept_word.concept_id column (This update may fail if it already exists)
		</comment>
		<createIndex tableName="concept_word" indexName="concept_word_concept_idx">
			<column name="concept_id" />
		</createIndex>
	</changeSet>
	
	<changeSet id="20090402-1515-38-cohort" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="cohort" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to cohort table</comment>
		<addColumn tableName="cohort">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept table</comment>
		<addColumn tableName="concept">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_answer" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_answer" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_answer table</comment>
		<addColumn tableName="concept_answer">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_class" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_class" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_class table</comment>
		<addColumn tableName="concept_class">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_datatype" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_datatype" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_datatype table</comment>
		<addColumn tableName="concept_datatype">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_description" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_description" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_description table</comment>
		<addColumn tableName="concept_description">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_map" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_map" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_map table</comment>
		<addColumn tableName="concept_map">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_name" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_name" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_name table</comment>
		<addColumn tableName="concept_name">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_name_tag" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_name_tag" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_name_tag table</comment>
		<addColumn tableName="concept_name_tag">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_proposal" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_proposal" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_proposal table</comment>
		<addColumn tableName="concept_proposal">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_set" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_set" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_set table</comment>
		<addColumn tableName="concept_set">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_source" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_source" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_source table</comment>
		<addColumn tableName="concept_source">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_state_conversion" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_state_conversion" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_state_conversion table</comment>
		<addColumn tableName="concept_state_conversion">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-drug" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="drug" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to drug table</comment>
		<addColumn tableName="drug">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-encounter" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="encounter" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to encounter table</comment>
		<addColumn tableName="encounter">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-encounter_type" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="encounter_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to encounter_type table</comment>
		<addColumn tableName="encounter_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-field" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="field" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to field table</comment>
		<addColumn tableName="field">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-field_answer" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="field_answer" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to field_answer table</comment>
		<addColumn tableName="field_answer">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-field_type" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="field_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to field_type table</comment>
		<addColumn tableName="field_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-form" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="form" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to form table</comment>
		<addColumn tableName="form">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-form_field" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="form_field" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to form_field table</comment>
		<addColumn tableName="form_field">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-global_property" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="global_property" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to global_property table</comment>
		<addColumn tableName="global_property">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-hl7_in_archive" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="hl7_in_archive" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to hl7_in_archive table</comment>
		<addColumn tableName="hl7_in_archive">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-hl7_in_error" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="hl7_in_error" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to hl7_in_error table</comment>
		<addColumn tableName="hl7_in_error">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-hl7_in_queue" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="hl7_in_queue" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to hl7_in_queue table</comment>
		<addColumn tableName="hl7_in_queue">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-hl7_source" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="hl7_source" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to hl7_source table</comment>
		<addColumn tableName="hl7_source">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-location" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="location" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to location table</comment>
		<addColumn tableName="location">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-location_tag" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="location_tag" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to location_tag table</comment>
		<addColumn tableName="location_tag">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-note" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="note" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to note table</comment>
		<addColumn tableName="note">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-notification_alert" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="notification_alert" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to notification_alert table</comment>
		<addColumn tableName="notification_alert">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-notification_template" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="notification_template" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to notification_template table</comment>
		<addColumn tableName="notification_template">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-obs" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="obs" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to obs table</comment>
		<addColumn tableName="obs">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-order_type" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="order_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to order_type table</comment>
		<addColumn tableName="order_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-orders" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="orders" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to orders table</comment>
		<addColumn tableName="orders">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-patient_identifier" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_identifier" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to patient_identifier table</comment>
		<addColumn tableName="patient_identifier">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-patient_identifier_type" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_identifier_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to patient_identifier_type table</comment>
		<addColumn tableName="patient_identifier_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-patient_program" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_program" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to patient_program table</comment>
		<addColumn tableName="patient_program">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-patient_state" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_state" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to patient_state table</comment>
		<addColumn tableName="patient_state">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person table</comment>
		<addColumn tableName="person">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person_address" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_address" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person_address table</comment>
		<addColumn tableName="person_address">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person_attribute" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_attribute" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person_attribute table</comment>
		<addColumn tableName="person_attribute">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person_attribute_type" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_attribute_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person_attribute_type table</comment>
		<addColumn tableName="person_attribute_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person_name" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_name" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person_name table</comment>
		<addColumn tableName="person_name">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-privilege" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="privilege" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to privilege table</comment>
		<addColumn tableName="privilege">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-program" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="program" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to program table</comment>
		<addColumn tableName="program">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-program_workflow" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="program_workflow" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to program_workflow table</comment>
		<addColumn tableName="program_workflow">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-program_workflow_state" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="program_workflow_state" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to program_workflow_state table</comment>
		<addColumn tableName="program_workflow_state">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-relationship" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="relationship" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to relationship table</comment>
		<addColumn tableName="relationship">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-relationship_type" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="relationship_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-report_object" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="report_object" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to report_object table</comment>
		<addColumn tableName="report_object">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-report_schema_xml" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="report_schema_xml" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to report_schema_xml table</comment>
		<addColumn tableName="report_schema_xml">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-role" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="role" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to role table</comment>
		<addColumn tableName="role">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-serialized_object" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="serialized_object" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to serialized_object table</comment>
		<addColumn tableName="serialized_object">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>

	<changeSet id="20090402-1516-cohort" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in cohort table via built in uuid function.</comment>
		<update tableName="cohort" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept table via built in uuid function.</comment>
		<update tableName="concept" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_answer table via built in uuid function.</comment>
		<update tableName="concept_answer" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_class" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_class table via built in uuid function.</comment>
		<update tableName="concept_class" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_datatype" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_datatype table via built in uuid function.</comment>
		<update tableName="concept_datatype" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_description" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_description table via built in uuid function.</comment>
		<update tableName="concept_description" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_map" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_map table via built in uuid function.</comment>
		<update tableName="concept_map" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_name table via built in uuid function.</comment>
		<update tableName="concept_name" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_name_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_name_tag table via built in uuid function.</comment>
		<update tableName="concept_name_tag" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_proposal" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_proposal table via built in uuid function.</comment>
		<update tableName="concept_proposal" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_set" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_set table via built in uuid function.</comment>
		<update tableName="concept_set" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_source table via built in uuid function.</comment>
		<update tableName="concept_source" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_state_conversion" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_state_conversion table via built in uuid function.</comment>
		<update tableName="concept_state_conversion" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-drug" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in drug table via built in uuid function.</comment>
		<update tableName="drug" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-encounter" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in encounter table via built in uuid function.</comment>
		<update tableName="encounter" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-encounter_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in encounter_type table via built in uuid function.</comment>
		<update tableName="encounter_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in field table via built in uuid function.</comment>
		<update tableName="field" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-field_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in field_answer table via built in uuid function.</comment>
		<update tableName="field_answer" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-field_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in field_type table via built in uuid function.</comment>
		<update tableName="field_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-form" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in form table via built in uuid function.</comment>
		<update tableName="form" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-form_field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in form_field table via built in uuid function.</comment>
		<update tableName="form_field" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-global_property" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in global_property table via built in uuid function.</comment>
		<update tableName="global_property" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-hl7_in_archive" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in hl7_in_archive table via built in uuid function.</comment>
		<update tableName="hl7_in_archive" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-hl7_in_error" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in hl7_in_error table via built in uuid function.</comment>
		<update tableName="hl7_in_error" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-hl7_in_queue" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in hl7_in_queue table via built in uuid function.</comment>
		<update tableName="hl7_in_queue" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-hl7_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in hl7_source table via built in uuid function.</comment>
		<update tableName="hl7_source" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-location" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in location table via built in uuid function.</comment>
		<update tableName="location" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-location_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in location_tag table via built in uuid function.</comment>
		<update tableName="location_tag" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-note" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in note table via built in uuid function.</comment>
		<update tableName="note" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-notification_alert" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in notification_alert table via built in uuid function.</comment>
		<update tableName="notification_alert" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-notification_template" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in notification_template table via built in uuid function.</comment>
		<update tableName="notification_template" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-obs" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in obs table via built in uuid function.</comment>
		<update tableName="obs" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-order_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in order_type table via built in uuid function.</comment>
		<update tableName="order_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-orders" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in orders table via built in uuid function.</comment>
		<update tableName="orders" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-patient_identifier" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in patient_identifier table via built in uuid function.</comment>
		<update tableName="patient_identifier" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-patient_identifier_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in patient_identifier_type table via built in uuid function.</comment>
		<update tableName="patient_identifier_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-patient_program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in patient_program table via built in uuid function.</comment>
		<update tableName="patient_program" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-patient_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in patient_state table via built in uuid function.</comment>
		<update tableName="patient_state" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person table via built in uuid function.</comment>
		<update tableName="person" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person_address" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person_address table via built in uuid function.</comment>
		<update tableName="person_address" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person_attribute" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person_attribute table via built in uuid function.</comment>
		<update tableName="person_attribute" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person_attribute_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person_attribute_type table via built in uuid function.</comment>
		<update tableName="person_attribute_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person_name table via built in uuid function.</comment>
		<update tableName="person_name" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-privilege" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in privilege table via built in uuid function.</comment>
		<update tableName="privilege" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in program table via built in uuid function.</comment>
		<update tableName="program" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-program_workflow" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in program_workflow table via built in uuid function.</comment>
		<update tableName="program_workflow" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-program_workflow_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in program_workflow_state table via built in uuid function.</comment>
		<update tableName="program_workflow_state" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-relationship" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in relationship table via built in uuid function.</comment>
		<update tableName="relationship" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-relationship_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in relationship_type table via built in uuid function.</comment>
		<update tableName="relationship_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-report_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in report_object table via built in uuid function.</comment>
		<update tableName="report_object" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-report_schema_xml" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in report_schema_xml table via built in uuid function.</comment>
		<update tableName="report_schema_xml" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-role" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in role table via built in uuid function.</comment>
		<update tableName="role" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-serialized_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in serialized_object table via built in uuid function.</comment>
		<update tableName="serialized_object" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>

	<changeSet id="20090414-0804" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="is_a" />
		</preConditions>
		<comment>Dropping foreign key on concept_set.concept_id table</comment>
		<dropForeignKeyConstraint baseTableName="concept_set" constraintName="is_a" />
	</changeSet>
	
	<changeSet id="20090414-0805" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_set" columnName="concept_set_id"/></not>
		</preConditions>
		<comment>Dropping primary key on concept set table</comment>
		<dropPrimaryKey tableName="concept_set" />
	</changeSet>
	
	<changeSet id="20090414-0806" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_set" columnName="concept_set_id"/></not>
		</preConditions>
		<comment>Adding new integer primary key to concept set table</comment>
		<addColumn tableName="concept_set">
			<column name="concept_set_id" type="int(11)" autoIncrement="true">
				<constraints nullable="false" primaryKey="true" primaryKeyName="concept_set_pk" 
							 unique="true" uniqueConstraintName="concept_set_id_unique" />
			</column>
		</addColumn>
		<modifySql dbms="mysql">
			<append value=" FIRST" />
		</modifySql>
	</changeSet>

	<changeSet id="20090414-0807" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="idx_concept_set_concept"/></not>
		</preConditions>
		<comment>Adding index and foreign key to concept_set.concept_id column</comment>
		<createIndex tableName="concept_set" indexName="idx_concept_set_concept">
			<column name="concept_id"/>
		</createIndex>
		<addForeignKeyConstraint baseTableName="concept_set" baseColumnNames="concept_id" constraintName="is_a" referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>

	<changeSet id="20090414-0808a" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="identifies_patient" />
		</preConditions>
		<comment>Dropping foreign key on patient_identifier.patient_id column</comment>
		<dropForeignKeyConstraint baseTableName="patient_identifier" constraintName="identifies_patient" />
	</changeSet>
	
	<changeSet id="20090414-0808b" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="patient_identifier" columnName="patient_identifier_id"/></not>
		</preConditions>
		<comment>Dropping non-integer primary key on patient identifier table before adding a new integer primary key</comment> 
		<dropPrimaryKey tableName="patient_identifier" />
	</changeSet>

	<changeSet id="20090414-0809" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="patient_identifier" columnName="patient_identifier_id"/></not>
		</preConditions>
		<comment>Adding new integer primary key to patient identifier table</comment>
		<addColumn tableName="patient_identifier">
			<column name="patient_identifier_id" type="int(11)" autoIncrement="true">
				<constraints nullable="false" primaryKey="true" primaryKeyName="patient_identifier_pk" 
							 unique="true" uniqueConstraintName="patient_identifier_id_unique" />
			</column>
		</addColumn>
		<modifySql dbms="mysql">
			<append value=" FIRST" />
		</modifySql>
	</changeSet>

	<changeSet id="20090414-0810" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="idx_patient_identifier_patient"/></not>
		</preConditions>
		<comment>Adding index and foreign key on patient_identifier.patient_id column</comment>
		<createIndex tableName="patient_identifier" indexName="idx_patient_identifier_patient">
			<column name="patient_id"/>
		</createIndex>
		<addForeignKeyConstraint baseTableName="patient_identifier" baseColumnNames="patient_id" constraintName="identifies_patient" referencedTableName="patient" referencedColumnNames="patient_id" />
	</changeSet>

	<changeSet id="20090402-1517" author="bwolfe">
		<validCheckSum>1b6141be59a8a243b9e56d0aad952af</validCheckSum> <!-- checksum from before idExceptions added -->
		<validCheckSum>89cc7a14b0582f157ea2dbb9de092fd</validCheckSum> <!-- current checksum with idExceptions param added -->
		<validCheckSum><comment>Changes to new concept_reference tables</comment>3:4edd135921eb263d4811cf1c22ef4846</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<not>
				<or>
					<dbms type="mysql" />
					<dbms type="oracle" />
					<dbms type="mssql" />
				</or>
			</not>
		</preConditions>
		<comment>
			Adding UUIDs to all rows in all columns via a java class. (This will take a long time on large databases)
		</comment>
		<customChange class="org.openmrs.util.databasechange.GenerateUuid">
			<param name="tableNames">
				cohort concept concept_answer concept_class concept_datatype concept_description 
				concept_reference_map concept_name concept_name_tag concept_proposal
				concept_set concept_reference_source concept_state_conversion drug
				encounter encounter_type field field_answer field_type form form_field global_property hl7_in_archive 
				hl7_in_error hl7_in_queue hl7_source location location_tag note notification_alert 
				notification_template obs order_type orders patient_identifier 
				patient_identifier_type patient_program patient_state person person_address person_attribute 
				person_attribute_type person_name privilege program program_workflow program_workflow_state relationship 
				relationship_type report_object report_schema_xml role serialized_object
			</param>
			<param name="columnName" value="uuid"/>
			<param name="idExceptions">
				field_answer_id=field_id|role_id=role|privilege_id=privilege|global_property_id=property|notification_alert_id=alert_id
				|notification_template_id=template_id|orders_id=order_id|report_schema_xml_id=report_schema_id|concept_reference_map_id=concept_map_id
				|concept_reference_source_id=concept_source_id
			</param>
		</customChange>
	</changeSet>
	
	<changeSet id="20090402-1518" author="bwolfe">
		<validCheckSum>64e353f08027fb48155b5be8a69cfca</validCheckSum> <!-- Checksum when datatype was "uuid" -->
		<validCheckSum>dfaf705d7776613e619dedf3e06d7640</validCheckSum><!-- New checksum when datatype is "char(38)" -->
		<preConditions onFail="MARK_RAN">
                    <and>
                        <not><dbms type="mssql" /></not>
                        <tableExists tableName="concept_map"/> <!--TODO-->
                    </and>
		</preConditions>
		<comment>
			Now that UUID generation is done, set the uuid columns to not "NOT NULL" 
		</comment>
		
		<addNotNullConstraint tableName="cohort" columnName="uuid" columnDataType="char(38)"/>
		<addNotNullConstraint tableName="concept" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_answer" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_class" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_datatype" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_description" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_map" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_name" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_name_tag" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_proposal" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_set" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_source" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_state_conversion" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="drug" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="encounter" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="encounter_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="field" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="field_answer" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="field_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="form" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="form_field" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="global_property" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_in_archive" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_in_error" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_in_queue" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_source" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="location" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="location_tag" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="note" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="notification_alert" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="notification_template" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="obs" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="order_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="orders" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_identifier" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_identifier_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_program" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_state" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_address" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_attribute" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_attribute_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_name" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="privilege" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="program" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="program_workflow" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="program_workflow_state" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="relationship_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="report_object" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="report_schema_xml" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="role" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="serialized_object" columnName="uuid" columnDataType="char(38)" />
	</changeSet>

	
	<changeSet id="20090402-1519-cohort" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="cohort_uuid_index"/></not></preConditions>
		<comment>Creating unique index on cohort.uuid column</comment>
		<createIndex tableName="cohort" unique="true" indexName="cohort_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept.uuid column</comment>
		<createIndex tableName="concept" unique="true" indexName="concept_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_answer_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_answer.uuid column</comment>
		<createIndex tableName="concept_answer" unique="true" indexName="concept_answer_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_class" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_class_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_class.uuid column</comment>
		<createIndex tableName="concept_class" unique="true" indexName="concept_class_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_datatype" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_datatype_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_datatype.uuid column</comment>
		<createIndex tableName="concept_datatype" unique="true" indexName="concept_datatype_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_description" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_description_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_description.uuid column</comment>
		<createIndex tableName="concept_description" unique="true" indexName="concept_description_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_map" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_map_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_map.uuid column</comment>
		<createIndex tableName="concept_map" unique="true" indexName="concept_map_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_name_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_name.uuid column</comment>
		<createIndex tableName="concept_name" unique="true" indexName="concept_name_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_name_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_name_tag_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_name_tag.uuid column</comment>
		<createIndex tableName="concept_name_tag" unique="true" indexName="concept_name_tag_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_proposal" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_proposal_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_proposal.uuid column</comment>
		<createIndex tableName="concept_proposal" unique="true" indexName="concept_proposal_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_set" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_set_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_set.uuid column</comment>
		<createIndex tableName="concept_set" unique="true" indexName="concept_set_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_source_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_source.uuid column</comment>
		<createIndex tableName="concept_source" unique="true" indexName="concept_source_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_state_conversion" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_state_conversion_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_state_conversion.uuid column</comment>
		<createIndex tableName="concept_state_conversion" unique="true" indexName="concept_state_conversion_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-drug" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="drug_uuid_index"/></not></preConditions>
		<comment>Creating unique index on drug.uuid column</comment>
		<createIndex tableName="drug" unique="true" indexName="drug_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-encounter" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="encounter_uuid_index"/></not></preConditions>
		<comment>Creating unique index on encounter.uuid column</comment>
		<createIndex tableName="encounter" unique="true" indexName="encounter_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-encounter_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="encounter_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on encounter_type.uuid column</comment>
		<createIndex tableName="encounter_type" unique="true" indexName="encounter_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="field_uuid_index"/></not></preConditions>
		<comment>Creating unique index on field.uuid column</comment>
		<createIndex tableName="field" unique="true" indexName="field_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-field_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="field_answer_uuid_index"/></not></preConditions>
		<comment>Creating unique index on field_answer.uuid column</comment>
		<createIndex tableName="field_answer" unique="true" indexName="field_answer_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-field_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="field_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on field_type.uuid column</comment>
		<createIndex tableName="field_type" unique="true" indexName="field_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-form" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="form_uuid_index"/></not></preConditions>
		<comment>Creating unique index on form.uuid column</comment>
		<createIndex tableName="form" unique="true" indexName="form_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-form_field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="form_field_uuid_index"/></not></preConditions>
		<comment>Creating unique index on form_field.uuid column</comment>
		<createIndex tableName="form_field" unique="true" indexName="form_field_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-global_property" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="global_property_uuid_index"/></not></preConditions>
		<comment>Creating unique index on global_property.uuid column</comment>
		<createIndex tableName="global_property" unique="true" indexName="global_property_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-hl7_in_archive" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="hl7_in_archive_uuid_index"/></not></preConditions>
		<comment>Creating unique index on hl7_in_archive.uuid column</comment>
		<createIndex tableName="hl7_in_archive" unique="true" indexName="hl7_in_archive_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-hl7_in_error" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="hl7_in_error_uuid_index"/></not></preConditions>
		<comment>Creating unique index on hl7_in_error.uuid column</comment>
		<createIndex tableName="hl7_in_error" unique="true" indexName="hl7_in_error_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-hl7_in_queue" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="hl7_in_queue_uuid_index"/></not></preConditions>
		<comment>Creating unique index on hl7_in_queue.uuid column</comment>
		<createIndex tableName="hl7_in_queue" unique="true" indexName="hl7_in_queue_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-hl7_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="hl7_source_uuid_index"/></not></preConditions>
		<comment>Creating unique index on hl7_source.uuid column</comment>
		<createIndex tableName="hl7_source" unique="true" indexName="hl7_source_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-location" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="location_uuid_index"/></not></preConditions>
		<comment>Creating unique index on location.uuid column</comment>
		<createIndex tableName="location" unique="true" indexName="location_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-location_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="location_tag_uuid_index"/></not></preConditions>
		<comment>Creating unique index on location_tag.uuid column</comment>
		<createIndex tableName="location_tag" unique="true" indexName="location_tag_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-note" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="note_uuid_index"/></not></preConditions>
		<comment>Creating unique index on note.uuid column</comment>
		<createIndex tableName="note" unique="true" indexName="note_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-notification_alert" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="notification_alert_uuid_index"/></not></preConditions>
		<comment>Creating unique index on notification_alert.uuid column</comment>
		<createIndex tableName="notification_alert" unique="true" indexName="notification_alert_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-notification_template" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="notification_template_uuid_index"/></not></preConditions>
		<comment>Creating unique index on notification_template.uuid column</comment>
		<createIndex tableName="notification_template" unique="true" indexName="notification_template_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-obs" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="obs_uuid_index"/></not></preConditions>
		<comment>Creating unique index on obs.uuid column</comment>
		<createIndex tableName="obs" unique="true" indexName="obs_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-order_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="order_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on order_type.uuid column</comment>
		<createIndex tableName="order_type" unique="true" indexName="order_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-orders" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="orders_uuid_index"/></not></preConditions>
		<comment>Creating unique index on orders.uuid column</comment>
		<createIndex tableName="orders" unique="true" indexName="orders_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-patient_identifier" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="patient_identifier_uuid_index"/></not></preConditions>
		<comment>Creating unique index on patient_identifier.uuid column</comment>
		<createIndex tableName="patient_identifier" unique="true" indexName="patient_identifier_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-patient_identifier_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="patient_identifier_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on patient_identifier_type.uuid column</comment>
		<createIndex tableName="patient_identifier_type" unique="true" indexName="patient_identifier_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-patient_program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="patient_program_uuid_index"/></not></preConditions>
		<comment>Creating unique index on patient_program.uuid column</comment>
		<createIndex tableName="patient_program" unique="true" indexName="patient_program_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-patient_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="patient_state_uuid_index"/></not></preConditions>
		<comment>Creating unique index on patient_state.uuid column</comment>
		<createIndex tableName="patient_state" unique="true" indexName="patient_state_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person.uuid column</comment>
		<createIndex tableName="person" unique="true" indexName="person_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person_address" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_address_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person_address.uuid column</comment>
		<createIndex tableName="person_address" unique="true" indexName="person_address_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person_attribute" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_attribute_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person_attribute.uuid column</comment>
		<createIndex tableName="person_attribute" unique="true" indexName="person_attribute_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person_attribute_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_attribute_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person_attribute_type.uuid column</comment>
		<createIndex tableName="person_attribute_type" unique="true" indexName="person_attribute_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_name_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person_name.uuid column</comment>
		<createIndex tableName="person_name" unique="true" indexName="person_name_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-privilege" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="privilege_uuid_index"/></not></preConditions>
		<comment>Creating unique index on privilege.uuid column</comment>
		<createIndex tableName="privilege" unique="true" indexName="privilege_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="program_uuid_index"/></not></preConditions>
		<comment>Creating unique index on program.uuid column</comment>
		<createIndex tableName="program" unique="true" indexName="program_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-program_workflow" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="program_workflow_uuid_index"/></not></preConditions>
		<comment>Creating unique index on program_workflow.uuid column</comment>
		<createIndex tableName="program_workflow" unique="true" indexName="program_workflow_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-program_workflow_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="program_workflow_state_uuid_index"/></not></preConditions>
		<comment>Creating unique index on program_workflow_state.uuid column</comment>
		<createIndex tableName="program_workflow_state" unique="true" indexName="program_workflow_state_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-relationship" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="relationship_uuid_index"/></not></preConditions>
		<comment>Creating unique index on relationship.uuid column</comment>
		<createIndex tableName="relationship" unique="true" indexName="relationship_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-relationship_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="relationship_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on relationship_type.uuid column</comment>
		<createIndex tableName="relationship_type" unique="true" indexName="relationship_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-report_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="report_object_uuid_index"/></not></preConditions>
		<comment>Creating unique index on report_object.uuid column</comment>
		<createIndex tableName="report_object" unique="true" indexName="report_object_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-report_schema_xml" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="report_schema_xml_uuid_index"/></not></preConditions>
		<comment>Creating unique index on report_schema_xml.uuid column</comment>
		<createIndex tableName="report_schema_xml" unique="true" indexName="report_schema_xml_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-role" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="role_uuid_index"/></not></preConditions>
		<comment>Creating unique index on role.uuid column</comment>
		<createIndex tableName="role" unique="true" indexName="role_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-serialized_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="serialized_object_uuid_index"/></not></preConditions>
		<comment>Creating unique index on serialized_object.uuid column</comment>
		<createIndex tableName="serialized_object" unique="true" indexName="serialized_object_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	
	<changeSet id="20090414-0811a" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="word_for" />
		</preConditions>
		<comment>Dropping foreign key on concept_word.concept_id column</comment>
		<dropForeignKeyConstraint baseTableName="concept_word" constraintName="word_for" />
	</changeSet>
	
	<changeSet id="20090428-0811aa" author="bwolfe" failOnError="false" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_word" columnName="concept_word_id" /></not>
		</preConditions>
		<comment>Removing concept_word.concept_name_id foreign key so that primary key can be changed to concept_word_id</comment>
		<dropForeignKeyConstraint baseTableName="concept_word" constraintName="word_for_name" />
	</changeSet>
	
	<changeSet id="20090414-0811b" author="bwolfe" failOnError="false" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_word" columnName="concept_word_id" /></not>
		</preConditions>
		<comment>Dropping non-integer primary key on concept word table before adding new integer one</comment>
		<dropPrimaryKey tableName="concept_word" />
	</changeSet>
	
	<changeSet id="20090414-0812" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_word" columnName="concept_word_id" /></not>
		</preConditions>
		<comment>Adding integer primary key to concept word table</comment>
		<addColumn tableName="concept_word">
			<column name="concept_word_id" type="int(11)" autoIncrement="true">
				<constraints nullable="false" primaryKey="true" primaryKeyName="concept_word_pk" 
							 unique="true" uniqueConstraintName="concept_word_id_unique" />
			</column>
		</addColumn>
		<modifySql dbms="mysql">
			<append value=" FIRST" />
		</modifySql>
	</changeSet>
	
	<changeSet id="20090414-0812b" author="bwolfe" failOnError="false" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="word_for_name"/></not>
		</preConditions>
		<comment>Re-adding foreign key for concept_word.concept_name_id</comment>
		<addForeignKeyConstraint baseTableName="concept_word" baseColumnNames="concept_name_id" constraintName="word_for_name" referencedTableName="concept_name" referencedColumnNames="concept_name_id"/>
	</changeSet>
	
	<changeSet id="20090428-0854" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="word_for"/>
			</not>
		</preConditions>
		<comment>Adding foreign key for concept_word.concept_id column</comment>
		<addForeignKeyConstraint baseTableName="concept_word" baseColumnNames="concept_id" constraintName="word_for" referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>
	
	<changeSet id="200905150821" author="bwolfe" dbms="mysql">
		<comment>Deleting duplicate concept word keys</comment>
		<sql>delete from concept_word
             where
               concept_word_id not in (
                              select 
                                concept_word_id
                              from (select
                                      min(concept_word_id) as concept_word_id
                                    from
                                      concept_word 
                                    group by
                                      concept_id, word, locale
                                   ) as tmp_concept_word_dupes
                              )
              <!-- complicated sql needed to get around deleting from a table and doing a select from it -->
		</sql>
	</changeSet>
	
	<changeSet id="200904271042" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><columnExists tableName="concept_word" columnName="synonym"/></preConditions>
		<comment>Remove the now unused synonym column</comment>
		<dropColumn tableName="concept_word" columnName="synonym"/>
	</changeSet>
	
	<changeSet id="200902142212" author="ewolodzko" dbms="mysql">
                <preConditions onFail="MARK_RAN"><not><columnExists tableName="person_attribute_type" columnName="sort_weight"/></not></preConditions>
		<comment>
			Add a sortWeight field to PersonAttributeType
		</comment>
		<addColumn tableName="person_attribute_type">
			<column name="sort_weight" type="int" />
		</addColumn>
	</changeSet>
	
	<changeSet id="200902142213" author="ewolodzko" dbms="mysql">
		<validCheckSum>3:ace82a1ecb3a0c3246e39f0bebe38423</validCheckSum> <!-- original checksum -->
		<validCheckSum>3:288804e42d575fe62c852ed9daa9d59d</validCheckSum> <!-- current checksum with TRUNK-4025 fix-->
		<comment>
			Add default sortWeights to all current PersonAttributeTypes
		</comment>
		<sql>
			<![CDATA[
			UPDATE  person_attribute_type as A JOIN person_attribute_type as B ON A.name = B.name  SET A.sort_weight = (select count(*) from (select * from person_attribute_type) pat where pat.name < A.name) WHERE A.sort_weight is null;
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="200906301606" author="bwolfe" dbms="mysql">
		<comment>
			Change person_attribute_type.sort_weight from an integer to a float
		</comment>
		<ext:modifyColumn tableName="person_attribute_type" >
			<column name="sort_weight" type="double" />
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-1" author="bwolfe" dbms="mysql">
		<comment>Change obs.value_numeric from a double(22,0) to a double</comment>
		<ext:modifyColumn tableName="obs"><column name="value_numeric" type="double" /></ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-2" author="bwolfe" dbms="mysql">
		<comment>Change concept_numeric columns from a double(22,0) type to a double</comment>
		<ext:modifyColumn tableName="concept_numeric">
			<column name="hi_absolute" type="double" />
			<column name="hi_critical" type="double" />
			<column name="hi_normal" type="double" />
			<column name="low_normal" type="double" />
			<column name="low_critical" type="double" />
			<column name="low_absolute" type="double" />
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-3" author="bwolfe" dbms="mysql">
		<comment>Change concept_set.sort_weight from a double(22,0) to a double</comment>
		<ext:modifyColumn tableName="concept_set"><column name="sort_weight" type="double" /></ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-4" author="bwolfe" dbms="mysql">
		<comment>Change concept_set_derived.sort_weight from a double(22,0) to a double</comment>
		<ext:modifyColumn tableName="concept_set_derived"><column name="sort_weight" type="double" /></ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-5" author="bwolfe" dbms="mysql">
		<comment>Change drug table columns from a double(22,0) to a double</comment>
		<ext:modifyColumn tableName="drug" >
			<column name="dose_strength" type="double" />
			<column name="maximum_daily_dose" type="double" />
			<column name="minimum_daily_dose" type="double" />
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-6" author="bwolfe" dbms="mysql">
		<comment>Change drug_order.dose from a double(22,0) to a double</comment>
		<ext:modifyColumn tableName="drug_order">
			<column name="dose" type="double" />
			<column name="equivalent_daily_dose" type="double" />
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20100128-1" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				SELECT COUNT(*) FROM role where role = 'System Developer'
			</sqlCheck>
		</preConditions>
		<comment>Adding 'System Developer' role again (see ticket #1499)</comment>
		<insert tableName="role">
			<column name="role" value="System Developer"/>
			<column name="description" value="Assigned to Administrators of OpenMRS. Gives additional access to change core aspects of the system."/>
			<column name="uuid" valueNumeric="name-of-uuid-function"/>
		</insert>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql><replace replace="name-of-uuid-function" with="current_timestamp * 99999999999999"/></modifySql>
	</changeSet>	
	
	<changeSet id="20100128-2" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<changeSetExecuted id="20090803-1" author="jkariuki" changeLogFile="liquibase-update-to-latest.xml"/>
		</preConditions>
		<comment>Switching users back from 'Administrator' to 'System Developer' (see ticket #1499)</comment>
		<update tableName="user_role">
			<column name="role" value="System Developer"/>
			<where>role='Administrator'</where>
		</update>
	</changeSet>
	
	<changeSet id="20100128-3" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<changeSetExecuted id="20090803-1" author="jkariuki" changeLogFile="liquibase-update-to-latest.xml"/>
		</preConditions>
		<comment>Deleting 'Administrator' role (see ticket #1499)</comment>
		<delete tableName="role">
			<where>role='Administrator'</where>
		</delete>
	</changeSet>
	    
	<changeSet id="20090831-1039-38-scheduler_task_config" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="scheduler_task_config" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to scheduler_task_config table</comment>
		<addColumn tableName="scheduler_task_config">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="20090831-1040-scheduler_task_config" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in scheduler_task_config table via built in uuid function.</comment>
		<update tableName="scheduler_task_config" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>
	
	<changeSet id="20090831-1041-scheduler_task_config" author="bwolfe">
		<validCheckSum><comment>Fixed missing id from scheduler_task_config</comment>3:25127273b2d501664ce325922b0c7db2</validCheckSum>
		<validCheckSum>3:0db7f5c882500d1fac41550a1184073c</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<not>
				<or>
					<dbms type="mysql" />
					<dbms type="oracle" />
					<dbms type="mssql" />
				</or>
			</not>
		</preConditions>
		<comment>
			Adding UUIDs to all rows in scheduler_task_config table via a java class for non mysql/oracle/mssql databases.
		</comment>
		<customChange class="org.openmrs.util.databasechange.GenerateUuid">
			<param name="tableNames">
				scheduler_task_config
			</param>
			<param name="columnName" value="uuid"/>
			<param name="idExceptions">
				scheduler_task_config_id=task_config_id
			</param>
		</customChange>
	</changeSet>
	
	<changeSet id="20090831-1042-scheduler_task_config" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><dbms type="mssql" /></not></preConditions>
		<comment>
			Now that UUID generation is done for scheduler_task_config, set the uuid column to not "NOT NULL" 
		</comment>
		<addNotNullConstraint tableName="scheduler_task_config" columnName="uuid" columnDataType="char(38)"/>
	</changeSet>
	
	<changeSet id="20090831-1043-scheduler_task_config" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="scheduler_task_config_uuid_index"/></not></preConditions>
		<comment>Creating unique index on scheduler_task_config.uuid column</comment>
		<createIndex tableName="scheduler_task_config" unique="true" indexName="scheduler_task_config_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	
	<changeSet id="20090907-1" author="Knoll_Frank" dbms="mysql">
		<preConditions onFail="MARK_RAN"><columnExists tableName="concept_source" columnName="date_voided"/></preConditions>
		<comment>Rename the concept_source.date_voided column to date_retired</comment>
		<renameColumn tableName="concept_source" oldColumnName="date_voided" newColumnName="date_retired" columnDataType="datetime" />
	</changeSet>
	<changeSet id="20090907-2a" author="Knoll_Frank" dbms="mysql">
		<preConditions onFail="MARK_RAN"><foreignKeyConstraintExists foreignKeyName="user_who_voided_concept_source"/></preConditions>
		<comment>Remove the concept_source.voided_by foreign key constraint</comment>	
		<dropForeignKeyConstraint baseTableName="concept_source" constraintName="user_who_voided_concept_source" />
	</changeSet>
	<changeSet id="20090907-2b" author="Knoll_Frank" dbms="mysql">
		<preConditions onFail="MARK_RAN"><columnExists tableName="concept_source" columnName="voided_by"/></preConditions>
		<comment>Rename the concept_source.voided_by column to retired_by</comment>	
		<renameColumn tableName="concept_source" oldColumnName="voided_by" newColumnName="retired_by" columnDataType="int" />
		<addForeignKeyConstraint baseColumnNames="retired_by" baseTableName="concept_source" constraintName="user_who_retired_concept_source" deferrable="false" initiallyDeferred="false" referencedColumnNames="user_id" referencedTableName="users" />
	</changeSet>
	<changeSet id="20090907-3" author="Knoll_Frank" dbms="mysql">
		<preConditions onFail="MARK_RAN"><columnExists tableName="concept_source" columnName="voided"/></preConditions>
		<comment>Rename the concept_source.voided column to retired</comment>
		<renameColumn tableName="concept_source" oldColumnName="voided" newColumnName="retired" columnDataType="smallint" />
	</changeSet> <!-- Fix not required. See changeset 200908291938-2a -->
	<changeSet id="20090907-4" author="Knoll_Frank" dbms="mysql">
		<preConditions onFail="MARK_RAN"><columnExists tableName="concept_source" columnName="void_reason"/></preConditions>
		<comment>Rename the concept_source.void_reason column to retire_reason</comment>
		<renameColumn tableName="concept_source" oldColumnName="void_reason" newColumnName="retire_reason" columnDataType="varchar(255)" />
	</changeSet>
	
	<changeSet id="200908291938-1" author="dthomas" dbms="mysql">
		<comment>set hl7_code in ConceptSource to nullable column</comment>
		<ext:modifyColumn tableName="concept_source">
			<column name="hl7_code" type="varchar(50)">
				<constraints nullable="true" />
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200908291938-2a" author="dthomas" dbms="mysql">
		<comment>set retired in ConceptSource to tinyint(1) not null</comment>
		<ext:modifyColumn tableName="concept_source">
			<column name="retired" type="tinyint(1)">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200910271049-1" author="bwolfe">
		<comment>Setting core field types to have standard UUIDs</comment>
		<update tableName="field_type"><column name="uuid" value="8d5e7d7c-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '1' and name = 'Concept'</where></update>
		<update tableName="field_type"><column name="uuid" value="8d5e8196-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '2' and name = 'Database element'</where></update>
		<update tableName="field_type"><column name="uuid" value="8d5e836c-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '3' and name = 'Set of Concepts'</where></update>
		<update tableName="field_type"><column name="uuid" value="8d5e852e-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '4' and name = 'Miscellaneous Set'</where></update>
		<update tableName="field_type"><column name="uuid" value="8d5e86fa-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '5' and name = 'Section'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-2" author="bwolfe">
		<validCheckSum><comment>Escape character for SQL Server</comment>3:3132d4cbfaab0c0b612c3fe1c55bd0f1</validCheckSum>
		<validCheckSum>3:58c30dc9bab676050d5e08cc9484f9fc</validCheckSum>
		<comment>Setting core person attribute types to have standard UUIDs</comment>
		<update tableName="person_attribute_type"><column name="uuid" value="8d8718c2-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '2' and name = 'Birthplace'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d871afc-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '3' and name = 'Citizenship'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d871f2a-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '5' and name = 'Civil Status'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d87236c-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '7' and name = 'Health Center'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d872150-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '6' and name = 'Health District'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d871d18-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '4' and name = 'Mother\'s Name'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d871386-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '1' and name = 'Race'</where></update>
		<modifySql>
			<replace replace="\'" with="''"/>
		</modifySql>
	</changeSet>
	
	<changeSet id="200910271049-3" author="bwolfe">
		<comment>Setting core encounter types to have standard UUIDs</comment>
		<update tableName="encounter_type"><column name="uuid" value="8d5b27bc-c2cc-11de-8d13-0010c6dffd0f"/><where>encounter_type_id= '1' and name = 'ADULTINITIAL'</where></update>
		<update tableName="encounter_type"><column name="uuid" value="8d5b2be0-c2cc-11de-8d13-0010c6dffd0f"/><where>encounter_type_id= '2' and name = 'ADULTRETURN'</where></update>
		<update tableName="encounter_type"><column name="uuid" value="8d5b2dde-c2cc-11de-8d13-0010c6dffd0f"/><where>encounter_type_id= '3' and name = 'PEDSINITIAL'</where></update>
		<update tableName="encounter_type"><column name="uuid" value="8d5b3108-c2cc-11de-8d13-0010c6dffd0f"/><where>encounter_type_id= '4' and name = 'PEDSRETURN'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-4" author="bwolfe">
		<comment>Setting core concept datatypes to have standard UUIDs</comment>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a4488-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '1' and name = 'Numeric'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a48b6-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '2' and name = 'Coded'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a4ab4-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '3' and name = 'Text'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a4c94-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '4' and name = 'N/A'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a4e74-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '5' and name = 'Document'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a505e-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '6' and name = 'Date'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a591e-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '7' and name = 'Time'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a5af4-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '8' and name = 'Datetime'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a5cca-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '10' and name = 'Boolean'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a5e96-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '11' and name = 'Rule'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a606c-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '12' and name = 'Structured Numeric'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a6242-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '13' and name = 'Complex'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-5" author="bwolfe">
		<comment>Setting core relationship types to have standard UUIDs</comment>
		<update tableName="relationship_type"><column name="uuid" value="8d919b58-c2cc-11de-8d13-0010c6dffd0f"/><where> relationship_type_id = '1' and a_is_to_b = 'Doctor' and b_is_to_a = 'Patient'</where></update>
		<update tableName="relationship_type"><column name="uuid" value="8d91a01c-c2cc-11de-8d13-0010c6dffd0f"/><where> relationship_type_id = '2' and a_is_to_b = 'Sibling' and b_is_to_a = 'Sibling'</where></update>
		<update tableName="relationship_type"><column name="uuid" value="8d91a210-c2cc-11de-8d13-0010c6dffd0f"/><where> relationship_type_id = '3' and a_is_to_b = 'Parent' and b_is_to_a = 'Child'</where></update>
		<update tableName="relationship_type"><column name="uuid" value="8d91a3dc-c2cc-11de-8d13-0010c6dffd0f"/><where> relationship_type_id = '4' and a_is_to_b = 'Aunt/Uncle' and b_is_to_a = 'Niece/Nephew'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-6" author="bwolfe">
		<comment>Setting core concept classes to have standard UUIDs</comment>
		<update tableName="concept_class"><column name="uuid" value="8d4907b2-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '1' and name = 'Test'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d490bf4-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '2' and name = 'Procedure'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d490dfc-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '3' and name = 'Drug'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d4918b0-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '4' and name = 'Diagnosis'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d491a9a-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '5' and name = 'Finding'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d491c7a-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '6' and name = 'Anatomy'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d491e50-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '7' and name = 'Question'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492026-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '8' and name = 'LabSet'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d4923b4-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '9' and name = 'MedSet'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492594-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '10' and name = 'ConvSet'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492774-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '11' and name = 'Misc'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492954-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '12' and name = 'Symptom'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492b2a-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '13' and name = 'Symptom/Finding'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492d0a-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '14' and name = 'Specimen'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492ee0-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '15' and name = 'Misc Order'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-7" author="bwolfe">
		<comment>Setting core patient identifier types to have standard UUIDs</comment>
		<update tableName="patient_identifier_type"><column name="uuid" value="8d79403a-c2cc-11de-8d13-0010c6dffd0f"/><where>patient_identifier_type_id= '2' and name = 'Old Identification Number'</where></update>
		<update tableName="patient_identifier_type"><column name="uuid" value="8d793bee-c2cc-11de-8d13-0010c6dffd0f"/><where>patient_identifier_type_id= '1' and name = 'OpenMRS Identification Number'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-8" author="bwolfe">
		<comment>Setting core location to have standard UUIDs</comment>
		<update tableName="location"><column name="uuid" value="8d6c993e-c2cc-11de-8d13-0010c6dffd0f"/><where>location_id= '1' and name = 'Unknown Location'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-9" author="bwolfe">
		<comment>Setting core hl7 source to have standard UUIDs</comment>
		<update tableName="hl7_source"><column name="uuid" value="8d6b8bb6-c2cc-11de-8d13-0010c6dffd0f"/><where>hl7_source_id= '1' and name = 'LOCAL'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-10" author="bwolfe">
		<comment>Setting core roles to have standard UUIDs</comment>
		<update tableName="role"><column name="uuid" value="774b2af3-6437-4e5a-a310-547554c7c65c"/><where> role = 'Anonymous'</where></update>
		<update tableName="role"><column name="uuid" value="f7fd42ef-880e-40c5-972d-e4ae7c990de2"/><where> role = 'Authenticated'</where></update>
		<update tableName="role"><column name="uuid" value="8d94f280-c2cc-11de-8d13-0010c6dffd0f"/><where> role = 'Provider'</where></update>
		<update tableName="role"><column name="uuid" value="8d94f852-c2cc-11de-8d13-0010c6dffd0f"/><where> role = 'System Developer'</where></update>
	</changeSet>
	
	<changeSet id="200912071501-1" author="arthurs"> 
		<comment>Change name for patient.searchMaxResults global property to person.searchMaxResults</comment> 
		<update tableName="global_property"><column name="property" value="person.searchMaxResults"/><where> property = 'patient.searchMaxResults'</where></update> 
	</changeSet>

	<changeSet id="200912141552" author="madanmohan" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="encounter" columnName="changed_by" />
			</not>
		</preConditions>
		<comment>
			Add changed_by column to encounter table
		</comment>
		<addColumn tableName="encounter">
			<column name="changed_by" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="encounter_changed_by"
			baseTableName="encounter" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
		
	<changeSet id="200912141553" author="madanmohan" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="encounter" columnName="date_changed" />
			</not>
		</preConditions>
		<comment>
			Add date_changed column to encounter table
		</comment>
		<addColumn tableName="encounter">
			<column name="date_changed" type="datetime" />
		</addColumn>
	</changeSet>
	
	<changeSet id="200912211118" author="nribeka" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="concept_derived" columnName="language" />
			</not>
		</preConditions>
		<comment>Adding language column to concept_derived table</comment> 
		<addColumn tableName="concept_derived">
    		<column name="language" type="varchar(255)">
    			<constraints nullable="false" />
    		</column>
		</addColumn>
	</changeSet>	

	<changeSet id="200912031842" author="djazayeri" dbms="mysql">
		<!-- This is safe to re-run, and the pre-condition is hard to write, so I'm not writing one -->
		<comment>Changing encounter.provider_id to reference person instead of users</comment>
		<dropForeignKeyConstraint baseTableName="encounter" constraintName="encounter_provider"/>
		<addForeignKeyConstraint baseTableName="encounter" baseColumnNames="provider_id" constraintName="encounter_provider"
                                 referencedTableName="person" referencedColumnNames="person_id"/>
	</changeSet>
	
	<changeSet id="201102280948" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<and>
				<foreignKeyConstraintExists foreignKeyName="person_id_for_user"/>
				<not><changeSetExecuted changeLogFile="liquibase-update-to-latest.xml" author="djazayeri" id="200912031846-3"/></not>
			</and>
		</preConditions>
		<comment>Removing the foreign key from users.user_id to person.person_id if it still exists</comment>
		<dropForeignKeyConstraint baseTableName="users" constraintName="person_id_for_user"/>
	</changeSet>
	
	<changeSet id="200912031846-1" author="djazayeri" dbms="mysql">
		<validCheckSum>3aff267520eec4d52e81ef7614b2da3</validCheckSum>
		<validCheckSum>11f84b948fc7731d1ffb6869980e6cb</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="users" columnName="person_id"/>
			</not>
		</preConditions>
		<comment>Adding person_id column to users table (if needed)</comment>
		<addColumn tableName="users">
			<column name="person_id" type="int"/>
		</addColumn>
		<update tableName="users">
			<column name="person_id" valueNumeric="user_id"/>
		</update>
	</changeSet>

	<changeSet id="200912031846-2" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					select count(*) from users where person_id is null
				</sqlCheck>
			</not>
		</preConditions>
		<comment>Populating users.person_id</comment>
		<update tableName="users">
			<column name="person_id" valueNumeric="user_id"/>
			<where>person_id is null</where>
		</update>
		<addNotNullConstraint tableName="users" columnName="person_id" columnDataType="int"/>
	</changeSet>

	<changeSet id="200912031846-3" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="person_id_for_user"/>
			</not>
		</preConditions>
		<comment>Restoring foreign key constraint on users.person_id</comment>
		<addForeignKeyConstraint constraintName="person_id_for_user"
								 baseTableName="users" baseColumnNames="person_id"
								 referencedTableName="person" referencedColumnNames="person_id"/>
		<addAutoIncrement tableName="users" columnName="user_id" columnDataType="int"/>
	</changeSet>
	
	<changeSet id="200912091819" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="users" columnName="retired"/>
			</not>
		</preConditions>
		<comment>Adding retired metadata columns to users table</comment>
		<addColumn tableName="users">
			<column name="retired" type="tinyint" defaultValueNumeric="0">
				<constraints nullable="false"/>
			</column>
			<column name="retired_by" type="int(11)"/>
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null"/>
		</addColumn>
		<addForeignKeyConstraint constraintName="user_who_retired_this_user"
			baseTableName="users" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id"/>
	</changeSet>
	<changeSet id="200912091819-fix" author="sunbiz" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="users" columnName="retired"/>
		</preConditions>
		<comment>(Fixed)users.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="users">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="200912091820" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<and>
				<columnExists tableName="users" columnName="retired"/>
				<columnExists tableName="users" columnName="voided"/>
			</and>
		</preConditions>
		<comment>Migrating voided metadata to retired metadata for users table</comment>
		<update tableName="users">
			<column name="retired" valueNumeric="voided"/>
			<column name="retired_by" valueNumeric="voided_by"/>
			<column name="date_retired" valueNumeric="date_voided"/>
			<column name="retire_reason" valueNumeric="void_reason"/>
		</update>
	</changeSet>
	
	<changeSet id="200912091821" author="djazayeri" dbms="mysql">
		<preConditions onFail="HALT">
			<and>
				<columnExists tableName="users" columnName="retired"/>
				<columnExists tableName="users" columnName="voided"/>
				<sqlCheck expectedResult="0">
					select count(*) from users where voided != retired
				</sqlCheck>
			</and>
		</preConditions>
		<comment>Dropping voided metadata columns from users table</comment>
		<dropForeignKeyConstraint baseTableName="users" constraintName="user_who_voided_user"/>
		<dropColumn tableName="users" columnName="voided"/>
		<dropColumn tableName="users" columnName="voided_by"/>
		<dropColumn tableName="users" columnName="date_voided"/>
		<dropColumn tableName="users" columnName="void_reason"/>
	</changeSet>
	
	<changeSet id="200912140038" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="users" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to users table</comment>
		<addColumn tableName="users">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>

	<changeSet id="200912140039" author="djazayeri">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in users table via built in uuid function.</comment>
		<update tableName="users" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>

	<changeSet id="200912140040" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not>
				<or>
					<dbms type="mysql" />
					<dbms type="oracle" />
					<dbms type="mssql" />
				</or>
			</not>
		</preConditions>
		<comment>
			Adding UUIDs to users table via a java class. (This will take a long time on large databases)
		</comment>
		<customChange class="org.openmrs.util.databasechange.GenerateUuid">
			<param name="tableNames">
				users
			</param>
			<param name="columnName" value="uuid"/>
			<param name="idExceptions">
				users_id=user_id
			</param>
		</customChange>
	</changeSet>

	<changeSet id="20100415-forgotten-from-before" author="djazayeri">
		<comment>Adding not null constraint to users.uuid</comment>
		<addNotNullConstraint tableName="users" columnName="uuid" columnDataType="char(38)"/>
	</changeSet>
	
	<changeSet id="200912151032" author="n.nehete" dbms="mysql">
		<preConditions onFail="HALT">
			<sqlCheck expectedResult="All encounters have a non-null encounter type.">
				<![CDATA[
					SELECT case when count(*) > 0 
							then 'There are rows in the encounter table with an empty encounter type.  Encounter type is a required field and must be populated.  These encounters need to be fixed manually by setting an appropriate encounter type.' 
							else 'All encounters have a non-null encounter type.' end 
					FROM encounter where encounter_type is null;
				]]>
			</sqlCheck>
		</preConditions>	
		<comment>Encounter Type should not be null when saving an Encounter</comment>
		<addNotNullConstraint tableName="encounter" columnName="encounter_type" columnDataType="int" />
	</changeSet>	
	
	<changeSet id="201001072007" author="upul" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="scheduler_task_config" columnName="last_execution_time"/></not>
		</preConditions>
		<comment>
			Add last execution time column to scheduler_task_config table
		</comment>		
		<addColumn tableName="scheduler_task_config">
			<column name="last_execution_time" type="DATETIME">
				<constraints nullable="true"/>
			</column>
		</addColumn>
	</changeSet>    	
	
	<changeSet id="20091001-1023" author="rcrichton" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="relationship_type" columnName="retired"/>
			</not>
		</preConditions>
		<comment>add retired column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="retired" type="tinyint(1)" defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
	
	<changeSet id="20091001-1024" author="rcrichton" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="relationship_type" columnName="retired_by"/>
			</not>
		</preConditions>
		<comment>add retired_by column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="retired_by" type="int"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="20091001-1025" author="rcrichton" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="user_who_retired_relationship_type"/></not>
		</preConditions>
		<comment>
			Create the foreign key from the relationship.retired_by to users.user_id.
		</comment>
		<addForeignKeyConstraint constraintName="user_who_retired_relationship_type"
			baseTableName="relationship_type" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	
	<changeSet id="20091001-1026" author="rcrichton" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="relationship_type" columnName="date_retired"/>
			</not>
		</preConditions>
		<comment>add date_retired column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="date_retired" type="datetime" />
		</addColumn>
	</changeSet>
	
	<changeSet id="20091001-1027" author="rcrichton" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="relationship_type" columnName="retire_reason"/>
			</not>
		</preConditions>
		<comment>add retire_reason column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="retire_reason" type="varchar(255)" />
		</addColumn>
	</changeSet>

	<changeSet id="20091215-0208" author="sunbiz" dbms="mysql">
		<comment>
			Prune concepts rows orphaned in concept_numeric tables
		</comment>
		<sql>
			<![CDATA[
				DELETE concept_numeric FROM concept_numeric
				INNER JOIN concept ON concept.concept_id = concept_numeric.concept_id
				AND concept.datatype_id NOT IN (1,12)
			]]>
		</sql>
	</changeSet>

	<changeSet id="20091215-0209" author="jmiranda" dbms="mysql">
		<comment>
			Prune concepts rows orphaned in concept_complex tables
		</comment>
		<sql>
			<![CDATA[
				DELETE concept_complex FROM concept_complex
				INNER JOIN concept ON concept.concept_id = concept_complex.concept_id 
				AND concept.datatype_id NOT IN (5, 13)
			]]>
		</sql>
	</changeSet>

	<changeSet id="20091215-0210" author="jmiranda" dbms="mysql">
		<comment>
			Prune concepts rows orphaned in concept_derived tables
		</comment>
		<sql>
			<![CDATA[			
				DELETE concept_derived FROM concept_derived
				INNER JOIN concept ON concept.concept_id = concept_derived.concept_id 
				AND concept.datatype_id <> 11	
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="20100306-095513a" author="thilini.hg" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="alert_assigned_to_user"/>
		</preConditions>
		<comment>Dropping unused foreign key from notification alert table</comment>
		<dropForeignKeyConstraint baseTableName="notification_alert" constraintName="alert_assigned_to_user"/>
	</changeSet>
	
	<changeSet id="20100306-095513b" author="thilini.hg" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="notification_alert" columnName="user_id"/>
		</preConditions>
		<comment>Dropping unused user_id column from notification alert table</comment>
		<dropColumn tableName="notification_alert" columnName="user_id"/>
	</changeSet>
	
	<changeSet id="20100322-0908" author="syhaas" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="concept_answer" columnName="sort_weight"/>
			</not>
		</preConditions>
		<comment>Adding sort_weight column to concept_answers table and initially sets the sort_weight to the concept_answer_id</comment>
		<addColumn tableName="concept_answer">
			<column name="sort_weight" type="double"></column>
		</addColumn>
		<update tableName="concept_answer">
			<column name="sort_weight" valueNumeric="concept_answer_id"/>
		</update>
	</changeSet>
	
	<changeSet id="20100412-2217" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="notification_alert_recipient" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to notification_alert_recipient table</comment>
		<addColumn tableName="notification_alert_recipient">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>

	<changeSet id="20100412-2218" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /></or></preConditions>
		<comment>Generating UUIDs for all rows in notification_alert_recipient table via built in uuid function.</comment>
		<update tableName="notification_alert_recipient" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
	</changeSet>

	<changeSet id="20100412-2219" author="bwolfe">
		<validCheckSum><comment>Added idExceptions as idColumn is alert_id</comment>3:1401fe5f2d0c6bc23afa70b162e15346</validCheckSum>
		<validCheckSum>3:9a1bdeabe1d03d6b1c955ca8f035cce7</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<not>
				<or>
					<dbms type="mysql" />
					<dbms type="oracle" />
					<dbms type="mssql" />
				</or>
			</not>
		</preConditions>
		<comment>
			Adding UUIDs to notification_alert_recipient table via a java class (if needed).
		</comment>
		<customChange class="org.openmrs.util.databasechange.GenerateUuid">
			<param name="tableNames">
				notification_alert_recipient
			</param>
			<param name="columnName" value="uuid"/>
			<param name="idExceptions">
				notification_alert_recipient_id=alert_id
			</param>
		</customChange>
	</changeSet>
	
	<changeSet id="20100412-2220" author="bwolfe">
		<preConditions><not><dbms type="mssql"/></not></preConditions>
		<comment>
			Now that UUID generation is done, set the notification_alert_recipient.uuid column to not "NOT NULL" 
		</comment>
		<addNotNullConstraint tableName="notification_alert_recipient" columnName="uuid" columnDataType="char(38)"/>
	</changeSet>
	
	<changeSet id="20100413-1509" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location_tag" columnName="tag"/>
		</preConditions>
		<comment>
			Change location_tag.tag to location_tag.name
		</comment>
		<renameColumn tableName="location_tag"
   			 oldColumnName="tag" newColumnName="name" columnDataType="varchar(50)"/>
	</changeSet>
	
	<changeSet id="20110922-0551" author="sunbiz" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<changeSetExecuted changeLogFile="liquibase-update-to-latest.xml" author="bwolfe" id="20100427-1334"/>
		</preConditions>
		<comment>Changing global_property.property from varbinary to varchar</comment>
		<ext:modifyColumn tableName="global_property">
			<column name="property" type="varchar(255)" />
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20100423-1402" author="slorenz" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="encounter_datetime_idx"/>
			</not>
		</preConditions>
		<comment>Add an index to the encounter.encounter_datetime column to speed up statistical
			analysis.</comment>
		<createIndex tableName="encounter" indexName="encounter_datetime_idx">
			<column name="encounter_datetime"/>
		</createIndex>
	</changeSet>
	
	<changeSet id="20100423-1406" author="slorenz" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="obs_datetime_idx"/>
			</not>
		</preConditions>
		<comment>Add an index to the obs.obs_datetime column to speed up statistical analysis.</comment>
		<createIndex tableName="obs" indexName="obs_datetime_idx">
			<column name="obs_datetime"/>
		</createIndex>
	</changeSet>
	
	<changeSet id="20100426-1111-remove-not-null-personid-contraint" author="dkayiwa" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="users" columnName="person_id"/>
		</preConditions>
		<comment>Drop the not null person id contraint</comment>
		<dropNotNullConstraint tableName="users" columnName="person_id" columnDataType="int"/>				
	</changeSet>
	
	<changeSet id="20100426-1947" author="syhaas" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				<![CDATA[
				SELECT count(*) FROM users WHERE system_id = 'daemon'
				]]>
			</sqlCheck>
		</preConditions>
		<comment>Adding daemon user to users table</comment>
		<insert tableName="users">
			<column name="system_id" value="daemon"/>
			<column name="username" value="daemon"/>
			<column name="creator" valueNumeric="1"/>
			<column name="date_created" valueDate="2010-04-26T13:25:00"/>
			<column name="retired" valueNumeric="0"/>
			<column name="uuid" value="A4F30A1B-5EB9-11DF-A648-37A07F9C90FB"/>
		</insert>
	</changeSet>
	
	<changeSet id="20100513-1947" author="syhaas">
		<comment>Removing scheduler.username and scheduler.password global properties</comment>
		<delete tableName="global_property">
			<where>property = 'scheduler.username'</where>
		</delete>
		<delete tableName="global_property">
			<where>property = 'scheduler.password'</where>
		</delete>
	</changeSet>

	<changeSet id="20100512-1400" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				select count(*) from order_type where order_type_id = 2
			</sqlCheck>
		</preConditions>
		<comment>Create core order_type for drug orders</comment>
		<insert tableName="order_type">
			<column name="order_type_id" valueNumeric="2" />
			<column name="name" value="Drug Order" />
			<column name="description" value="An order for a medication to be given to the patient" />
			<column name="creator" valueNumeric="1" />
			<column name="date_created" valueDate="2010-05-12" />
			<column name="retired" valueNumeric="0" />
			<column name="date_retired" />
			<column name="retire_reason" />
			<column name="uuid" value="131168f4-15f5-102d-96e4-000c29c2a5d7" />
		</insert>
	</changeSet>
	
	<changeSet id="20100517-1545" author="wyclif and djazayeri" dbms="mysql">
		<comment>Switch boolean concepts/observations to be stored as coded</comment>
		<customChange class="org.openmrs.util.databasechange.BooleanConceptChangeSet"/>				
	</changeSet>
	
	<changeSet id="20100526-1025" author="Harsha.cse" dbms="mysql">
		<comment>
			Drop Not-Null constraint from location column in Encounter and Obs table
		</comment>
		<dropNotNullConstraint tableName="encounter" columnName="location_id" columnDataType="int"/>
		<dropNotNullConstraint tableName="obs" columnName="location_id" columnDataType="int"/>
	</changeSet>

	<changeSet id="20100604-0933a" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists columnName="message_state" tableName="hl7_in_archive" />
		</preConditions>
		<comment>
			Changing the default value to 2 for 'message_state' column in 'hl7_in_archive' table
		</comment>
		<addDefaultValue columnName="message_state" tableName="hl7_in_archive" defaultValue="2"/>
	</changeSet>

	<changeSet id="20100604-0933b" author="wyclif">
		<preConditions onFail="MARK_RAN">
			<columnExists columnName="message_state" tableName="hl7_in_archive" />
		</preConditions>
		<comment>Converting 0 and 1 to 2 for 'message_state' column in 'hl7_in_archive' table</comment>
		<update tableName="hl7_in_archive">
			<column name="message_state" value="2"/>
			<where>message_state IN (0,1)</where>
		</update>
	</changeSet>
	
	<changeSet id="20100323-192043" author="ricardosbarbosa" dbms="mysql">
		<comment>
			Removing the duplicate privilege 'Add Concept Proposal' in favor of 'Add Concept Proposals'
		</comment>
		<update tableName="role_privilege">
			<column name="privilege">Add Concept Proposals</column>
			<where>privilege = 'Add Concept Proposal' and not exists (select * from (select role, privilege from role_privilege) rp2 where rp2.role = role and rp2.privilege = 'Add Concept Proposals')</where>
		</update>
		<delete tableName="role_privilege"><where>privilege='Add Concept Proposal'</where></delete>
		<delete tableName="privilege"><where>privilege='Add Concept Proposal'</where></delete>
	</changeSet>
		
	<changeSet id="20100330-190413" author="ricardosbarbosa" dbms="mysql">
		<comment>
			Removing the duplicate privilege 'Edit Concept Proposal' in favor of 'Edit Concept Proposals'
		</comment>		
		<update tableName="role_privilege">
			<column name="privilege">Edit Concept Proposals</column>
			<where>privilege = 'Edit Concept Proposal' and not exists (select * from (select role, privilege from role_privilege) rp2 where rp2.role = role and rp2.privilege = 'Edit Concept Proposals')</where>
		</update>
		<delete tableName="role_privilege"><where>privilege='Edit Concept Proposal'</where></delete>
		<delete tableName="privilege"><where>privilege='Edit Concept Proposal'</where></delete>
	</changeSet>
	

	<changeSet id="20100525-818-1" author="syhaas" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="active_list_type"/>
			</not>
		</preConditions>
		<comment>Create active list type table.</comment>
		<createTable tableName="active_list_type">
			<column name="active_list_type_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(255)"/>
			<column name="creator" type="int(11)">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false"/>
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false"/>
			</column>
			<column name="retired_by" type="int(11)"/>
			<column name="date_retired" type="datetime"/>
			<column name="retire_reason" type="varchar(255)"/>
			<column name="uuid" type="char(38)">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="user_who_retired_active_list_type"
			baseTableName="active_list_type" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="user_who_created_active_list_type"
			baseTableName="active_list_type" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	<changeSet id="20100525-818-1-fix" author="sunbiz" dbms="mysql">
		<comment>(Fixed)Change active_list_type.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="active_list_type">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20100525-818-2" author="syhaas" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="active_list"/>
			</not>
		</preConditions>
		<comment>Create active list table</comment>
		<createTable tableName="active_list">
			<column name="active_list_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="active_list_type_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="person_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="concept_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="start_obs_id" type="int"/>
			<column name="stop_obs_id" type="int"/>
			<column name="start_date" type="datetime">
				<constraints nullable="false"/>
			</column>
			<column name="end_date" type="datetime"/>
			<column name="comments" type="varchar(255)"/>
			<column name="creator" type="int(11)">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false"/>
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false"/>
			</column>
			<column name="voided_by" type="int(11)"/>
			<column name="date_voided" type="datetime"/>
			<column name="void_reason" type="varchar(255)"/>
			<column name="uuid" type="char(38)">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="user_who_voided_active_list"
			baseTableName="active_list" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="user_who_created_active_list"
			baseTableName="active_list" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="active_list_type_of_active_list"
			baseTableName="active_list" baseColumnNames="active_list_type_id"
			referencedTableName="active_list_type" referencedColumnNames="active_list_type_id" />
		<addForeignKeyConstraint constraintName="person_of_active_list"
			baseTableName="active_list" baseColumnNames="person_id"
			referencedTableName="person" referencedColumnNames="person_id" />
		<addForeignKeyConstraint constraintName="concept_active_list"
			baseTableName="active_list" baseColumnNames="concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id" />
		<addForeignKeyConstraint constraintName="start_obs_active_list"
			baseTableName="active_list" baseColumnNames="start_obs_id"
			referencedTableName="obs" referencedColumnNames="obs_id" />
		<addForeignKeyConstraint constraintName="stop_obs_active_list"
			baseTableName="active_list" baseColumnNames="stop_obs_id"
			referencedTableName="obs" referencedColumnNames="obs_id" />
	</changeSet>
	<changeSet id="20100525-818-2-fix" author="sunbiz">
		<comment>(Fixed)Change active_list_type.retired to BOOLEAN</comment>
			<ext:modifyColumn tableName="active_list">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
			</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20100525-818-3" author="syhaas" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="active_list_allergy"/>
			</not>
		</preConditions>
		<comment>Create allergen table</comment>
		<createTable tableName="active_list_allergy">
			<column name="active_list_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="allergy_type" type="varchar(50)"/>
			<column name="reaction_concept_id" type="int"/>
			<column name="severity" type="varchar(50)"/>
		</createTable>
		<addForeignKeyConstraint constraintName="reaction_allergy"
			baseTableName="active_list_allergy" baseColumnNames="reaction_concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>
	
	<changeSet id="20100525-818-4" author="syhaas" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="active_list_problem"/>
			</not>
		</preConditions>
		<comment>Create problem table</comment>
		<createTable tableName="active_list_problem">
			<column name="active_list_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="status" type="varchar(50)"/>
			<column name="sort_weight" type="double"/>
		</createTable>
	</changeSet>
	
	<changeSet id="20100525-818-5" author="syhaas" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				SELECT count(*) FROM active_list_type
			</sqlCheck>
		</preConditions>
		<comment>Inserting default active list types</comment>
		<insert tableName="active_list_type">
			<column name="active_list_type_id" valueNumeric="1" />
			<column name="name" value="Allergy" />
			<column name="description" value="An Allergy the Patient may have" />
			<column name="creator" valueNumeric="1" />
			<column name="date_created" valueDate="2010-05-28" />
			<column name="retired" valueNumeric="0" />
			<column name="date_retired" />
			<column name="retire_reason" />
			<column name="uuid" value="96f4f603-6a99-11df-a648-37a07f9c90fb" />
		</insert>
		<insert tableName="active_list_type">
			<column name="active_list_type_id" valueNumeric="2" />
			<column name="name" value="Problem" />
			<column name="description" value="A Problem the Patient may have" />
			<column name="creator" valueNumeric="1" />
			<column name="date_created" valueDate="2010-05-28" />
			<column name="retired" valueNumeric="0" />
			<column name="date_retired" />
			<column name="retire_reason" />
			<column name="uuid" value="a0c7422b-6a99-11df-a648-37a07f9c90fb" />
		</insert>
	</changeSet>
	
	<changeSet id="20100607-1550a" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists columnName="concept_name_type" tableName="concept_name"/>
			</not>
		</preConditions>
		<comment>Adding 'concept_name_type' column to concept_name table</comment>
		<addColumn tableName="concept_name">
			<column name="concept_name_type" type="varchar(50)"></column>
		</addColumn>
	</changeSet>

	<changeSet id="20100607-1550b" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists columnName="locale_preferred" tableName="concept_name"/>
			</not>
		</preConditions>
		<comment>Adding 'locale_preferred' column to concept_name table</comment>
		<addColumn tableName="concept_name">
			<column name="locale_preferred" type="smallint" defaultValueNumeric="0"></column>
		</addColumn>
	</changeSet>
	<changeSet id="20100607-1550b-fix" author="sunbiz" dbms="mysql">
		<comment>(Fixed)Change concept_name.locale_preferred to BOOLEAN</comment>
		<ext:modifyColumn tableName="concept_name">
			<column name="locale_preferred" type="boolean" defaultValueBoolean="false"/>
		</ext:modifyColumn>
	</changeSet>

	<changeSet id="20100607-1550c" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="mapped_concept_name_tag"/>
		</preConditions>
		<comment>Dropping foreign key constraint on concept_name_tag_map.concept_name_tag_id</comment>
		<dropForeignKeyConstraint baseTableName="concept_name_tag_map" constraintName="mapped_concept_name_tag"/>		
	</changeSet>

	<changeSet id="20100607-1550d" author="wyclif">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					SELECT count(*) FROM concept_name_tag WHERE concept_name_tag_id = 2
				</sqlCheck>
			</not>
		</preConditions>
		<comment>Setting the concept name type for short names</comment>
		<update tableName="concept_name">
			<column name="concept_name_type" value="SHORT"/>
			<where>concept_name_id IN (SELECT concept_name_id FROM concept_name_tag_map WHERE concept_name_tag_id = 2)</where>
		</update>
		<delete tableName="concept_name_tag_map">
			<where>concept_name_tag_id = 2</where>
		</delete>	
		<delete tableName="concept_name_tag">
			<where>concept_name_tag_id = 2</where>
		</delete>
	</changeSet>
	
	<changeSet id="20100607-1550f" author="wyclif">
		<validCheckSum><comment>After changing to boolean</comment>3:b57c0f651ed477457fd16e503eaf51a4</validCheckSum>
		<validCheckSum>3:002108aacdf55731f4fd472d5308c5c8</validCheckSum>
        <validCheckSum>3:6a72bbb390155596e52da4e8d065d1a2</validCheckSum>
        <validCheckSum><comment>Fixing TRUNK-4040</comment>3:74026cd4543ebbf561999a81c276224d</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					SELECT count(*) FROM concept_name_tag WHERE tag like 'preferred\___' OR concept_name_tag_id = 4
				</sqlCheck>
			</not>
		</preConditions>
		<comment>
			Converting concept names with 'preferred' and 'preferred_XX' concept name tags to preferred names
		</comment>    	
		<update tableName="concept_name">
			<column name="locale_preferred" valueBoolean="true"/>
			<column name="concept_name_type" value="FULLY_SPECIFIED"/>
			<where>
				concept_name_id IN (SELECT concept_name_id FROM concept_name_tag cnt, concept_name_tag_map cntm 
				WHERE cnt.concept_name_tag_id = cntm.concept_name_tag_id AND (cnt.tag like 'preferred\___' OR cnt.concept_name_tag_id = 4))
			</where>
		</update>
		<delete tableName="concept_name_tag_map">
			<where>
				concept_name_tag_id IN (SELECT concept_name_tag_id FROM concept_name_tag WHERE tag LIKE 'preferred\___') OR concept_name_tag_id = 4
			</where>
		</delete>
		<delete tableName="concept_name_tag"><where>tag LIKE 'preferred\___' OR concept_name_tag_id = 4</where></delete>
	</changeSet>
	
	<changeSet id="20150122-1414" author="rkorytkowski">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					SELECT count(*) FROM concept_name_tag WHERE concept_name_tag_id = 1
				</sqlCheck>
			</not>
		</preConditions>
		<comment>Reverting concept name type to NULL for concepts having names tagged as default</comment>
		<update tableName="concept_name">
			<column name="concept_name_type" />
			<where>concept_id IN (SELECT concept_id FROM (SELECT concept_id FROM concept_name LEFT JOIN concept_name_tag_map 
			ON concept_name.concept_name_id = concept_name_tag_map.concept_name_id WHERE concept_name_tag_id = 1) AS x)</where>
		</update>
	</changeSet>
	
	<changeSet id="20150122-1420" author="rkorytkowski">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					SELECT count(*) FROM concept_name_tag WHERE concept_name_tag_id = 1
				</sqlCheck>
			</not>
		</preConditions>
		<comment>Setting concept name type to fully specified for names tagged as default</comment>
		<update tableName="concept_name">
			<column name="concept_name_type" value="FULLY_SPECIFIED"/>
			<where>concept_name_id IN (SELECT concept_name_id FROM concept_name_tag_map WHERE concept_name_tag_id = 1)</where>
		</update>
		<delete tableName="concept_name_tag_map">
			<where>concept_name_tag_id = 1</where>
		</delete>	
		<delete tableName="concept_name_tag">
			<where>concept_name_tag_id = 1</where>
		</delete>
	</changeSet>

	<changeSet id="20100607-1550g" author="wyclif">
		<preConditions onFail="MARK_RAN">				
			<not>
				<sqlCheck expectedResult="0">
					SELECT count(*) FROM concept_name_tag WHERE concept_name_tag_id IN (1,3)
				</sqlCheck>
			</not>	
		</preConditions>
		<comment>Deleting 'default' and 'synonym' concept name tags</comment>		
		<delete tableName="concept_name_tag_map">
			<where>concept_name_tag_id IN (1,3)</where>
		</delete>	
		<delete tableName="concept_name_tag">
			<where>concept_name_tag_id IN (1,3)</where>
		</delete>
	</changeSet>

	<changeSet id="20100607-1550h" author="wyclif">
		<preConditions onFail="MARK_RAN">
			<not><sqlCheck expectedResult="0">SELECT count(*) FROM concept WHERE retired = FALSE</sqlCheck></not>
		</preConditions>				
		<comment>Validating and attempting to fix invalid concepts and ConceptNames</comment>
		<customChange class="org.openmrs.util.databasechange.ConceptValidatorChangeSet"/>				
	</changeSet>
	
	<changeSet id="20100607-1550i" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">			
			<not>
				<foreignKeyConstraintExists foreignKeyName="mapped_concept_name_tag"/>
			</not>
		</preConditions>
		<comment>Restoring foreign key constraint on concept_name_tag_map.concept_name_tag_id</comment>
		<addForeignKeyConstraint referencedTableName="concept_name_tag" baseColumnNames="concept_name_tag_id" 
								baseTableName="concept_name_tag_map" referencedColumnNames="concept_name_tag_id" 
								constraintName="mapped_concept_name_tag"/>
	</changeSet>

	<changeSet id="20100621-1443" author="jkeiper" dbms="mysql">
		<comment>
			Modify the error_details column of hl7_in_error to hold
			stacktraces
		</comment>
		<ext:modifyColumn tableName="hl7_in_error">
			<column name="error_details" type="mediumtext" />
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="201008021047" author="bwolfe" failOnError="false" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="family_name2"/>
			</not>
		</preConditions>
		<comment>
			Add an index to the person_name.family_name2 to speed up patient and person searches
		</comment>
		<createIndex tableName="person_name" indexName="family_name2">
			<column name="family_name2" />
		</createIndex>
	</changeSet>
	
	<changeSet id="201008201345" author="mseaton">			
		<comment>Validates Program Workflow States for possible configuration problems and reports warnings</comment>
		<customChange class="org.openmrs.util.databasechange.ProgramValidatorChangeSet"/>				
	</changeSet>

	<changeSet id="201008242121" author="misha680" dbms="mysql">
		<comment>Make person_name.person_id not NULLable</comment>
		<ext:modifyColumn tableName="person_name">
			<column name="person_id" type="int">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20100924-1110" author="mseaton" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="patient_program" columnName="location_id"/></not>
		</preConditions>
		<comment>
			Add location_id column to patient_program table
		</comment>
		<addColumn tableName="patient_program">
			<column name="location_id" type="int(11)" />
		</addColumn>
		<addForeignKeyConstraint constraintName="patient_program_location_id"
			baseTableName="patient_program" baseColumnNames="location_id"
			referencedTableName="location" referencedColumnNames="location_id"/>
	</changeSet>

	<changeSet id="201009281047" author="misha680" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="concept" columnName="default_charge"/>
		</preConditions>
		<comment>Remove the now unused default_charge column</comment>
		<dropColumn tableName="concept" columnName="default_charge"/>
	</changeSet>
	
	<changeSet id="201010051745" author="wyclif">
		<comment>Setting the global property 'patient.identifierRegex' to an empty string</comment>
		<update tableName="global_property">
			<column name="property_value" value=""/>
			<where>property = 'patient.identifierRegex' AND property_value = '^0*@SEARCH@([A-Z]+-[0-9])?$' </where>
		</update>
	</changeSet>
	
	<changeSet id="201010051746" author="wyclif">
		<comment>Setting the global property 'patient.identifierSuffix' to an empty string</comment>
		<update tableName="global_property">
			<column name="property_value" value=""/>
			<where>property = 'patient.identifierSuffix' AND property_value = '%' </where>
		</update>
	</changeSet>
	
	<changeSet id="201010151054" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="form_published_index" /></not>
		</preConditions>
		<comment>Adding index to form.published column</comment>
		<createIndex tableName="form" indexName="form_published_index">
			<column name="published" />
		</createIndex>
	</changeSet>
	
	<changeSet id="201010151055" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="form_retired_index" /></not>
		</preConditions>
		<comment>Adding index to form.retired column</comment>
		<createIndex tableName="form" indexName="form_retired_index">
			<column name="retired" />
		</createIndex>	
	</changeSet>
	
	<changeSet id="201010151056" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="form_published_and_retired_index" /></not>
		</preConditions>
		<comment>Adding multi column index on form.published and form.retired columns</comment>
		<createIndex tableName="form" indexName="form_published_and_retired_index">
			<column name="published" />
			<column name="retired" />
		</createIndex>	
	</changeSet>
	
	<changeSet id="201010261143" author="crecabarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="person_address" columnName="neighborhood_cell"/>
		</preConditions>
		<comment>Rename neighborhood_cell column to address3 and increase the size to 255 characters</comment>
		<renameColumn tableName="person_address"
			oldColumnName="neighborhood_cell" newColumnName="address3" columnDataType="varchar(255)"/>
	</changeSet>
	
	<changeSet id="201010261145" author="crecabarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="person_address" columnName="township_division"/>
		</preConditions>
		<comment>Rename township_division column to address4 and increase the size to 255 characters</comment>
		<renameColumn tableName="person_address"
			oldColumnName="township_division" newColumnName="address4" columnDataType="varchar(255)"/>
	</changeSet>
	
	<changeSet id="201010261147" author="crecabarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="person_address" columnName="subregion"/>
		</preConditions>
		<comment>Rename subregion column to address5 and increase the size to 255 characters</comment>
		<renameColumn tableName="person_address"
			oldColumnName="subregion" newColumnName="address5" columnDataType="varchar(255)"/>
	</changeSet>
	
	<changeSet id="201010261149" author="crecabarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="person_address" columnName="region"/>
		</preConditions>
		<comment>Rename region column to address6 and increase the size to 255 characters</comment>
		<renameColumn tableName="person_address"
			oldColumnName="region" newColumnName="address6" columnDataType="varchar(255)"/>
	</changeSet>
	
	<changeSet id="201010261151" author="crecabarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location" columnName="neighborhood_cell"/>
		</preConditions>
		<comment>Rename neighborhood_cell column to address3 and increase the size to 255 characters</comment>
		<renameColumn tableName="location"
			oldColumnName="neighborhood_cell" newColumnName="address3" columnDataType="varchar(255)"/>
	</changeSet>
	
	<changeSet id="201010261153" author="crecabarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location" columnName="township_division"/>
		</preConditions>
		<comment>Rename township_division column to address4 and increase the size to 255 characters</comment>
		<renameColumn tableName="location"
			oldColumnName="township_division" newColumnName="address4" columnDataType="varchar(255)"/>
	</changeSet>
	
	<changeSet id="201010261156" author="crecabarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location" columnName="subregion"/>
		</preConditions>
		<comment>Rename subregion column to address5 and increase the size to 255 characters</comment>
		<renameColumn tableName="location"
			oldColumnName="subregion" newColumnName="address5" columnDataType="varchar(255)"/>
	</changeSet>
	
	<changeSet id="201010261159" author="crecabarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location" columnName="region"/>
		</preConditions>
		<comment>Rename region column to address6 and increase the size to 255 characters</comment>
		<renameColumn tableName="location"
			oldColumnName="region" newColumnName="address6" columnDataType="varchar(255)"/>
	</changeSet>
	
	<changeSet id="201012092009" author="djazayeri" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><changeSetExecuted id="201012092009" author="djazayeri" changeLogFile="liquibase-update-to-latest.xml"/></not>
		</preConditions>
		<comment>Increasing length of address fields in person_address and location to 255</comment>
		<ext:modifyColumn tableName="person_address"><column name="address1" type="varchar(255)"/></ext:modifyColumn>
		<ext:modifyColumn tableName="person_address"><column name="address2" type="varchar(255)"/></ext:modifyColumn>
		<ext:modifyColumn tableName="person_address"><column name="city_village" type="varchar(255)"/></ext:modifyColumn>
		<ext:modifyColumn tableName="person_address"><column name="state_province" type="varchar(255)"/></ext:modifyColumn>
		<ext:modifyColumn tableName="person_address"><column name="county_district" type="varchar(255)"/></ext:modifyColumn>
		<ext:modifyColumn tableName="location"><column name="address1" type="varchar(255)"/></ext:modifyColumn>
		<ext:modifyColumn tableName="location"><column name="address2" type="varchar(255)"/></ext:modifyColumn>
		<ext:modifyColumn tableName="location"><column name="city_village" type="varchar(255)"/></ext:modifyColumn>
		<ext:modifyColumn tableName="location"><column name="state_province" type="varchar(255)"/></ext:modifyColumn>
		<ext:modifyColumn tableName="location"><column name="county_district" type="varchar(255)"/></ext:modifyColumn>
	</changeSet>
	
	<changeSet id="201011011600" author="jkeiper" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="hl7_in_archive_message_state_idx" /></not>
		</preConditions>
		<comment>Adding index to message_state column in HL7 archive table</comment>
		<createIndex tableName="hl7_in_archive" indexName="hl7_in_archive_message_state_idx">
			<column name="message_state" />
		</createIndex>
	</changeSet>
		
	<changeSet id="201011011605" author="jkeiper">
		<comment>Moving "deleted" HL7s from HL7 archive table to queue table</comment>
		<customChange class="org.openmrs.util.databasechange.MoveDeletedHL7sChangeSet"/>				
	</changeSet>
	
	<changeSet id="20101209-1721" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_word" columnName="weight"/></not>
		</preConditions>
		<comment>Add 'weight' column to concept_word table</comment>
		<addColumn tableName="concept_word">
			<column name="weight" type="double" defaultValueNumeric="1" />
		</addColumn>
	</changeSet>
	
	<changeSet id="20101209-1722" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="concept_word_weight_index" /></not>
		</preConditions>
		<comment>Adding index to concept_word.weight column</comment>
		<createIndex tableName="concept_word" indexName="concept_word_weight_index">
			<column name="weight" />
		</createIndex>
	</changeSet>
		
	<changeSet id="20101209-1723" author="wyclif" dbms="mysql">
		<validCheckSum>db17937286d48f680b2be16bee24e62</validCheckSum> <!-- old checksum without specifying date_created -->
		<validCheckSum>4d67c48557f5665a8c2be7e87e22913</validCheckSum> <!-- current checksum with date_created property added -->
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				SELECT COUNT(*) FROM scheduler_task_config WHERE schedulable_class = 'org.openmrs.scheduler.tasks.ConceptIndexUpdateTask'
			</sqlCheck>
		</preConditions>
		<comment>Insert a row into the schedule_task_config table for the ConceptIndexUpdateTask</comment>
		<insert tableName="scheduler_task_config">
			<column name="name" value="Update Concept Index" />
			<column name="description" value="Iterates through the concept dictionary, re-creating the concept index (which are used for searcing). This task is started when using the 'Update Concept Index Storage' page and no range is given.  This task stops itself when one iteration has completed." />
			<column name="schedulable_class" value="org.openmrs.scheduler.tasks.ConceptIndexUpdateTask" />
			<column name="start_on_startup" valueNumeric="1" />
			<column name="date_created" valueDate="2005-01-01T00:00:00" />
			<column name="created_by" value="1" />
			<column name="uuid" value="7c75911e-0310-11e0-8222-18a905e044dc" />
		</insert>
	</changeSet>

	<changeSet id="20101209-1731" author="wyclif" dbms="mysql">
		<validCheckSum><comment>Using Correct BOOLEAN in update query</comment>3:6de3e859f77856fe939d3ae6a73b4752</validCheckSum>
		<validCheckSum>3:5b57be46af9578a59fb2b4f2af24c816</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="1">
				SELECT COUNT(*) FROM scheduler_task_config 
				WHERE schedulable_class = 'org.openmrs.scheduler.tasks.ConceptIndexUpdateTask' 
				AND start_on_startup = FALSE;
		</sqlCheck>
		</preConditions>
		<comment>Setting the value of 'start_on_startup' to trigger off conceptIndexUpdateTask on startup</comment>
		<update tableName="scheduler_task_config">
			<column name="start_on_startup" value="true" />
			<where>schedulable_class = 'org.openmrs.scheduler.tasks.ConceptIndexUpdateTask'</where>
		</update>
	</changeSet>

	<!-- TODO: https://source.openmrs.org/cru/CR-TRUNK-204#CFR-4477 -->
	<changeSet id="201012081716" author="nribeka" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="concept_derived" />
		</preConditions>
		<comment>Removing concept that are concept derived and the datatype</comment>
		<delete tableName="concept_derived" />
	</changeSet>
	
	<changeSet id="201012081717" author="nribeka" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="concept_derived" />
		</preConditions>
		<comment>Removing concept derived tables</comment>
		<dropTable tableName="concept_derived"/>
	</changeSet>
	
	<changeSet id="201011051300" author="bwolfe" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="alert_date_to_expire_idx" /></not>
		</preConditions>
		<comment>Adding index on notification_alert.date_to_expire column</comment>
		<createIndex tableName="notification_alert" indexName="alert_date_to_expire_idx">
			<column name="date_to_expire" />
		</createIndex>
	</changeSet>

	<changeSet id="20100603-1625-1-person_address" author="sapna" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_address" columnName="date_changed"/></not></preConditions>
		<comment>Adding "date_changed" column to person_address table</comment>
		<addColumn tableName="person_address">
			<column name="date_changed" type="DATETIME" />
		</addColumn>
	</changeSet>
	

	<changeSet id="20100603-1625-2-person_address" author="sapna" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_address" columnName="changed_by"/></not></preConditions>
		<comment>Adding "changed_by" column to person_address table</comment>
		<addColumn tableName="person_address">
			<column name="changed_by" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="person_address_changed_by"
			baseTableName="person_address" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	
	<changeSet id="20110218-1206" author="rubailly" dbms="mysql">
		<preConditions>
			<not>
				<columnExists tableName="patient_identifier_type"
					columnName="location_behavior" />
			</not>
		</preConditions>
		<comment>Add 'location_behavior' column to patient_identifier_type table</comment>
		<addColumn tableName="patient_identifier_type">
			<column name="location_behavior" type="varchar(50)">
				<constraints nullable="true" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="20110218-1210" author="rubailly" dbms="mysql">
		<comment>
			Drop Not-Null constraint from location_id column in patient_identifier table
		</comment>
		<dropNotNullConstraint tableName="patient_identifier"
			columnName="location_id" columnDataType="int" />
	</changeSet>

	<changeSet id="20101029-1016" author="gobi/prasann" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="concept_stop_word" />
			</not>
		</preConditions>
		<comment>Create table to store concept stop words to avoid in search key indexing</comment>
		<createTable tableName="concept_stop_word">
			<column name="concept_stop_word_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="word" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="locale" type="varchar(20)" defaultValue="en">
				<constraints nullable="false" />
			</column>
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"/>
			</column>
		</createTable>
		<addUniqueConstraint tableName="concept_stop_word"
			columnNames="word,locale" constraintName="Unique_StopWord_Key" />
	</changeSet>

	<changeSet id="20101029-1026" author="gobi/prasann" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">select count(*) from concept_stop_word where word = 'A'</sqlCheck>
		</preConditions>
		<comment>Inserting the initial concept stop words</comment>
		<insert tableName="concept_stop_word">
			<column name="word" value="A" />
			<column name="uuid" value="f5f45540-e2a7-11df-87ae-18a905e044dc" />
		</insert>
		<insert tableName="concept_stop_word">
			<column name="word" value="AND" />
			<column name="uuid" value="f5f469ae-e2a7-11df-87ae-18a905e044dc" />
		</insert>
		<insert tableName="concept_stop_word">
			<column name="word" value="AT" />
			<column name="uuid" value="f5f47070-e2a7-11df-87ae-18a905e044dc" />
		</insert>
		<insert tableName="concept_stop_word">
			<column name="word" value="BUT" />
			<column name="uuid" value="f5f476c4-e2a7-11df-87ae-18a905e044dc" />
		</insert>
		<insert tableName="concept_stop_word">
			<column name="word" value="BY" />
			<column name="uuid" value="f5f47d04-e2a7-11df-87ae-18a905e044dc" />
		</insert>
		<insert tableName="concept_stop_word">
			<column name="word" value="FOR" />
			<column name="uuid" value="f5f4834e-e2a7-11df-87ae-18a905e044dc" />
		</insert>
		<insert tableName="concept_stop_word">
			<column name="word" value="HAS" />
			<column name="uuid" value="f5f48a24-e2a7-11df-87ae-18a905e044dc" />
		</insert>
		<insert tableName="concept_stop_word">
			<column name="word" value="OF" />
			<column name="uuid" value="f5f49064-e2a7-11df-87ae-18a905e044dc" />
		</insert>
		<insert tableName="concept_stop_word">
			<column name="word" value="THE" />
			<column name="uuid" value="f5f496ae-e2a7-11df-87ae-18a905e044dc" />
		</insert>
		<insert tableName="concept_stop_word">
			<column name="word" value="TO" />
			<column name="uuid" value="f5f49cda-e2a7-11df-87ae-18a905e044dc" />
		</insert>
	</changeSet>
	
	<changeSet id="201118012301" author="lkellett" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="orders" columnName="discontinued_reason_non_coded"/></not>
		</preConditions>
		<comment>
			Adding the discontinued_reason_non_coded column to orders.  
		</comment>
		<addColumn tableName="orders">
			<column name="discontinued_reason_non_coded" type="varchar(255)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="20110125-1435" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="person_address" columnName="start_date"/></not>
		</preConditions>
		<comment>Adding 'start_date' column to person_address table</comment>
		<addColumn tableName="person_address">
			<column name="start_date" type="datetime" />
		</addColumn>
	</changeSet>
	
	<changeSet id="20110125-1436" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="person_address" columnName="end_date"/></not>
		</preConditions>
		<comment>Adding 'end_date' column to person_address table</comment>
		<addColumn tableName="person_address">
			<column name="end_date" type="datetime" />
		</addColumn>
	</changeSet>

	<changeSet id="20110201-1625-1" author="arahulkmit" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_identifier" columnName="date_changed"/></not></preConditions>
		<comment>Adding "date_changed" column to patient_identifier table</comment>
		<addColumn tableName="patient_identifier">
			<column name="date_changed" type="DATETIME" />
		</addColumn>
	</changeSet>

	<changeSet id="20110201-1625-2" author="arahulkmit" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_identifier" columnName="changed_by"/></not></preConditions>
		<comment>Adding "changed_by" column to patient_identifier table</comment>
		<addColumn tableName="patient_identifier">
			<column name="changed_by" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="patient_identifier_changed_by"
			baseTableName="patient_identifier" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
    
    <changeSet id="20110201-1626-1" author="arahulkmit">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="relationship" columnName="date_changed"/></not></preConditions>
		<comment>Adding "date_changed" column to relationship table</comment>
		<addColumn tableName="relationship">
			<column name="date_changed" type="DATETIME" />
		</addColumn>
	</changeSet>

	<changeSet id="20110201-1626-2" author="arahulkmit" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="relationship" columnName="changed_by"/></not></preConditions>
		<comment>Adding "changed_by" column to relationship table</comment>
		<addColumn tableName="relationship">
			<column name="changed_by" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="relationship_changed_by"
			baseTableName="relationship" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	
	<changeSet id="201101221453" author="suho" dbms="mysql">
		<comment>Increasing the serialized_data column of serialized_object to hold mediumtext</comment>
		<ext:modifyColumn tableName="serialized_object">
			<column name="serialized_data" type="mediumtext" >
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="201101121434" author="gbalaji,gobi" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="obs" columnName="date_started"/>
		</preConditions>
		<comment>Dropping unused date_started column from obs table</comment>
		<dropColumn tableName="obs" columnName="date_started"/>
	</changeSet>
	
	<changeSet id="201102081800" author="gbalaji,gobi" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="obs" columnName="date_stopped"/>			
		</preConditions>
		<comment>Dropping unused date_stopped column from obs table</comment>
		<dropColumn tableName="obs" columnName="date_stopped"/>
	</changeSet>
	
	<changeSet id="20110124-1030" author="surangak" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists
					foreignKeyName="answer_answer_drug_fk" />
			</not>
		</preConditions>
		<comment>Adding correct foreign key for concept_answer.answer_drug</comment>
		<addForeignKeyConstraint baseTableName="concept_answer"
			baseColumnNames="answer_drug" constraintName="answer_answer_drug_fk"
			referencedTableName="drug" referencedColumnNames="drug_id" />
	</changeSet>

	<changeSet id="201103011751" author="abbas">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="person_merge_log"/></not>
		</preConditions>
		<comment>
			Create the person_merge_log table
		</comment>
		<createTable tableName="person_merge_log">
			<column name="person_merge_log_id" type="int" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="winner_person_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="loser_person_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="creator" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false"/>
			</column>
			<column name="merged_data" type="text">
				<constraints nullable="false"/>
			</column>
			<column name="uuid" type="char(38)">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="person_merge_log_winner"
			baseTableName="person_merge_log" baseColumnNames="winner_person_id"
			referencedTableName="person" referencedColumnNames="person_id"
			/>
		<addForeignKeyConstraint constraintName="person_merge_log_loser"
			baseTableName="person_merge_log" baseColumnNames="loser_person_id"
			referencedTableName="person" referencedColumnNames="person_id"
			/>	
		<addForeignKeyConstraint constraintName="person_merge_log_creator"
			baseTableName="person_merge_log" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id"
			/>
    </changeSet>
    
	<changeSet id="20110329-2317" author="wyclif">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="role_privilege" />
		</preConditions>
		<comment>Removing 'View Encounters' privilege from Anonymous user</comment>
		<delete tableName="role_privilege">
			<where>role='Anonymous' AND privilege='View Encounters'</where>
		</delete>
	</changeSet>
	
	<changeSet id="20110329-2318" author="wyclif">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="role_privilege" />
		</preConditions>
		<comment>Removing 'View Observations' privilege from Anonymous user</comment>
		<delete tableName="role_privilege">
			<where>role='Anonymous' AND privilege='View Observations'</where>
		</delete>
	</changeSet>
	
	<changeSet id="20090224-1002-create-visit_type" author="dkayiwa" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="visit_type"/></not>
		</preConditions>
		<comment>
			Create visit type table
		</comment>
		<createTable tableName="visit_type">
			<column name="visit_type_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(1024)" />
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="creator" type="int" >
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime" >
				<constraints nullable="false"/>
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="tinyint" defaultValueNumeric="0">
				<constraints nullable="false"/>
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null"/>
		</createTable>
		<addForeignKeyConstraint constraintName="visit_type_creator"
			baseTableName="visit_type" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="visit_type_changed_by" 
			baseTableName="visit_type" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="visit_type_retired_by"
			baseTableName="visit_type" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id"/>
	</changeSet>
	
	<changeSet id="20100419-1209" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="visit" /> </not>
		</preConditions>
		<comment>
			Create the visit table and add the foreign key for visit_type
		</comment>
		<createTable tableName="visit">
			<column name="visit_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="patient_id" type="int"><constraints nullable="false" /></column>
			<column name="visit_type_id" type="int"><constraints nullable="false" /></column>
			<column name="date_started" type="datetime"> <constraints nullable="false" /> </column>
			<column name="date_stopped" type="datetime" />
			<column name="indication_concept_id" type="int" />
			<column name="location_id" type="int" />
			<column name="creator" type="int"><constraints nullable="false"/></column>
			<column name="date_created" type="datetime"><constraints nullable="false"/></column>
			<column name="changed_by" type="int"/>
			<column name="date_changed" type="datetime" />
			<column name="voided" type="smallint" defaultValueNumeric="0"><constraints nullable="false"/></column>
			<column name="voided_by" type="int" />
			<column name="date_voided" type="datetime" />
			<column name="void_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
		</createTable>
		<addForeignKeyConstraint constraintName="visit_type_fk"
			baseTableName="visit" baseColumnNames="visit_type_id"
			referencedTableName="visit_type" referencedColumnNames="visit_type_id" />
		<addForeignKeyConstraint constraintName="visit_location_fk"
			baseTableName="visit" baseColumnNames="location_id"
			referencedTableName="location" referencedColumnNames="location_id" />
		<addForeignKeyConstraint constraintName="visit_patient_fk"
			baseTableName="visit" baseColumnNames="patient_id"
			referencedTableName="patient" referencedColumnNames="patient_id" />
		<addForeignKeyConstraint constraintName="visit_creator_fk"
			baseTableName="visit" baseColumnNames="creator" referencedTableName="users"
			referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="visit_voided_by_fk"
			baseTableName="visit" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="visit_changed_by_fk"
			baseTableName="visit" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="visit_indication_concept_fk"
			baseTableName="visit" baseColumnNames="indication_concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id" />
		<createIndex tableName="visit" indexName="visit_patient_index">
			<column name="patient_id" />
		</createIndex>
	</changeSet>
	<changeSet id="20100419-1209-fix" author="sunbiz">
		<comment>(Fixed)Changed visit.voided to BOOLEAN</comment>
		<ext:modifyColumn tableName="visit">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20101209-10000-encounter-add-visit-id-column" author="dkayiwa" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="encounter" columnName="visit_id"/></not>
		</preConditions>
		<comment>Adding visit_id column to encounter table</comment>
		<addColumn tableName="encounter">
			<column name="visit_id" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="encounter_visit_id_fk"
			baseTableName="encounter" baseColumnNames="visit_id"
			referencedTableName="visit" referencedColumnNames="visit_id" />
	</changeSet>
	
	<changeSet id="201101271456-add-startdate-to-relationship" author="misha680" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="relationship" columnName="start_date"/></not>
		</preConditions>
		<comment>
			Adding the start_date column to relationship.  
		</comment>
		<addColumn tableName="relationship">
			<column name="start_date" type="datetime" defaultValue="null" />
		</addColumn>
	</changeSet>
	
	<changeSet id="201101271456-add-enddate-to-relationship" author="misha680" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="relationship" columnName="end_date"/></not>
		</preConditions>
		<comment>
			Adding the end_date column to relationship.  
		</comment>
		<addColumn tableName="relationship">
			<column name="end_date" type="datetime" defaultValue="null" />
		</addColumn>
	</changeSet>
	
    <changeSet id="20110425-1600-create-visit-attribute-type-table" author="djazayeri" dbms="mysql">
    	<validCheckSum>3:fbdd2c69187f89a0abc7f27ee138441a</validCheckSum>
    	<validCheckSum>3:3cf419ea9657f9a072881cafb2543d77</validCheckSum>
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="visit_attribute_type"/></not>
        </preConditions>
        <comment>Creating visit_attribute_type table</comment>
        <createTable tableName="visit_attribute_type">
            <column name="visit_attribute_type_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)"><constraints nullable="false"/></column>
            <column name="description" type="varchar(1024)"/>
            <column name="datatype" type="varchar(255)" />
            <column name="datatype_config" type="text" />
            <column name="preferred_handler" type="varchar(255)" />
            <column name="handler_config" type="text" />
            <column name="min_occurs" type="int"><constraints nullable="false" /></column>
            <column name="max_occurs" type="int"></column>
            <column name="creator" type="int"><constraints nullable="false"/></column>
            <column name="date_created" type="datetime"><constraints nullable="false"/></column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime" />
            <column name="retired" type="smallint" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="retired_by" type="int(11)" />
            <column name="date_retired" type="datetime" />
            <column name="retire_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
        </createTable>
        <addForeignKeyConstraint constraintName="visit_attribute_type_creator_fk"
            baseTableName="visit_attribute_type" baseColumnNames="creator" referencedTableName="users"
            referencedColumnNames="user_id" />
        <addForeignKeyConstraint constraintName="visit_attribute_type_changed_by_fk"
            baseTableName="visit_attribute_type" baseColumnNames="changed_by" referencedTableName="users"
            referencedColumnNames="user_id" />
        <addForeignKeyConstraint constraintName="visit_attribute_type_retired_by_fk"
            baseTableName="visit_attribute_type" baseColumnNames="retired_by" referencedTableName="users"
            referencedColumnNames="user_id" />
    </changeSet>
	<changeSet id="20110425-1600-create-visit-attribute-type-table-fix" author="sunbiz">
		<comment>(Fixed)Change visit_attribute_type.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="visit_attribute_type">
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
		
	<changeSet id="201110051353-fix-visit-attribute-type-columns" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="visit_attribute_type" columnName="datatype_config"/></not>
		</preConditions>
		<comment>Refactoring visit_attribute_type table (devs only)</comment>
		<addColumn tableName="visit_attribute_type">
			<column name="datatype_config" type="text" />
		</addColumn>
		<addColumn tableName="visit_attribute_type">
			<column name="preferred_handler" type="varchar(255)" />
		</addColumn>
	</changeSet>

    <changeSet id="20110425-1700-create-visit-attribute-table" author="djazayeri" dbms="mysql">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="visit_attribute"/></not>
        </preConditions>
        <comment>Creating visit_attribute table</comment>
        <createTable tableName="visit_attribute">
            <column name="visit_attribute_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="visit_id" type="int"><constraints nullable="false" /></column>
            <column name="attribute_type_id" type="int"><constraints nullable="false" /></column>
            <column name="value_reference" type="text"><constraints nullable="false" /></column>
            <column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
            <column name="creator" type="int"><constraints nullable="false"/></column>
            <column name="date_created" type="datetime"><constraints nullable="false"/></column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime" />
            <column name="voided" type="smallint" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int(11)" />
            <column name="date_voided" type="datetime" />
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
        </createTable>
        <addForeignKeyConstraint constraintName="visit_attribute_visit_fk"
            baseTableName="visit_attribute" baseColumnNames="visit_id" referencedTableName="visit"
            referencedColumnNames="visit_id" />
        <addForeignKeyConstraint constraintName="visit_attribute_attribute_type_id_fk"
            baseTableName="visit_attribute" baseColumnNames="attribute_type_id" referencedTableName="visit_attribute_type"
            referencedColumnNames="visit_attribute_type_id" />
        <addForeignKeyConstraint constraintName="visit_attribute_creator_fk"
            baseTableName="visit_attribute" baseColumnNames="creator" referencedTableName="users"
            referencedColumnNames="user_id" />
        <addForeignKeyConstraint constraintName="visit_attribute_changed_by_fk"
            baseTableName="visit_attribute" baseColumnNames="changed_by" referencedTableName="users"
            referencedColumnNames="user_id" />
        <addForeignKeyConstraint constraintName="visit_attribute_voided_by_fk"
            baseTableName="visit_attribute" baseColumnNames="voided_by" referencedTableName="users"
            referencedColumnNames="user_id" />
    </changeSet>
	<changeSet id="20110425-1700-create-visit-attribute-table-fix" author="sunbiz">
		<comment>(Fixed)Change visit_attribute.voided to BOOLEAN</comment>
		<ext:modifyColumn tableName="visit_attribute">
			<column name="voided" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>

    <changeSet id="201107192313-change-length-of-regex-column" author="jtellez" dbms="mysql">
		<preConditions onFail="HALT">
			<columnExists tableName="patient_identifier_type" columnName="format" />
		</preConditions>
		<comment>
			Increasing maximum length of patient identifier type regex format
		</comment>
		<ext:modifyColumn tableName="patient_identifier_type">
			<column name="format" type="varchar(255)" defaultValue="null"/>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20110926-1200" author="raff">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="concept_source"/>
			<not>
				<sqlCheck expectedResult="0">
	 	 	 		select count(*) from concept_source where hl7_code like ''
	 	 	 	</sqlCheck>
 	 	 	</not>
		</preConditions>
		<comment>
			Change all empty concept_source.hl7_code to NULL
		</comment>
		<sql>
			update concept_source set hl7_code = NULL where hl7_code like ''
		</sql>
	</changeSet>
	
	<changeSet id="20110708-2105" author="cta" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="concept_source_unique_hl7_codes" />
			</not>
		</preConditions>
		<comment>
			Add unique constraint to the concept_source table
		</comment>
		<addUniqueConstraint tableName="concept_source" columnNames="hl7_code" constraintName="concept_source_unique_hl7_codes"/>
	</changeSet>

	<changeSet id="2011-07-12-1947-add-outcomesConcept-to-program" author="grwarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="program" columnName="outcomes_concept_id"/>
			</not>
		</preConditions>
		<comment>
			Adding the outcomesConcept property to Program
		</comment>
		<addColumn tableName="program">
			<column name="outcomes_concept_id" type="int"/>
		</addColumn>
		<addForeignKeyConstraint constraintName="program_outcomes_concept_id_fk"
								 baseTableName="program" baseColumnNames="outcomes_concept_id"
								 referencedTableName="concept"
								 referencedColumnNames="concept_id"/>
	</changeSet>

	<changeSet id="2011-07-12-2005-add-outcome-to-patientprogram" author="grwarren" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="patient_program" columnName="outcome_concept_id"/>
			</not>
		</preConditions>
		<comment>
			Adding the outcome property to PatientProgram
		</comment>
		<addColumn tableName="patient_program">
			<column name="outcome_concept_id" type="int"/>
		</addColumn>
		<addForeignKeyConstraint constraintName="patient_program_outcome_concept_id_fk"
								 baseTableName="patient_program" baseColumnNames="outcome_concept_id"
								 referencedTableName="concept"
								 referencedColumnNames="concept_id"/>
	</changeSet>

	<changeSet id="20110817-1544-create-location-attribute-type-table" author="djazayeri" dbms="mysql">
		<validCheckSum>3:fb309279a3ba9fda3358361cf02244a8</validCheckSum>
		<validCheckSum>3:41fa30c01ec2d1107beccb8126146464</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="location_attribute_type" />
			</not>
		</preConditions>
		<comment>Creating location_attribute_type table</comment>
		<createTable tableName="location_attribute_type">
			<column name="location_attribute_type_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(1024)" />
			<column name="datatype" type="varchar(255)" />
            <column name="datatype_config" type="text" />
            <column name="preferred_handler" type="varchar(255)" />
            <column name="handler_config" type="text" />
			<column name="min_occurs" type="int">
				<constraints nullable="false" />
			</column>
			<column name="max_occurs" type="int"></column>
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int(11)" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="location_attribute_type_creator_fk"
			baseTableName="location_attribute_type" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="location_attribute_type_changed_by_fk"
			baseTableName="location_attribute_type" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="location_attribute_type_retired_by_fk"
			baseTableName="location_attribute_type" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	<changeSet id="20110817-1544-create-location-attribute-type-table-fix" author="sunbiz">
		<comment>(Fixed)Change visit_attribute.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="location_attribute_type">
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="201110072042-fix-location-attribute-type-columns" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="location_attribute_type" columnName="datatype_config"/></not>
		</preConditions>
		<comment>Refactoring location_attribute_type table (devs only)</comment>
		<addColumn tableName="location_attribute_type">
			<column name="datatype_config" type="text" />
		</addColumn>
		<addColumn tableName="location_attribute_type">
			<column name="preferred_handler" type="varchar(255)" />
		</addColumn>
	</changeSet>
	

    <changeSet id="20110817-1601-create-location-attribute-table" author="djazayeri">
        <validCheckSum>3:564e414d29bdccd1bf770252ccd11431</validCheckSum>
        <validCheckSum>3:c7cb1b35d68451d10badeb445df599b9</validCheckSum>
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="location_attribute"/></not>
        </preConditions>
        <comment>Creating location_attribute table</comment>
        <createTable tableName="location_attribute">
            <column name="location_attribute_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="location_id" type="int"><constraints nullable="false" /></column>
            <column name="attribute_type_id" type="int"><constraints nullable="false" /></column>
            <column name="value_reference" type="text"><constraints nullable="false" /></column>
            <column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
            <column name="creator" type="int"><constraints nullable="false"/></column>
            <column name="date_created" type="datetime"><constraints nullable="false"/></column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime" />
            <column name="voided" type="smallint" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int" />
            <column name="date_voided" type="datetime" />
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
        </createTable>
        <addForeignKeyConstraint constraintName="location_attribute_location_fk"
            baseTableName="location_attribute" baseColumnNames="location_id" referencedTableName="location"
            referencedColumnNames="location_id" />
        <addForeignKeyConstraint constraintName="location_attribute_attribute_type_id_fk"
            baseTableName="location_attribute" baseColumnNames="attribute_type_id" referencedTableName="location_attribute_type"
            referencedColumnNames="location_attribute_type_id" />
        <addForeignKeyConstraint constraintName="location_attribute_creator_fk"
            baseTableName="location_attribute" baseColumnNames="creator" referencedTableName="users"
            referencedColumnNames="user_id" />
        <addForeignKeyConstraint constraintName="location_attribute_changed_by_fk"
            baseTableName="location_attribute" baseColumnNames="changed_by" referencedTableName="users"
            referencedColumnNames="user_id" />
        <addForeignKeyConstraint constraintName="location_attribute_voided_by_fk"
            baseTableName="location_attribute" baseColumnNames="voided_by" referencedTableName="users"
            referencedColumnNames="user_id" />
    </changeSet>
	<changeSet id="20110817-1601-create-location-attribute-table-fix" author="sunbiz">
		<comment>(Fixed)Change visit_attribute.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="location_attribute">
			<column name="voided" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
    
	<changeSet id="201109301703" author="suho">
		<validCheckSum>3:5118bfbc227de5580786f6cce75b6347</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<and>
				<sqlCheck expectedResult="1">SELECT count(property_value) FROM global_property WHERE property =
					'layout.address.format'
				</sqlCheck>
				<not>
					<or>
						<sqlCheck expectedResult="spain">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="rw">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="rwanda">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="us">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="usa">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="ka">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="kenya">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="ls">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="lesotho">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="mw">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="malawi">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="tz">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
						<sqlCheck expectedResult="tanzania">SELECT LOWER(property_value)  FROM global_property WHERE property =
							'layout.address.format'
						</sqlCheck>
					</or>
				</not>
			</and>
		</preConditions>
		<comment>Converting general address format (if applicable)</comment>
		<update tableName="global_property">
			<column name="property_value" value="&lt;org.openmrs.layout.address.AddressTemplate&gt;&#10;
			&lt;nameMappings class=&quot;properties&quot;&gt;&#10;
			  &lt;property name=&quot;postalCode&quot; value=&quot;Location.postalCode&quot;/&gt;&#10;
			  &lt;property name=&quot;longitude&quot; value=&quot;Location.longitude&quot;/&gt;&#10;
			  &lt;property name=&quot;address2&quot; value=&quot;Location.address2&quot;/&gt;&#10;
			  &lt;property name=&quot;address1&quot; value=&quot;Location.address1&quot;/&gt;&#10;
			  &lt;property name=&quot;startDate&quot; value=&quot;PersonAddress.startDate&quot;/&gt;&#10;
			  &lt;property name=&quot;country&quot; value=&quot;Location.country&quot;/&gt;&#10;
			  &lt;property name=&quot;endDate&quot; value=&quot;personAddress.endDate&quot;/&gt;&#10;
			  &lt;property name=&quot;stateProvince&quot; value=&quot;Location.stateProvince&quot;/&gt;&#10;
			  &lt;property name=&quot;latitude&quot; value=&quot;Location.latitude&quot;/&gt;&#10;
			  &lt;property name=&quot;cityVillage&quot; value=&quot;Location.cityVillage&quot;/&gt;&#10;
			&lt;/nameMappings&gt;&#10;
			&lt;sizeMappings class=&quot;properties&quot;&gt;&#10;
			  &lt;property name=&quot;postalCode&quot; value=&quot;10&quot;/&gt;&#10;
			  &lt;property name=&quot;longitude&quot; value=&quot;10&quot;/&gt;&#10;
			  &lt;property name=&quot;address2&quot; value=&quot;40&quot;/&gt;&#10;
			  &lt;property name=&quot;address1&quot; value=&quot;40&quot;/&gt;&#10;
			  &lt;property name=&quot;startDate&quot; value=&quot;10&quot;/&gt;&#10;
			  &lt;property name=&quot;country&quot; value=&quot;10&quot;/&gt;&#10;
			  &lt;property name=&quot;endDate&quot; value=&quot;10&quot;/&gt;&#10;
			  &lt;property name=&quot;stateProvince&quot; value=&quot;10&quot;/&gt;&#10;
			  &lt;property name=&quot;latitude&quot; value=&quot;10&quot;/&gt;&#10;
			  &lt;property name=&quot;cityVillage&quot; value=&quot;10&quot;/&gt;&#10;
			&lt;/sizeMappings&gt;&#10;
			&lt;lineByLineFormat&gt;&#10;
			  &lt;string&gt;address1&lt;/string&gt;&#10;
			  &lt;string&gt;address2&lt;/string&gt;&#10;
			  &lt;string&gt;cityVillage stateProvince country postalCode&lt;/string&gt;&#10;
			  &lt;string&gt;latitude longitude&lt;/string&gt;&#10;
			  &lt;string&gt;startDate endDate&lt;/string&gt;&#10;
			&lt;/lineByLineFormat&gt;&#10;
		  &lt;/org.openmrs.layout.address.AddressTemplate&gt;"/>
			<column name="description" value="XML description of address formats"/>
			<where>property = 'layout.address.format'</where>
		</update>
	</changeSet>

	<changeSet id="201109301704" author="suho">
		<validCheckSum>3:6dda0cc75bebb1cbb6c67a3c462a7878</validCheckSum>
		<preConditions onFail="MARK_RAN">
				<and>
					<sqlCheck expectedResult="1">SELECT count(property_value) FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
					<sqlCheck expectedResult="spain">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
				</and>
		</preConditions>
		<comment>Converting Spain address format (if applicable)</comment>
		<update tableName="global_property">
			<column name="property_value" value="&lt;org.openmrs.layout.address.AddressTemplate&gt;&#10;
					&lt;nameMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address2&quot; value=&quot;Location.address2&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;Location.stateProvince&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;Location.address1&quot;/&gt;&#10;
					 &lt;property name=&quot;longitude&quot; value=&quot;Location.longitude&quot;/&gt;&#10;
					 &lt;property name=&quot;postalCode&quot; value=&quot;Location.postalCode&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;Location.cityVillage&quot;/&gt;&#10;
					 &lt;property name=&quot;country&quot; value=&quot;Location.country&quot;/&gt;&#10;
					 &lt;property name=&quot;latitude&quot; value=&quot;Location.latitude&quot;/&gt;&#10;
					&lt;/nameMappings&gt;&#10;
					&lt;sizeMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address2&quot; value=&quot;40&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;10&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;40&quot;/&gt;&#10;
					 &lt;property name=&quot;longitude&quot; value=&quot;10&quot;/&gt;&#10;
					 &lt;property name=&quot;postalCode&quot; value=&quot;10&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;10&quot;/&gt;&#10;
					 &lt;property name=&quot;country&quot; value=&quot;10&quot;/&gt;&#10;
					 &lt;property name=&quot;latitude&quot; value=&quot;10&quot;/&gt;&#10;
					&lt;/sizeMappings&gt;&#10;
					&lt;lineByLineFormat&gt;&#10;
					 &lt;string&gt;address1&lt;/string&gt;&#10;
					 &lt;string&gt;address2&lt;/string&gt;&#10;
					 &lt;string&gt;cityVillage stateProvince country postalCode&lt;/string&gt;&#10;
					 &lt;string&gt;latitude longitude&lt;/string&gt;&#10;
					&lt;/lineByLineFormat&gt;&#10;
				 &lt;/org.openmrs.layout.address.AddressTemplate&gt;"/>
			<column name="description" value="XML description of address formats"/>
			<where>property = 'layout.address.format'</where>
		</update>
	</changeSet>

	<changeSet id="201109301705" author="suho">
		<validCheckSum>3:464ccc7834881a26600aa995aa175d57</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<and>
				<sqlCheck expectedResult="1">SELECT count(property_value) FROM global_property WHERE property =
						'layout.address.format'
				</sqlCheck>
				<or>
					<sqlCheck expectedResult="rw">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
					<sqlCheck expectedResult="rwanda">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
				</or>
			</and>
		</preConditions>
		<comment>Converting Rwanda address format (if applicable)</comment>
		<update tableName="global_property">
			<column name="property_value" value="&lt;org.openmrs.layout.address.AddressTemplate&gt;&#10;
					&lt;nameMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address3&quot; value=&quot;Location.cell&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;Location.province&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;Location.rwandanNeighborhood&quot;/&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;Location.district&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;Location.sector&quot;/&gt;&#10;
					&lt;/nameMappings&gt;&#10;
					&lt;sizeMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address3&quot; value=&quot;40&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;40&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;40&quot;/&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;40&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;40&quot;/&gt;&#10;
					&lt;/sizeMappings&gt;&#10;
					&lt;elementDefaults class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;country&quot; value=&quot;Rwanda&quot;/&gt;&#10;
					&lt;/elementDefaults&gt;&#10;
					&lt;lineByLineFormat&gt;&#10;
					 &lt;string&gt;stateProvince&lt;/string&gt;&#10;
					 &lt;string&gt;countyDistrict&lt;/string&gt;&#10;
					 &lt;string&gt;cityVillage&lt;/string&gt;&#10;
					 &lt;string&gt;address3&lt;/string&gt;&#10;
					 &lt;string&gt;address1&lt;/string&gt;&#10;
					&lt;/lineByLineFormat&gt;&#10;
				 &lt;/org.openmrs.layout.address.AddressTemplate&gt;"/>
			<column name="description" value="XML description of address formats"/>
			<where>property = 'layout.address.format'</where>
		</update>
	</changeSet>

	<changeSet id="201109301706" author="suho">
		<validCheckSum>3:7c654c2e26d9c89e8a405e5e39c86143</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<and>
				<sqlCheck expectedResult="1">SELECT count(property_value) FROM global_property WHERE property =
						'layout.address.format'
				</sqlCheck>
				<or>
					<sqlCheck expectedResult="us">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
					<sqlCheck expectedResult="usa">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
				</or>
			</and>
		</preConditions>
		<comment>Converting USA address format (if applicable)</comment>
		<update tableName="global_property">
			<column name="property_value" value="&lt;org.openmrs.layout.address.AddressTemplate&gt;&#10;
					&lt;nameMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address2&quot; value=&quot;Location.address2&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;Location.state&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;Location.address1&quot;/&gt;&#10;
					 &lt;property name=&quot;postalCode&quot; value=&quot;Location.zipCode&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;Location.city&quot;/&gt;&#10;
					&lt;/nameMappings&gt;&#10;
					&lt;sizeMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address2&quot; value=&quot;50&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;2&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;50&quot;/&gt;&#10;
					 &lt;property name=&quot;postalCode&quot; value=&quot;10&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;20&quot;/&gt;&#10;
					&lt;/sizeMappings&gt;&#10;
					&lt;elementDefaults class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;country&quot; value=&quot;USA&quot;/&gt;&#10;
					&lt;/elementDefaults&gt;&#10;
					&lt;lineByLineFormat&gt;&#10;
					 &lt;string&gt;address1&lt;/string&gt;&#10;
					 &lt;string&gt;address2&lt;/string&gt;&#10;
					 &lt;string&gt;cityVillage stateProvince postalCode&lt;/string&gt;&#10;
					&lt;/lineByLineFormat&gt;&#10;
					&lt;/org.openmrs.layout.address.AddressTemplate&gt;"/>
			<column name="description" value="XML description of address formats"/>
			<where>property = 'layout.address.format'</where>
		</update>
	</changeSet>

	<changeSet id="201109301707" author="suho">
		<validCheckSum>3:16443a97b649b95129f4df95ef2772e7</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<and>
				<sqlCheck expectedResult="1">SELECT count(property_value) FROM global_property WHERE property =
						'layout.address.format'
				</sqlCheck>
				<or>
					<sqlCheck expectedResult="ka">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
					<sqlCheck expectedResult="kenya">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
				</or>
			</and>
		</preConditions>
		<comment>Converting Kenya address format (if applicable)</comment>
		<update tableName="global_property">
			<column name="property_value" value="&lt;org.openmrs.layout.address.AddressTemplate&gt;&#10;
					&lt;nameMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;postalCode&quot; value=&quot;Location.postalCode&quot;/&gt;&#10;
					 &lt;property name=&quot;longitude&quot; value=&quot;Location.longitude&quot;/&gt;&#10;
					 &lt;property name=&quot;address3&quot; value=&quot;Location.estateNearestCentre&quot;/&gt;&#10;
					 &lt;property name=&quot;address2&quot; value=&quot;Location.sectionHomestead&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;Location.address1&quot;/&gt;&#10;
					 &lt;property name=&quot;country&quot; value=&quot;Location.country&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;Location.province&quot;/&gt;&#10;
					 &lt;property name=&quot;latitude&quot; value=&quot;Location.latitude&quot;/&gt;&#10;
					 &lt;property name=&quot;address6&quot; value=&quot;Location.location&quot;/&gt;&#10;
					 &lt;property name=&quot;address5&quot; value=&quot;Location.sublocation&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;Location.townVillage&quot;/&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;Location.district&quot;/&gt;&#10;
					 &lt;property name=&quot;address4&quot; value=&quot;Location.division&quot;/&gt;&#10;
					&lt;/nameMappings&gt;&#10;
					&lt;sizeMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;postalCode&quot; value=&quot;6&quot;/&gt;&#10;
					 &lt;property name=&quot;longitude&quot; value=&quot;10&quot;/&gt;&#10;
					 &lt;property name=&quot;address3&quot; value=&quot;24&quot;/&gt;&#10;
					 &lt;property name=&quot;address2&quot; value=&quot;55&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;55&quot;/&gt;&#10;
					 &lt;property name=&quot;country&quot; value=&quot;10&quot;/&gt;&#10;
					 &lt;property name=&quot;townshipDivision&quot; value=&quot;24&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;24&quot;/&gt;&#10;
					 &lt;property name=&quot;subregion&quot; value=&quot;24&quot;/&gt;&#10;
					 &lt;property name=&quot;latitude&quot; value=&quot;10&quot;/&gt;&#10;
					 &lt;property name=&quot;region&quot; value=&quot;24&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;24&quot;/&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;24&quot;/&gt;&#10;
					&lt;/sizeMappings&gt;&#10;
					&lt;elementDefaults class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;country&quot; value=&quot;Kenya&quot;/&gt;&#10;
					&lt;/elementDefaults&gt;&#10;
					&lt;elementRegex class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;longitude&quot; value=&quot;^(\\d{1,3}\\s)\\d\\d.(\\d{2,3})\\s*$&quot;/&gt;&#10;
					 &lt;property name=&quot;latitude&quot; value=&quot;^(\\d{1,3}\\s)\\d\\d.(\\d{2,3})\\s*$&quot;/&gt;&#10;
					&lt;/elementRegex&gt;&#10;
					&lt;elementRegexFormats class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;longitude&quot; value=&quot;123 45.000&quot;/&gt;&#10;
					 &lt;property name=&quot;latitude&quot; value=&quot;123 45.000&quot;/&gt;&#10;
					&lt;/elementRegexFormats&gt;&#10;
					&lt;lineByLineFormat&gt;&#10;
					 &lt;string&gt;address1&lt;/string&gt;&#10;
					 &lt;string&gt;address2&lt;/string&gt;&#10;
					 &lt;string&gt;address3 cityVillage&lt;/string&gt;&#10;
					 &lt;string&gt;address5 address6&lt;/string&gt;&#10;
					 &lt;string&gt;address4 countyDistrict&lt;/string&gt;&#10;
					 &lt;string&gt;stateProvince postalCode&lt;/string&gt;&#10;
					 &lt;string&gt;latitude longitude&lt;/string&gt;&#10;
					 &lt;string&gt;country&lt;/string&gt;&#10;
					&lt;/lineByLineFormat&gt;&#10;
			  &lt;/org.openmrs.layout.address.AddressTemplate&gt;"/>
			<column name="description" value="XML description of address formats"/>
			<where>property = 'layout.address.format'</where>
		</update>
	</changeSet>

	<changeSet id="201109301708" author="suho">
		<validCheckSum>3:c0a63cb8054a29ae8a46949d0a025fe0</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<and>
				<sqlCheck expectedResult="1">SELECT count(property_value) FROM global_property WHERE property =
						'layout.address.format'
				</sqlCheck>
				<or>
					<sqlCheck expectedResult="ls">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
					<sqlCheck expectedResult="lesotho">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
				</or>
			</and>
		</preConditions>
		<comment>Converting Lesotho address format (if applicable)</comment>
		<update tableName="global_property">
			<column name="property_value" value="&lt;org.openmrs.layout.address.AddressTemplate&gt;&#10;
					&lt;nameMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;Location.district&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;Location.village&quot;/&gt;&#10;
					&lt;/nameMappings&gt;&#10;
					&lt;sizeMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;40&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;40&quot;/&gt;&#10;
					&lt;/sizeMappings&gt;&#10;
					&lt;elementDefaults class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;country&quot; value=&quot;Lesotho&quot;/&gt;&#10;
					&lt;/elementDefaults&gt;&#10;
					&lt;lineByLineFormat&gt;&#10;
					 &lt;string&gt;&#10;countyDistrict&lt;/string&gt;&#10;
					 &lt;string&gt;&#10;cityVillage&lt;/string&gt;&#10;
					&lt;/lineByLineFormat&gt;&#10;
				&lt;/org.openmrs.layout.address.AddressTemplate&gt;"/>
			<column name="description" value="XML description of address formats"/>
			<where>property = 'layout.address.format'</where>
		</update>
	</changeSet>

	<changeSet id="201109301709" author="suho">
		<validCheckSum>3:c477d196658523a0ec8b477a1750c2f3</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<and>
				<sqlCheck expectedResult="1">SELECT count(property_value) FROM global_property WHERE property =
						'layout.address.format'
				</sqlCheck>
				<or>
					<sqlCheck expectedResult="mw">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
					<sqlCheck expectedResult="malawi">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
				</or>
			</and>
		</preConditions>
		<comment>Converting Malawi address format (if applicable)</comment>
		<update tableName="global_property">
			<column name="property_value" value="&lt;org.openmrs.layout.address.AddressTemplate&gt;&#10;
					&lt;nameMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address3&quot; value=&quot;Location.neighborhood&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;Location.district&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;Location.address1&quot;/&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;Location.traditionalAuthority&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;Location.village&quot;/&gt;&#10;
					&lt;/nameMappings&gt;&#10;
					&lt;sizeMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address3&quot; value=&quot;20&quot;/&gt;&#10;
					 &lt;property name=&quot;stateProvince&quot; value=&quot;20&quot;/&gt;&#10;
					 &lt;property name=&quot;address1&quot; value=&quot;40&quot;/&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;20&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;20&quot;/&gt;&#10;
					&lt;/sizeMappings&gt;&#10;
					&lt;elementDefaults class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;country&quot; value=&quot;Malawi&quot;/&gt;&#10;
					&lt;/elementDefaults&gt;&#10;
					&lt;lineByLineFormat&gt;&#10;
					 &lt;string&gt;address1&lt;/string&gt;&#10;
					 &lt;string&gt;address3&lt;/string&gt;&#10;
					 &lt;string&gt;cityVillage&lt;/string&gt;&#10;
					 &lt;string&gt;countyDistrict&lt;/string&gt;&#10;
					 &lt;string&gt;stateProvince&lt;/string&gt;&#10;
					&lt;/lineByLineFormat&gt;&#10;
				 &lt;/org.openmrs.layout.address.AddressTemplate&gt;"/>
			<column name="description" value="XML description of address formats"/>
			<where>property = 'layout.address.format'</where>
		</update>
	</changeSet>

	<changeSet id="201109301710" author="suho">
		<validCheckSum>3:a52f8e9920c42fd31df171e05bd0d91c</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<and>
				<sqlCheck expectedResult="1">SELECT count(property_value) FROM global_property WHERE property =
						'layout.address.format'
				</sqlCheck>
				<or>
					<sqlCheck expectedResult="tz">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
					<sqlCheck expectedResult="tanzania">SELECT LOWER(property_value)  FROM global_property WHERE property =
						'layout.address.format'
					</sqlCheck>
				</or>
			</and>
		</preConditions>
		<comment>Converting Tanzania address format (if applicable)</comment>
		<update tableName="global_property">
			<column name="property_value" value="&lt;org.openmrs.layout.address.AddressTemplate&gt;&#10;
					&lt;nameMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address6&quot; value=&quot;Location.region&quot;/&gt;&#10;
					 &lt;property name=&quot;address5&quot; value=&quot;Location.ward&quot;/&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;Location.district&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;Location.villageStreet&quot;/&gt;&#10;
					&lt;/nameMappings&gt;&#10;
					&lt;sizeMappings class=&quot;properties&quot;&gt;&#10;
					 &lt;property name=&quot;address6&quot; value=&quot;14&quot;/&gt;&#10;
					 &lt;property name=&quot;address5&quot; value=&quot;22&quot;/&gt;&#10;
					 &lt;property name=&quot;countyDistrict&quot; value=&quot;17&quot;/&gt;&#10;
					 &lt;property name=&quot;cityVillage&quot; value=&quot;50&quot;/&gt;&#10;
					&lt;/sizeMappings&gt;&#10;
					&lt;lineByLineFormat&gt;&#10;
					 &lt;string&gt;cityVillage&lt;/string&gt;&#10;
					 &lt;string&gt;address5&lt;/string&gt;&#10;
					 &lt;string&gt;countyDistrict&lt;/string&gt;&#10;
					 &lt;string&gt;address6&lt;/string&gt;&#10;
					&lt;/lineByLineFormat&gt;&#10;
				 &lt;/org.openmrs.layout.address.AddressTemplate&gt;"/>
			<column name="description" value="XML description of address formats"/>
			<where>property = 'layout.address.format'</where>
		</update>
	</changeSet>
	
	<changeSet id="20110301-1030a" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<and>
				<not><tableExists tableName="concept_reference_source" /></not>
			</and>
		</preConditions>
		<comment>Renaming the concept_source table to concept_reference_source</comment>
		<renameTable oldTableName="concept_source" newTableName="concept_reference_source"/>
	</changeSet>
	
	<changeSet id="20110301-1030b" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="concept_reference_term" /></not>
		</preConditions>
		<comment>Adding concept_reference_term table</comment>
		<createTable tableName="concept_reference_term">
			<column name="concept_reference_term_id" type="int" autoIncrement="true" >
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="concept_source_id" type="int"><constraints nullable="false"/></column>			
			<column name="name" type="varchar(255)" />
			<column name="code" type="varchar(255)"><constraints nullable="false"/></column>
			<column name="version" type="varchar(255)" />
			<column name="description" type="varchar(255)" />
			<column name="creator" type="int"><constraints nullable="false"/></column>
			<column name="date_created" type="DATETIME"><constraints nullable="false"/></column>
			<column name="date_changed" type="DATETIME" />
			<column name="changed_by" type="int"/>
			<column name="retired" type="smallint" defaultValueNumeric="0"><constraints nullable="false"/></column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="DATETIME" />
			<column name="retire_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
		</createTable>
		<addForeignKeyConstraint constraintName="mapped_user_creator" 
			referencedTableName="users" referencedColumnNames="user_id" 
			baseTableName="concept_reference_term" baseColumnNames="creator" />
		<addForeignKeyConstraint constraintName="mapped_user_changed" 
			referencedTableName="users" referencedColumnNames="user_id" 
			baseTableName="concept_reference_term" baseColumnNames="changed_by" />
		<addForeignKeyConstraint constraintName="mapped_user_retired" 
			referencedTableName="users" referencedColumnNames="user_id" 
			baseTableName="concept_reference_term" baseColumnNames="retired_by" />
		<addForeignKeyConstraint constraintName="mapped_concept_source" 
			referencedTableName="concept_reference_source" referencedColumnNames="concept_source_id" 
			baseTableName="concept_reference_term" baseColumnNames="concept_source_id" />
	</changeSet>
	<changeSet id="20110301-1030b-fix" author="sunbiz">
		<comment>(Fixed)Change concept_reference_term.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="concept_reference_term">
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20110301-1030c" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="concept_map_type" /></not>
		</preConditions>
		<comment>Adding concept_map_type table</comment>
		<createTable tableName="concept_map_type">
			<column name="concept_map_type_id" type="int" autoIncrement="true" >
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="name" type="varchar(255)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="description" type="varchar(255)" />
			<column name="creator" type="int"><constraints nullable="false"/></column>
			<column name="date_created" type="DATETIME"><constraints nullable="false"/></column>
			<column name="changed_by" type="int"/>
			<column name="date_changed" type="DATETIME" />
			<column name="isHidden" type="smallint" defaultValueNumeric="0"><constraints nullable="false"/></column>
			<column name="retired" type="smallint" defaultValueNumeric="0"><constraints nullable="false"/></column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="DATETIME" />
			<column name="retire_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
		</createTable>
		<addForeignKeyConstraint constraintName="mapped_user_creator_concept_map_type" 
			referencedTableName="users" referencedColumnNames="user_id" 
			baseTableName="concept_map_type" baseColumnNames="creator" />
		<addForeignKeyConstraint constraintName="mapped_user_changed_concept_map_type" 
			referencedTableName="users" referencedColumnNames="user_id" 
			baseTableName="concept_map_type" baseColumnNames="changed_by" />
		<addForeignKeyConstraint constraintName="mapped_user_retired_concept_map_type" 
			referencedTableName="users" referencedColumnNames="user_id" 
			baseTableName="concept_map_type" baseColumnNames="retired_by" />
	</changeSet>
	<changeSet id="20110301-1030c-fix" author="sunbiz">
		<preConditions onFail="MARK_RAN"><columnExists tableName="concept_map_type" columnName="isHidden"/></preConditions>
		<comment>(Fixed)Change concept_map_type.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="concept_map_type">
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_map_type">
			<column name="isHidden" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20110301-1030d" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<and>
				<not><tableExists tableName="concept_reference_map" /></not>
			</and>
		</preConditions>
		<comment>Renaming the concept_map table to concept_reference_map</comment>
		<renameTable oldTableName="concept_map" newTableName="concept_reference_map"/>
	</changeSet>
	
	<changeSet id="20110301-1030e" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_reference_map" columnName="concept_reference_term_id" /></not>
		</preConditions>
		<comment>Adding concept_reference_term_id column to concept_reference_map table</comment>
		<addColumn tableName="concept_reference_map">
			<column name="concept_reference_term_id" type="int"><constraints nullable="false"/></column>
		</addColumn>
	</changeSet>
	
	<changeSet id="20110919-0638" author="sunbiz">
		<preConditions onFail="MARK_RAN"><columnExists tableName="concept_map_type" columnName="isHidden"/></preConditions>
		<comment>Renaming concept_map_type.isHidden to is_hidden</comment>
		<renameColumn tableName="concept_map_type" oldColumnName="isHidden" newColumnName="is_hidden" columnDataType="boolean"/>
	</changeSet>
	
	<changeSet id="20110301-1030f" author="wyclif" dbms="mysql">
		<validCheckSum><comment>Initial version with random UUIDs</comment>3:97128f92a883840dc2ba1a55a01cd4a3</validCheckSum>
		<validCheckSum><comment>Corrected version with predefined UUIDs</comment>3:5faead5506cbcde69490fef985711d66</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="concept_map_type" />
			<sqlCheck expectedResult="0">select count(*) from concept_map_type</sqlCheck>
		</preConditions>
		<comment>Inserting core concept map types</comment>
		<customChange class="org.openmrs.util.databasechange.AddConceptMapTypesChangeset">
			<param name="visibleConceptMapTypes">
				SAME-AS|35543629-7d8c-11e1-909d-c80aa9edcf4e, NARROWER-THAN|43ac5109-7d8c-11e1-909d-c80aa9edcf4e, BROADER-THAN|4b9d9421-7d8c-11e1-909d-c80aa9edcf4e, 
				Associated finding|55e02065-7d8c-11e1-909d-c80aa9edcf4e, Associated morphology|605f4a61-7d8c-11e1-909d-c80aa9edcf4e, 
				Associated procedure|6eb1bfce-7d8c-11e1-909d-c80aa9edcf4e, Associated with|781bdc8f-7d8c-11e1-909d-c80aa9edcf4e, 
				Causative agent|808f9e19-7d8c-11e1-909d-c80aa9edcf4e, Finding site|889c3013-7d8c-11e1-909d-c80aa9edcf4e, 
				Has specimen|929600b9-7d8c-11e1-909d-c80aa9edcf4e, Laterality|999c6fc0-7d8c-11e1-909d-c80aa9edcf4e, Severity|a0e52281-7d8c-11e1-909d-c80aa9edcf4e
			</param>
			<param name="hiddenConceptMapTypes">
				Access|f9e90b29-7d8c-11e1-909d-c80aa9edcf4e, After|01b60e29-7d8d-11e1-909d-c80aa9edcf4e, Clinical course|5f7c3702-7d8d-11e1-909d-c80aa9edcf4e, 
				Component|67debecc-7d8d-11e1-909d-c80aa9edcf4e, Direct device|718c00da-7d8d-11e1-909d-c80aa9edcf4e, 
				Direct morphology|7b9509cb-7d8d-11e1-909d-c80aa9edcf4e, Direct substance|82bb495d-7d8d-11e1-909d-c80aa9edcf4e, 
				Due to|8b77f7d3-7d8d-11e1-909d-c80aa9edcf4e, Episodicity|94a81179-7d8d-11e1-909d-c80aa9edcf4e, 
				Finding context|9d23c22e-7d8d-11e1-909d-c80aa9edcf4e, Finding informer|a4524368-7d8d-11e1-909d-c80aa9edcf4e, 
				Finding method|af089254-7d8d-11e1-909d-c80aa9edcf4e, Has active ingredient|b65aa605-7d8d-11e1-909d-c80aa9edcf4e, 
				Has definitional manifestation|c2b7b2fa-7d8d-11e1-909d-c80aa9edcf4,	Has dose form|cc3878e6-7d8d-11e1-909d-c80aa9edcf4e, 
				Has focus|d67c5840-7d8d-11e1-909d-c80aa9edcf4e, Has intent|de2fb2c5-7d8d-11e1-909d-c80aa9edcf4e, 
				Has interpretation|e758838b-7d8d-11e1-909d-c80aa9edcf4e, Indirect device|ee63c142-7d8d-11e1-909d-c80aa9edcf4e, 
				Indirect morphology|f4f36681-7d8d-11e1-909d-c80aa9edcf4e, Interprets|fc7f5fed-7d8d-11e1-909d-c80aa9edcf4e, 
				Measurement method|06b11d79-7d8e-11e1-909d-c80aa9edcf4e, Method|0efb4753-7d8e-11e1-909d-c80aa9edcf4e, 
				Occurrence|16e7b617-7d8e-11e1-909d-c80aa9edcf4e, Part of|1e82007b-7d8e-11e1-909d-c80aa9edcf4e, 
				Pathological process|2969915e-7d8e-11e1-909d-c80aa9edcf4e, Priority|32d57796-7d8e-11e1-909d-c80aa9edcf4e, 
				Procedure context|3f11904c-7d8e-11e1-909d-c80aa9edcf4e, Procedure device|468c4aa3-7d8e-11e1-909d-c80aa9edcf4e, 
				Procedure morphology|5383e889-7d8e-11e1-909d-c80aa9edcf4e, Procedure site|5ad2655d-7d8e-11e1-909d-c80aa9edcf4e, 
				Procedure site - Direct|66085196-7d8e-11e1-909d-c80aa9edcf4e, Procedure site - Indirect|7080e843-7d8e-11e1-909d-c80aa9edcf4e, 
				Property|76bfb796-7d8e-11e1-909d-c80aa9edcf4e, Recipient category|7e7d00e4-7d8e-11e1-909d-c80aa9edcf4e, 
				Revision status|851e14c1-7d8e-11e1-909d-c80aa9edcf4e, Route of administration|8ee5b13d-7d8e-11e1-909d-c80aa9edcf4e, 
				Scale type|986acf48-7d8e-11e1-909d-c80aa9edcf4e, Specimen procedure|a6937642-7d8e-11e1-909d-c80aa9edcf4e, 
				Specimen source identity|b1d6941e-7d8e-11e1-909d-c80aa9edcf4e, Specimen source morphology|b7c793c1-7d8e-11e1-909d-c80aa9edcf4e, 
				Specimen source topography|be9f9eb8-7d8e-11e1-909d-c80aa9edcf4e, Specimen substance|c8f2bacb-7d8e-11e1-909d-c80aa9edcf4e, 
				Subject of information|d0664c4f-7d8e-11e1-909d-c80aa9edcf4e, Subject relationship context|dace9d13-7d8e-11e1-909d-c80aa9edcf4e, 
				Surgical approach|e3cd666d-7d8e-11e1-909d-c80aa9edcf4e, Temporal context|ed96447d-7d8e-11e1-909d-c80aa9edcf4e, 
				Time aspect|f415bcce-7d8e-11e1-909d-c80aa9edcf4e, Using access device|fa9538a9-7d8e-11e1-909d-c80aa9edcf4e, 
				Using device|06588655-7d8f-11e1-909d-c80aa9edcf4e, Using energy|0c2ae0bc-7d8f-11e1-909d-c80aa9edcf4e, 
				Using substance|13d2c607-7d8f-11e1-909d-c80aa9edcf4e, IS A|1ce7a784-7d8f-11e1-909d-c80aa9edcf4e, 
				MAY BE A|267812a3-7d8f-11e1-909d-c80aa9edcf4e, MOVED FROM|2de3168e-7d8f-11e1-909d-c80aa9edcf4e,
				MOVED TO|32f0fd99-7d8f-11e1-909d-c80aa9edcf4e, REPLACED BY|3b3b9a7d-7d8f-11e1-909d-c80aa9edcf4e, WAS A|41a034da-7d8f-11e1-909d-c80aa9edcf4e
			</param>
		</customChange>
	</changeSet>
	
	<changeSet id="20110301-1030g" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<and>
				<not><columnExists tableName="concept_reference_map" columnName="concept_map_type_id" /></not>
			</and>
		</preConditions>
		<comment>Adding concept_map_type_id column and a foreign key constraint to concept_reference_map table</comment>
		<addColumn tableName="concept_reference_map">
			<column name="concept_map_type_id" type="int" defaultValue="1"><constraints nullable="false"/></column>
		</addColumn>
		<addForeignKeyConstraint constraintName="mapped_concept_map_type" 
			referencedTableName="concept_map_type" referencedColumnNames="concept_map_type_id" 
			baseTableName="concept_reference_map" baseColumnNames="concept_map_type_id" />
	</changeSet>
	
	<changeSet id="20110301-1030h" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<and>
				<not><columnExists tableName="concept_reference_map" columnName="changed_by" /></not>
			</and>
		</preConditions>
		<comment>Adding changed_by column and a foreign key constraint to concept_reference_map table</comment>
		<addColumn tableName="concept_reference_map">
			<column name="changed_by" type="int"/>
		</addColumn>
		<addForeignKeyConstraint constraintName="mapped_user_changed_ref_term" 
			referencedTableName="users" referencedColumnNames="user_id" 
			baseTableName="concept_reference_map" baseColumnNames="changed_by" />
	</changeSet>
	
	<changeSet id="20110301-1030i" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<and>
				<not><columnExists tableName="concept_reference_map" columnName="date_changed" /></not>
			</and>
		</preConditions>
		<comment>Adding date_changed column and a foreign key constraint to concept_reference_map table</comment>
		<addColumn tableName="concept_reference_map">
			<column name="date_changed" type="DATETIME" />
		</addColumn>
	</changeSet>
	
	<changeSet id="20110301-1030j" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="concept_reference_term_map" /></not>
		</preConditions>
		<comment>Adding concept_reference_term_map table</comment>
		<createTable tableName="concept_reference_term_map">
			<column name="concept_reference_term_map_id" type="int" autoIncrement="true" >
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="term_a_id" type="int"><constraints nullable="false" /></column>
			<column name="term_b_id" type="int"><constraints nullable="false" /></column>
			<column name="a_is_to_b_id" type="int"><constraints nullable="false" /></column>
			<column name="creator" type="int"><constraints nullable="false"/></column>
			<column name="date_created" type="DATETIME"><constraints nullable="false"/></column>
			<column name="changed_by" type="int"/>
			<column name="date_changed" type="DATETIME" />
			<column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
		</createTable>
		<addForeignKeyConstraint constraintName="mapped_term_a" 
			referencedTableName="concept_reference_term" referencedColumnNames="concept_reference_term_id" 
			baseTableName="concept_reference_term_map" baseColumnNames="term_a_id" />
		<addForeignKeyConstraint constraintName="mapped_term_b" 
			referencedTableName="concept_reference_term" referencedColumnNames="concept_reference_term_id" 
			baseTableName="concept_reference_term_map" baseColumnNames="term_b_id" />
		<addForeignKeyConstraint constraintName="mapped_concept_map_type_ref_term_map" 
			referencedTableName="concept_map_type" referencedColumnNames="concept_map_type_id" 
			baseTableName="concept_reference_term_map" baseColumnNames="a_is_to_b_id" />
		<addForeignKeyConstraint constraintName="mapped_user_creator_ref_term_map" 
			referencedTableName="users" referencedColumnNames="user_id" 
			baseTableName="concept_reference_term_map" baseColumnNames="creator" />
		<addForeignKeyConstraint constraintName="mapped_user_changed_ref_term_map" 
			referencedTableName="users" referencedColumnNames="user_id" 
			baseTableName="concept_reference_term_map" baseColumnNames="changed_by" />
	</changeSet>
		
	<changeSet id="20110301-1030m" author="wyclif" dbms="mysql">
		<validCheckSum><comment>Initial SQL version</comment>3:523b32f95b74186733ebf2be0ef4ba7f</validCheckSum>
		<validCheckSum><comment>Changed to Java</comment>3:b286407bfcdf3853512cb15009c816f1</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">SELECT count(*) FROM concept_reference_term</sqlCheck>
			<columnExists tableName="concept_reference_map" columnName="source_code"/>
			<columnExists tableName="concept_reference_map" columnName="source"/>
			<columnExists tableName="concept_reference_map" columnName="comment"/>
		</preConditions>
		<comment>Creating concept reference terms from existing rows in the concept_reference_map table</comment>
		<customChange class="org.openmrs.util.databasechange.MigrateConceptReferenceTermChangeSet" />
	</changeSet>
	
	<changeSet id="20110301-1030n" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="mapped_concept_reference_term" /></not>
		</preConditions>
		<comment>Adding foreign key constraint to concept_reference_map.concept_reference_term_id column</comment>
		<addForeignKeyConstraint constraintName="mapped_concept_reference_term" 
			referencedTableName="concept_reference_term" referencedColumnNames="concept_reference_term_id" 
			baseTableName="concept_reference_map" baseColumnNames="concept_reference_term_id" />
	</changeSet>
	
	<changeSet id="20110301-1030o" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="map_source"/>
		</preConditions>
		<comment>Dropping foreign key constraint on concept_reference_map.source column</comment>
		<dropForeignKeyConstraint baseTableName="concept_reference_map"  constraintName="map_source"/>
	</changeSet>
	
	<changeSet id="20110301-1030p" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="concept_reference_map" columnName="source"/>
		</preConditions>
		<comment>Dropping concept_reference_map.source column</comment>
		<dropColumn tableName="concept_reference_map" columnName="source"/>
	</changeSet>
	
	<changeSet id="20110301-1030q" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="concept_reference_map" columnName="source_code"/>
		</preConditions>
		<comment>Dropping concept_reference_map.source_code column</comment>
		<dropColumn tableName="concept_reference_map" columnName="source_code"/>
	</changeSet>
	
	<changeSet id="20110301-1030r" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="concept_reference_map" columnName="comment"/>
		</preConditions>
		<comment>Dropping concept_reference_map.comment column</comment>
		<dropColumn tableName="concept_reference_map" columnName="comment"/>
	</changeSet>

	<changeSet id="20110913-0300" author="sunbiz">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="person_a" />
		</preConditions>
		<comment>Remove ON DELETE CASCADE from relationship table for person_a</comment>
		<dropForeignKeyConstraint baseTableName="relationship" constraintName="person_a" />
		<addForeignKeyConstraint baseColumnNames="person_a" baseTableName="relationship" constraintName="person_a_is_person" 
            deferrable="false" initiallyDeferred="false" referencedColumnNames="person_id" referencedTableName="person"/>
	</changeSet>

	<changeSet id="20110913-0300b" author="sunbiz">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="person_b" />
		</preConditions>
		<comment>Remove ON DELETE CASCADE from relationship table for person_b</comment>
		<dropForeignKeyConstraint baseTableName="relationship" constraintName="person_b" />
		<addForeignKeyConstraint baseColumnNames="person_b" baseTableName="relationship" constraintName="person_b_is_person" 
            deferrable="false" initiallyDeferred="false" referencedColumnNames="person_id" referencedTableName="person"/>
	</changeSet>
        
	<changeSet id="20090316-1008-fix" author="sunbiz" dbms="mysql">
		<comment>(Fixed)Changing from smallint to BOOLEAN type on BOOLEAN properties</comment>
		<ext:modifyColumn tableName="cohort">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="is_set" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_class">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_datatype">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_name">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_name_tag">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_numeric">
			<column name="precise" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_reference_source">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="drug">
			<column name="combination" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="drug_order">
			<column name="prn" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="complex" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="encounter">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="encounter_type">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="field">
			<column name="select_multiple" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="field_type">
			<column name="is_set" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="form">
			<column name="published" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>		
		<ext:modifyColumn tableName="form_field">
			<column name="required" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>		
		<ext:modifyColumn tableName="location_tag">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>		
		<ext:modifyColumn tableName="obs">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>		
		<ext:modifyColumn tableName="order_type">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="orders">
			<column name="discontinued" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient_identifier">
			<column name="preferred" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient_identifier_type">
			<column name="check_digit" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="required" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient_program">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="patient_state">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="person">
			<column name="birthdate_estimated" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="dead" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="person_address">
			<column name="preferred" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="person_attribute">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="person_attribute_type">
			<column name="searchable" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="person_name">
			<column name="preferred" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="program">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="program_workflow">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="program_workflow_state">
			<column name="initial" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="terminal" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="relationship">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="report_object">
			<column name="voided" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="users">
			<column name="retired" type="boolean" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="201109152336" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="1">
				select count(*) from global_property where property = 'log.level.openmrs';
			</sqlCheck>
			<sqlCheck expectedResult="0">
				select count(*) from global_property where property = 'log.level';
			</sqlCheck>
		</preConditions>
		<comment>Updating logging level global property</comment>
			<update tableName="global_property">
				<column name="property" value="log.level"/>
				<where>property = 'log.level.openmrs'</where>
			</update>
	</changeSet>

	<changeSet id="20110919-0639-void_empty_attributes" author="dkayiwa" dbms="mysql" >
		<comment>
			Void all attributes that have empty string values.
		</comment>
		<sql>
			<![CDATA[
				UPDATE person_attribute set voided = true, void_reason = 'Empty values not allowed', 
				date_voided = date_created, voided_by = creator
				WHERE value = ''
				AND voided = false
			]]>
		</sql>
	</changeSet>

 	<changeSet id="20110426-11701" author="zabil">
		<validCheckSum>3:3fb5c7a79a254b4bb9cea018a35f78be</validCheckSum>
		<validCheckSum>3:56caae006a3af14242e2ea57627004c7</validCheckSum>
 		<preConditions onFail="MARK_RAN">
 			<not>
 				<tableExists tableName="provider" />
 			</not>
 		</preConditions>
 		<comment>
 			Create provider table
 		</comment>
 		<createTable tableName="provider">
 			<column name="provider_id" type="int" autoIncrement="true">
 				<constraints primaryKey="true" nullable="false" />
 			</column>
 			<column name="person_id" type="int">
 				<constraints nullable="true" />
 			</column>
 			<column name="name" type="varchar(255)"></column>
 			<column name="identifier" type="varchar(255)"><constraints nullable="false" /></column>
 			<column name="creator" type="int">
 				<constraints nullable="false" />
 			</column>
 			<column name="date_created" type="datetime">
 				<constraints nullable="false" />
 			</column>
 			<column name="changed_by" type="int" />
 			<column name="date_changed" type="datetime" />
 			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
 				<constraints nullable="false" />
 			</column>
 			<column name="retired_by" type="int" />
 			<column name="date_retired" type="datetime" />
 			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
 			<column name="uuid" type="char(38)">
 				<constraints nullable="false" unique="true" />
 			</column>
 		</createTable>
 		<addForeignKeyConstraint constraintName="provider_changed_by_fk"
 			baseTableName="provider" baseColumnNames="changed_by"
 			referencedTableName="users" referencedColumnNames="user_id" />
 		<addForeignKeyConstraint constraintName="provider_person_id_fk"
 			baseTableName="provider" baseColumnNames="person_id"
 			referencedTableName="person" referencedColumnNames="person_id" />
 
 		<addForeignKeyConstraint constraintName="provider_retired_by_fk"
 			baseTableName="provider" baseColumnNames="retired_by"
 			referencedTableName="users" referencedColumnNames="user_id" />
 		<addForeignKeyConstraint constraintName="provider_creator_fk"
 			baseTableName="provider" baseColumnNames="creator"
 			referencedTableName="users" referencedColumnNames="user_id" />
 	</changeSet>
	<changeSet id="20110426-11701-fix" author="sunbiz">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="provider" columnName="retired"/>
		</preConditions>
		<comment>(Fixed)Change provider.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="provider">
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
  	
     <changeSet id="20110510-11702-create-provider-attribute-type-table" author="zabil">
     	 <validCheckSum>3:d96f09404f0aeea2956206b8941c55d0</validCheckSum>
     	 <validCheckSum>3:dabb301881068d6f011eeefb026c46a7</validCheckSum>
         <validCheckSum>3:7478ac84804d46a4f2b3daa63efe99be</validCheckSum>
         <preConditions onFail="MARK_RAN">
             <not><tableExists tableName="provider_attribute_type"/></not>
         </preConditions>
         <comment>Creating provider_attribute_type table</comment>
         <createTable tableName="provider_attribute_type">
             <column name="provider_attribute_type_id" type="int" autoIncrement="true">
                 <constraints primaryKey="true" nullable="false" />
             </column>
             <column name="name" type="varchar(255)"><constraints nullable="false"/></column>
             <column name="description" type="varchar(1024)"/>
             <column name="datatype" type="varchar(255)" />
             <column name="datatype_config" type="text" />
             <column name="preferred_handler" type="varchar(255)" />
             <column name="handler_config" type="text" />
             <column name="min_occurs" type="int"><constraints nullable="false" /></column>
             <column name="max_occurs" type="int"></column>
             <column name="creator" type="int"><constraints nullable="false"/></column>
             <column name="date_created" type="datetime"><constraints nullable="false"/></column>
             <column name="changed_by" type="int"/>
             <column name="date_changed" type="datetime" />
             <column name="retired" type="BOOLEAN" defaultValueBoolean="false">
                 <constraints nullable="false"/>
             </column>
             <column name="retired_by" type="int" />
             <column name="date_retired" type="datetime" />
             <column name="retire_reason" type="varchar(255)" defaultValue="null"/>
             <column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
         </createTable>
         <addForeignKeyConstraint constraintName="provider_attribute_type_creator_fk"
             baseTableName="provider_attribute_type" baseColumnNames="creator" referencedTableName="users"
             referencedColumnNames="user_id" />
         <addForeignKeyConstraint constraintName="provider_attribute_type_changed_by_fk"
             baseTableName="provider_attribute_type" baseColumnNames="changed_by" referencedTableName="users"
             referencedColumnNames="user_id" />
         <addForeignKeyConstraint constraintName="provider_attribute_type_retired_by_fk"
             baseTableName="provider_attribute_type" baseColumnNames="retired_by" referencedTableName="users"
             referencedColumnNames="user_id" />
     </changeSet>
	<changeSet id="20110510-11702-create-provider-attribute-type-table-fix" author="sunbiz">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="provider_attribute_type" columnName="retired"/>
		</preConditions>
		<comment>(Fixed)Change provider_attribute_type.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="provider_attribute_type">
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>

     <changeSet id="201110072043-fix-provider-attribute-type-columns" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="provider_attribute_type" columnName="datatype_config"/></not>
		</preConditions>
		<comment>Refactoring provider_attribute_type table (devs only)</comment>
		<addColumn tableName="provider_attribute_type">
			<column name="datatype_config" type="text" />
		</addColumn>
		<addColumn tableName="provider_attribute_type">
			<column name="preferred_handler" type="varchar(255)" />
		</addColumn>
	</changeSet>
     
     <changeSet id="20110628-1400-create-provider-attribute-table" author="kishoreyekkanti">
         <validCheckSum>3:6b869e17f82b860055f27d0953a42f63</validCheckSum>
         <validCheckSum>3:298aaacafd48547be294f4c9b7c40d35</validCheckSum>
         <preConditions onFail="MARK_RAN">
             <not><tableExists tableName="provider_attribute"/></not>
         </preConditions>
         <comment>Creating provider_attribute table</comment>
         <createTable tableName="provider_attribute">
             <column name="provider_attribute_id" type="int" autoIncrement="true">
                 <constraints primaryKey="true" nullable="false" />
             </column>
             <column name="provider_id" type="int"><constraints nullable="false" /></column>
             <column name="attribute_type_id" type="int"><constraints nullable="false" /></column>
             <column name="value_reference" type="text"><constraints nullable="false" /></column>
             <column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
             <column name="creator" type="int"><constraints nullable="false"/></column>
             <column name="date_created" type="datetime"><constraints nullable="false"/></column>
             <column name="changed_by" type="int"/>
             <column name="date_changed" type="datetime" />
             <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                 <constraints nullable="false"/>
             </column>
             <column name="voided_by" type="int" />
             <column name="date_voided" type="datetime" />
             <column name="void_reason" type="varchar(255)" defaultValue="null"/>
         </createTable>
         <addForeignKeyConstraint constraintName="provider_attribute_provider_fk"
             baseTableName="provider_attribute" baseColumnNames="provider_id" referencedTableName="provider"
             referencedColumnNames="provider_id" />
         <addForeignKeyConstraint constraintName="provider_attribute_attribute_type_id_fk"
             baseTableName="provider_attribute" baseColumnNames="attribute_type_id" referencedTableName="provider_attribute_type"
             referencedColumnNames="provider_attribute_type_id" />
         <addForeignKeyConstraint constraintName="provider_attribute_creator_fk"
             baseTableName="provider_attribute" baseColumnNames="creator" referencedTableName="users"
             referencedColumnNames="user_id" />
         <addForeignKeyConstraint constraintName="provider_attribute_changed_by_fk"
             baseTableName="provider_attribute" baseColumnNames="changed_by" referencedTableName="users"
             referencedColumnNames="user_id" />
         <addForeignKeyConstraint constraintName="provider_attribute_voided_by_fk"
             baseTableName="provider_attribute" baseColumnNames="voided_by" referencedTableName="users"
             referencedColumnNames="user_id" />
     </changeSet>
	<changeSet id="20110628-1400-create-provider-attribute-table-fix" author="sunbiz">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="provider_attribute" columnName="voided"/>
		</preConditions>
		<comment>(Fixed)Change provider_attribute.voided to BOOLEAN</comment>
		<ext:modifyColumn tableName="provider_attribute">
			<column name="voided" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>

     <changeSet id="20110705-2300-create-encounter-role-table" author="kishoreyekkanti">
         <validCheckSum>3:409eb019d6387707442af989139b8345</validCheckSum>
         <validCheckSum>3:a381ef81f10e4f7443b4d4c8d6231de8</validCheckSum>
         <preConditions onFail="MARK_RAN">
             <not><tableExists tableName="encounter_role"/></not>
         </preConditions>
         <comment>Creating encounter_role table</comment>
         <createTable tableName="encounter_role">
             <column name="encounter_role_id" type="int" autoIncrement="true">
                 <constraints primaryKey="true" nullable="false" />
             </column>
             <column name="name" type="varchar(255)"><constraints nullable="false"/></column>
             <column name="description" type="varchar(1024)"/>
             <column name="creator" type="int"><constraints nullable="false"/></column>
             <column name="date_created" type="datetime"><constraints nullable="false"/></column>
             <column name="changed_by" type="int"/>
             <column name="date_changed" type="datetime" />
             <column name="retired" type="BOOLEAN" defaultValueBoolean="false">
                 <constraints nullable="false"/>
             </column>
             <column name="retired_by" type="int" />
             <column name="date_retired" type="datetime" />
             <column name="retire_reason" type="varchar(255)" defaultValue="null"/>
             <column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
         </createTable>
         <addForeignKeyConstraint constraintName="encounter_role_creator_fk"
             baseTableName="encounter_role" baseColumnNames="creator" referencedTableName="users"
             referencedColumnNames="user_id" />
         <addForeignKeyConstraint constraintName="encounter_role_changed_by_fk"
             baseTableName="encounter_role" baseColumnNames="changed_by" referencedTableName="users"
             referencedColumnNames="user_id" />
         <addForeignKeyConstraint constraintName="encounter_role_retired_by_fk"
             baseTableName="encounter_role" baseColumnNames="retired_by" referencedTableName="users"
             referencedColumnNames="user_id" />
     </changeSet>
	<changeSet id="20110705-2300-create-encounter-role-table-fix" author="sunbiz">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="encounter_role" columnName="retired"/>
		</preConditions>
		<comment>(Fixed)Change encounter_role.retired to BOOLEAN</comment>
		<ext:modifyColumn tableName="encounter_role">
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
 
     <changeSet id="20110811-1205-create-encounter-provider-table" author="sree/vishnu">
         <validCheckSum>3:694e9f92781b1a42d18d6af65d8e6c14</validCheckSum>
         <validCheckSum>3:e20ca5412e37df98c58a39552aafb5ad</validCheckSum>
         <preConditions onFail="MARK_RAN">
             <not><tableExists tableName="encounter_provider"/></not>
         </preConditions>
         <comment>Creating encounter_provider table</comment>
         <createTable tableName="encounter_provider">
             <column name="encounter_provider_id" type="int" autoIncrement="true">
                 <constraints primaryKey="true" nullable="false" />
         </column>
             <column name="encounter_id" type="int"><constraints nullable="false" /></column>
             <column name="provider_id" type="int"><constraints nullable="false" /> </column>
             <column name="encounter_role_id" type="int"><constraints nullable="false" /></column>
             <column defaultValueNumeric="0" name="creator" type="int"><constraints nullable="false"/></column>
             <column name="date_created" type="datetime"><constraints nullable="false"/></column>
             <column name="changed_by" type="int"/>
             <column name="date_changed" type="datetime" />
             <column defaultValueBoolean="false" name="voided" type="BOOLEAN"><constraints nullable="false" /></column>
             <column name="date_voided" type="datetime" />
             <column name="voided_by" type="int" />
             <column name="void_reason" type="varchar(255)" />
             <column name="uuid" type="char(38)"><constraints nullable="false" unique="true" /></column>
         </createTable>
         <addForeignKeyConstraint constraintName="encounter_id_fk"
             baseTableName="encounter_provider" baseColumnNames="encounter_id" referencedTableName="encounter"
             referencedColumnNames="encounter_id" />
         <addForeignKeyConstraint constraintName="provider_id_fk"
             baseTableName="encounter_provider" baseColumnNames="provider_id" referencedTableName="provider"
             referencedColumnNames="provider_id" />
         <addForeignKeyConstraint constraintName="encounter_role_id_fk"
             baseTableName="encounter_provider" baseColumnNames="encounter_role_id" referencedTableName="encounter_role"
             referencedColumnNames="encounter_role_id" />
     </changeSet>
	 <changeSet id="20110811-1205-create-encounter-provider-table-fix" author="sunbiz">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="encounter_provider" columnName="voided"/>
		</preConditions>
		<comment>(Fixed)Change encounter_provider.voided to BOOLEAN</comment>
		<ext:modifyColumn tableName="encounter_provider">
			<column name="voided" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	 </changeSet>
     
     <changeSet id="20110819-1455-insert-unknown-encounter-role" author="raff">
	     	<preConditions onFail="MARK_RAN">
 			<sqlCheck expectedResult="0">
 				select count(*) from encounter_role where uuid = 'a0b03050-c99b-11e0-9572-0800200c9a66'
 			</sqlCheck>
 		</preConditions>
     	<comment>Inserting the unknown encounter role into the encounter_role table</comment>
 		<insert tableName="encounter_role">
 			<column name="name" value="Unknown"/>
 			<column name="description" value="Unknown encounter role for legacy providers with no encounter role set"/>
 			<column name="creator" valueNumeric="1"/>
 			<column name="date_created" valueDate="2011-08-18T14:00:00.0" />
 			<column name="retired" valueBoolean="false" />
 			<column name="uuid" value="a0b03050-c99b-11e0-9572-0800200c9a66" />
 		</insert>
		<!-- Update postgres sequence correctly as it is incorrect after initial bulk inserts -->
		<modifySql dbms="postgresql">
			<prepend value="SELECT setval('encounter_role_encounter_role_id_seq', (SELECT MAX(encounter_role_id) FROM encounter_role)+1);"/>
		</modifySql>
     </changeSet>
     
     <changeSet id="20110825-1000-creating-providers-for-persons-from-encounter" author="raff" dbms="mysql">
     	<validCheckSum>3:d0da8b0b930623f6c62e2bd02bc2523b</validCheckSum>
     	<validCheckSum><comment>Changing identifier from person.person_id to user.system_id</comment>3:cccc02519a766bd8fde048cea13d307c</validCheckSum>
     	<validCheckSum><comment>Changing now() to CURRENT_TIMESTAMP</comment>3:a70d8897d05364a0a4398f2b90542fd4</validCheckSum>
     	<validCheckSum><comment>Copying user.retired to person.voided so that generated providers for retired users are retired</comment>3:f338c9ea12ce38b0695db335d983b4e1</validCheckSum>
     	<validCheckSum><comment>Correcting checksum</comment>3:216ab5057dca5471de69124e93953d96</validCheckSum>
     	<validCheckSum><comment>TRUNK-3853 and TRUNK-3414</comment>3:04bc8aa9859f6f8dda065e272ba12e0d</validCheckSum>
     	<validCheckSum><comment>TRUNK-4813</comment>3:f4aef46fe2207906684f25d3a3c9148e</validCheckSum>
     	<preConditions onFail="MARK_RAN">
 			<columnExists tableName="encounter" columnName="provider_id"/>
 		</preConditions>
 		<comment>Creating providers for persons from the encounter table</comment>
 		<sql>
 			insert into provider(person_id, identifier, creator, date_created, retired, uuid)
 				select distinct person.person_id, CONCAT('prov', SUBSTRING(person.uuid, 5)), 1, CURRENT_TIMESTAMP, false, CONCAT('prov', SUBSTRING(person.uuid, 5)) 
 				from person as person
 					inner join encounter as encounter on encounter.provider_id = person.person_id
 					left join users as user on user.person_id = person.person_id
 				where user.person_id is null and encounter.provider_id not in (select person_id from provider);
 				
 			insert into provider(person_id, identifier, creator, date_created, retired, retired_by, date_retired, retire_reason, uuid)
 				select distinct person.person_id, user.system_id, 1, CURRENT_TIMESTAMP, user.retired, user.retired_by, user.date_retired, user.retire_reason, CONCAT('prov', SUBSTRING(person.uuid, 5))
 				from person as person
 					inner join encounter as encounter on encounter.provider_id = person.person_id
 					left join (SELECT users.user_id, users.system_id, users.person_id, users.retired, users.retired_by, users.date_retired, users.retire_reason
						FROM users, (SELECT users.person_id, MAX(users.user_id) as user_id
							FROM users GROUP BY users.person_id) latestuser
						WHERE latestuser.user_id = users.user_id) as user 
 						on person.person_id = user.person_id
 				where user.user_id is not null and encounter.provider_id not in (select person_id from provider);
         </sql>
 	</changeSet>
     
     <changeSet id="20110825-1000-migrating-providers-to-encounter-provider" author="raff" dbms="mysql">
     	<preConditions onFail="MARK_RAN">
 			<columnExists tableName="encounter" columnName="provider_id"/>
 		</preConditions>
 		<comment>Migrating providers from the encounter table to the encounter_provider table</comment>
 		<sql>			
 			insert into encounter_provider(provider_id, encounter_id, encounter_role_id, creator, date_created, voided, uuid) 
 				select distinct provider.provider_id, encounter.encounter_id, encounter_role.encounter_role_id, 
 					encounter.creator, encounter.date_created, encounter.voided, encounter.uuid
 				from encounter as encounter 
 					inner join encounter_role as encounter_role 
 						on encounter_role.uuid = "a0b03050-c99b-11e0-9572-0800200c9a66"
 					inner join provider as provider on encounter.provider_id = provider.person_id
 				where encounter.encounter_id not in (select encounter_id from encounter_provider);
         </sql>
 	</changeSet>
 	
 	<changeSet id="20110825-1000-drop-provider-id-column-from-encounter-table" author="raff">
 		<preConditions onFail="MARK_RAN">
 			<columnExists tableName="encounter" columnName="provider_id"/>
 		</preConditions>
 		<comment>Dropping the provider_id column from the encounter table</comment>
 		<dropForeignKeyConstraint baseTableName="encounter" constraintName="encounter_provider"/>
         <dropColumn tableName="encounter" columnName="provider_id"/>
 	</changeSet>
 	
	<changeSet id="20111008-0938-1" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="global_property" columnName="datatype" /></not>
		</preConditions>
		<comment>Allow Global Properties to be typed</comment>
		<addColumn tableName="global_property">
			<column name="datatype" type="varchar(255)" />
		</addColumn>
	</changeSet> 	

	<changeSet id="20111008-0938-2" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="global_property" columnName="datatype_config" /></not>
		</preConditions>
		<comment>Allow Global Properties to be typed</comment>
		<addColumn tableName="global_property">
			<column name="datatype_config" type="text" />
		</addColumn>
	</changeSet>

	<changeSet id="20111008-0938-3" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="global_property" columnName="preferred_handler" /></not>
		</preConditions>
		<comment>Allow Global Properties to be typed</comment>
		<addColumn tableName="global_property">
			<column name="preferred_handler" type="varchar(255)" />
		</addColumn>
	</changeSet>

	<changeSet id="20111008-0938-4" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="global_property" columnName="handler_config" /></not>
		</preConditions>
		<comment>Allow Global Properties to be typed</comment>
		<addColumn tableName="global_property">
			<column name="handler_config" type="text" />
		</addColumn>
	</changeSet> 	

    <changeSet id="201110091820-a" author="jkeiper">
		<preConditions onFail="MARK_RAN">
			<changeSetExecuted id="201103152243-c" author="jkeiper" changeLogFile="liquibase-update-to-latest.xml"/>
		</preConditions>
		<comment>Add xslt column back to the form table</comment>
		<addColumn tableName="form">
            <column name="xslt" type="text"/>
        </addColumn>
	</changeSet>

	<changeSet id="201110091820-b" author="jkeiper" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<changeSetExecuted id="201103152243-d" author="jkeiper" changeLogFile="liquibase-update-to-latest.xml"/>
		</preConditions>
		<comment>Add template column back to the form table</comment>
		<addColumn tableName="form">
            <column name="template" type="text"/>
        </addColumn>
	</changeSet>
	
	<changeSet id="20110326-1" author="Knoll_Frank">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="obs" columnName="previous_version"/></not>
		</preConditions>
		<comment>
			Add obs.previous_version column (TRUNK-420)
		</comment>
		
		<addColumn tableName="obs">
			<column name="previous_version" type="int" />
		</addColumn>
		
		<addForeignKeyConstraint constraintName="previous_version"
			baseTableName="obs" baseColumnNames="previous_version"
			referencedTableName="obs" referencedColumnNames="obs_id"
			/>
	</changeSet>

	<changeSet id="201110091820-c" author="jkeiper">
		<preConditions onFail="MARK_RAN">
			<and>
				<changeSetExecuted id="201103152243-a" author="jkeiper" changeLogFile="liquibase-update-to-latest.xml"/>
				<not>
					<changeSetExecuted id="20111010-1515" author="jkeiper" changeLogFile="liquibase-update-to-latest.xml"/>
				</not>
			</and>
		</preConditions>
		<comment>Rename form_resource table to preserve data; 20111010-1515 reference is for bleeding-edge developers and can be generally ignored</comment>
		<renameTable oldTableName="form_resource" newTableName="old_form_resource"/>
	</changeSet>

	<changeSet id="20111010-1515" author="jkeiper">
		<validCheckSum>3:2c89de6911728b4bb9048f8bafa069dc</validCheckSum>
		<validCheckSum>3:3ccdc9a3ecf811382a0c12825c0aeeb3</validCheckSum>
		<preConditions onFail="HALT">
			<not>
				<tableExists tableName="form_resource"/>
			</not>
		</preConditions>
		<comment>Creating form_resource table</comment>
		<createTable tableName="form_resource">
			<column name="form_resource_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="form_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="name" type="varchar(255)">
				<constraints nullable="false"/> 
			</column>
			<column name="value_reference" type="text">
				<constraints nullable="false"/>
			</column>
			<column name="datatype" type="varchar(255)"/>
			<column name="datatype_config" type="text"/>
			<column name="preferred_handler" type="varchar(255)"/>
			<column name="handler_config" type="text"/>
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"/>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="form_resource_form_fk"
            baseTableName="form_resource" baseColumnNames="form_id" referencedTableName="form"
            referencedColumnNames="form_id" />
		<addUniqueConstraint tableName="form_resource" 
			constraintName="unique_form_and_name" columnNames="form_id,name" />
	</changeSet>

	<changeSet id="20110326-2" author="Knoll_Frank" dbms="mysql">
		<preConditions>
			<columnExists tableName="obs" columnName="previous_version"/>
		</preConditions>
		<comment>
			Fix all the old void_reason content and add in the new previous_version to the matching obs row (POTENTIALLY VERY SLOW FOR LARGE OBS TABLES)
		</comment>
		
		<sql>
			UPDATE obs,
					(SELECT obs_id AS previous_version,
							REVERSE(SUBSTRING(REVERSE(SUBSTRING_INDEX(void_reason, ' ', -1)), 2)) AS new_obs
							FROM obs) AS TMP_TAB
					SET obs.previous_version = TMP_TAB.previous_version
					WHERE obs.obs_id = TMP_TAB.new_obs;
		</sql>
	</changeSet>
	
	<changeSet id="20111128-1601" author="wyclif" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				SELECT COUNT(*) FROM scheduler_task_config
				WHERE schedulable_class = 'org.openmrs.scheduler.tasks.AutoCloseVisitsTask'
				And name = 'Auto Close Visits Task'
			</sqlCheck>
		</preConditions>
		<comment>Inserting Auto Close Visits Task into 'schedule_task_config' table</comment>
		<insert tableName="scheduler_task_config">
			<column name="name" value="Auto Close Visits Task" />
			<column name="description" value="Stops all active visits that match the visit type(s) specified by the value of the global property 'autoCloseVisits.visitType'" />
			<column name="schedulable_class" value="org.openmrs.scheduler.tasks.AutoCloseVisitsTask" />
			<column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss" />
			<column name="start_time" valueDate="2011-11-28T23:59:59" />
			<column name="repeat_interval" value="86400" />
			<column name="date_created" valueDate="CURRENT_TIMESTAMP" />
			<column name="created_by" value="1" />
			<column name="uuid" value="8c17b376-1a2b-11e1-a51a-00248140a5eb" />
		</insert>
	</changeSet>
	
	<changeSet id="20111209-1400-deleting-non-existing-roles-from-role-role-table" author="raff">
		<comment>Deleting non-existing roles from the role_role table</comment>
		<sql>
			DELETE FROM role_role WHERE parent_role NOT IN (SELECT role FROM role) 
				OR child_role NOT IN (SELECT role FROM role);
		</sql>
	</changeSet>

	 <changeSet id="20100111-0111-associating-daemon-user-with-person" author="dkayiwa">
     	<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					select count(*) from users where person_id IS NULL AND uuid = 'A4F30A1B-5EB9-11DF-A648-37A07F9C90FB'
				</sqlCheck>
			</not>
		</preConditions>
		<comment>Associating daemon user with a person</comment>
 		<sql>	
 			insert into person (gender, birthdate_estimated, dead, creator, date_created, voided, uuid)
 			values ( '', false, false, 1, '2011-12-12', false, 'B4F30A1B-5EB9-11DF-A648-37A07F9C90FB');
 				
 			insert into person_name (preferred, person_id, given_name, family_name, creator, date_created, voided, uuid)
 			select true, person_id, 'daemon', 'daemon', 1, '2011-12-12', false, 'C4F30A1B-5EB9-11DF-A648-37A07F9C90FB'  
 			from person where uuid = 'B4F30A1B-5EB9-11DF-A648-37A07F9C90FB';
 			
 			update users set person_id = (select person_id from person where uuid = 'B4F30A1B-5EB9-11DF-A648-37A07F9C90FB') 
 			where person_id IS NULL AND uuid = 'A4F30A1B-5EB9-11DF-A648-37A07F9C90FB';
         </sql>
 	</changeSet>
 	
 	<changeSet id="20100426-1111-add-not-null-personid-contraint" author="dkayiwa" dbms="mysql">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="users" columnName="person_id"/>
		</preConditions>
		<comment>Add the not null person id contraint</comment>
		<addNotNullConstraint tableName="users" columnName="person_id" columnDataType="int"/>				
	</changeSet>
	
 	<changeSet id="20111214-1500-setting-super-user-gender" author="raff">
     	<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="1">
				select count(*) from person where person_id = 1 and (gender is null or gender = '');
			</sqlCheck>
		</preConditions>
		<comment>Setting super user gender</comment>
 		<sql>	
 			update person set gender = 'M' where person_id = 1;
 		</sql>
 	</changeSet>
	
	<changeSet id="20111218-1830" author="abbas">
		<validCheckSum>3:4cf83ec393438309efc80e0ba7fedf55</validCheckSum>
		<validCheckSum>3:5f096b88988f19d9d3e596c03fba2b90</validCheckSum>
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="person_merge_log_unique_uuid" />
			</not>
		</preConditions>
		<comment>
			Add unique uuid constraint and attributes inherited from BaseOpenmrsData to the person_merge_log table
		</comment>
		<addUniqueConstraint tableName="person_merge_log"
			columnNames="uuid" constraintName="person_merge_log_unique_uuid" />		
		<addColumn tableName="person_merge_log">
			<column name="changed_by" type="int" />
		</addColumn>
		<addColumn tableName="person_merge_log">
			<column name="date_changed" type="datetime" />
		</addColumn>
		<addColumn tableName="person_merge_log">
			<column name="voided" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</addColumn>
		<addColumn tableName="person_merge_log">
			<column name="voided_by" type="int" />
		</addColumn>
		<addColumn tableName="person_merge_log">
			<column name="date_voided" type="datetime" />
		</addColumn>
		<addColumn tableName="person_merge_log">
			<column name="void_reason" type="varchar(255)" defaultValue="null" />
		</addColumn>
		<addForeignKeyConstraint constraintName="person_merge_log_changed_by_fk"
			baseTableName="person_merge_log" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="person_merge_log_voided_by_fk"
			baseTableName="person_merge_log" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	<changeSet id="20111218-1830-fix" author="sunbiz">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="person_merge_log"/>
		</preConditions>
		<comment>(Fixed)Change person_merge_log.voided to BOOLEAN</comment>
		<ext:modifyColumn tableName="person_merge_log">
			<column name="voided" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
		</ext:modifyColumn>
	</changeSet>
	
	<changeSet id="20111219-1404" author="bwolfe">
		<comment>Fix empty descriptions on relationship types</comment>
		<update tableName="relationship_type">
			<column name="description" value="Auto generated by OpenMRS"/>
			<where>description is null or description = ''</where>
		</update>
	</changeSet>
	
	<changeSet id="20111222-1659" author="djazayeri">
		<comment>Create clob_datatype_storage table</comment>
		<createTable tableName="clob_datatype_storage">
			<column name="id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="value" type="CLOB">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<createIndex tableName="clob_datatype_storage" unique="true" indexName="clob_datatype_storage_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	
	<changeSet id="201202020847" author="abbas">
		<comment>Change merged_data column type to CLOB in person_merge_log table</comment>
		<modifyDataType tableName="person_merge_log" columnName="merged_data" newDataType="CLOB"/>
		<!-- modifyDataType has a bug causing the column to lose notNull constraint. 
		see: http://liquibase.jira.com/browse/CORE-670
		temp fix, add the not null constraint after modifying the data type -->
		<addNotNullConstraint tableName="person_merge_log" columnName="merged_data" columnDataType="CLOB"/>
	</changeSet>
	
	<changeSet id="20120322-1510" author="wyclif">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists columnName="uniqueness_behavior" tableName="patient_identifier_type"/>
			</not>
		</preConditions>
		<comment>Adding uniqueness_behavior column to patient_identifier_type table</comment>
		<addColumn tableName="patient_identifier_type">
			<column name="uniqueness_behavior" type="varchar(50)"></column>
		</addColumn>
	</changeSet>

	<changeSet id="20120330-0954" author="jkeiper">
		<comment>Increase size of drug name column to 255 characters</comment>
		<modifyDataType tableName="drug" columnName="name" newDataType="varchar(255)"/>
	</changeSet>
	
	<changeSet id="20120504-1000" author="raff">
		<preConditions onFail="HALT">
			<sqlCheck expectedResult="0">
				select count(*) from
				drug_ingredient
			</sqlCheck>
		</preConditions>
		<comment>Dropping the drug_ingredient table</comment>
		<dropTable tableName="drug_ingredient" />
	</changeSet>

	<changeSet id="20120504-1010" author="raff">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="drug_ingredient" />
			</not>
		</preConditions>
		<comment>Creating the drug_ingredient table</comment>
		<createTable tableName="drug_ingredient">
			<column name="drug_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="ingredient_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="uuid" type="char(38)">
				<constraints unique="true" nullable="false" />
			</column>
			<column name="quantity" type="double" />
			<column name="units" type="int" />
		</createTable>
	</changeSet>

	<changeSet id="20120504-1020" author="raff">
		<preConditions onFail="MARK_RAN">
			<not>
				<primaryKeyExists tableName="drug_ingredient" />
			</not>
		</preConditions>
		<comment>Adding a primary key to the drug_ingredient table</comment>
		<addPrimaryKey constraintName="drug_ingredient_pk"
			tableName="drug_ingredient" columnNames="drug_id,ingredient_id" />
	</changeSet>

	<changeSet id="20120504-1030" author="raff">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists
					foreignKeyName="drug_ingredient_units_fk" />
			</not>
		</preConditions>
		<comment>Adding a new foreign key from drug_ingredient.units to concept.concept_id</comment>
		<addForeignKeyConstraint constraintName="drug_ingredient_units_fk"
			baseTableName="drug_ingredient" baseColumnNames="units"
			referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>

	<changeSet id="20120504-1040" author="raff">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists
					foreignKeyName="drug_ingredient_drug_id_fk" />
			</not>
		</preConditions>
		<comment>Adding a new foreign key from drug_ingredient.drug_id to drug.drug_id</comment>
		<addForeignKeyConstraint constraintName="drug_ingredient_drug_id_fk"
			referencedTableName="drug" baseColumnNames="drug_id" baseTableName="drug_ingredient"
			referencedColumnNames="drug_id" />
	</changeSet>

	<changeSet id="20120504-1050" author="raff">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists
					foreignKeyName="drug_ingredient_ingredient_id_fk" />
			</not>
		</preConditions>
		<comment>Adding a new foreign key from drug_ingredient.ingredient_id to concept.concept_id</comment>
		<addForeignKeyConstraint constraintName="drug_ingredient_ingredient_id_fk"
			referencedTableName="concept" referencedColumnNames="concept_id"
			baseTableName="drug_ingredient" baseColumnNames="ingredient_id" />
	</changeSet>
	
	<changeSet id="200912141000-drug-add-date-changed" author="dkayiwa">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="drug" columnName="date_changed" />
			</not>
		</preConditions>
		<comment>
			Add date_changed column to drug table
		</comment>
		<addColumn tableName="drug">
			<column name="date_changed" type="datetime" />
		</addColumn>
	</changeSet>
	
	<changeSet id="200912141001-drug-add-changed-by" author="dkayiwa">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="drug" columnName="changed_by" />
			</not>
		</preConditions>
		<comment>
			Add changed_by column to drug table
		</comment>
		<addColumn tableName="drug">
			<column name="changed_by" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="drug_changed_by"
			baseTableName="drug" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	
	<changeSet id="10-insert-new-app-privileges" author="dkayiwa">
		<comment>Inserting the new application privileges</comment>
		<sql>
			insert into privilege (privilege, description, uuid) 
			select 'Patient Overview - View Patient Actions', 'Able to view the Patient Actions portlet on the patient overview tab', 'd05118c6-2490-4d78-a41a-390e3596a264'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Patient Overview - View Patient Actions') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Patient Overview - View Programs', 'Able to view the Programs portlet on the patient overview tab', 'd05118c6-2490-4d78-a41a-390e3596a263'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Patient Overview - View Programs') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Patient Overview - View Relationships', 'Able to view the Relationships portlet on the patient overview tab', 'd05118c6-2490-4d78-a41a-390e3596a262'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Patient Overview - View Relationships') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Patient Overview - View Allergies', 'Able to view the Allergies portlet on the patient overview tab', 'd05118c6-2490-4d78-a41a-390e3596a261'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Patient Overview - View Allergies') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Patient Overview - View Problem List', 'Able to view the Problem List portlet on the patient overview tab', 'd05118c6-2490-4d78-a41a-390e3596a260'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Patient Overview - View Problem List') limit 1;
		</sql>
	</changeSet>
	
	<changeSet id="11-insert-new-api-privileges" author="dkayiwa">
		<comment>Inserting the new API privileges</comment>
		<sql>
			insert into privilege (privilege, description, uuid) 
			select 'Get Concepts', 'Able to get concept entries', 'd05118c6-2490-4d78-a41a-390e3596a251'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Concepts') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Concept Proposals', 'Able to get concept proposals to the system', 'd05118c6-2490-4d78-a41a-390e3596a250'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Concept Proposals') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Users', 'Able to get users in OpenMRS', 'd05118c6-2490-4d78-a41a-390e3596a249'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Users') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Encounters', 'Able to get patient encounters', 'd05118c6-2490-4d78-a41a-390e3596a248'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Encounters') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Encounter Types', 'Able to get encounter types', 'd05118c6-2490-4d78-a41a-390e3596a247'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Encounter Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Locations', 'Able to get locations', 'd05118c6-2490-4d78-a41a-390e3596a246'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Locations') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Observations', 'Able to get patient observations', 'd05118c6-2490-4d78-a41a-390e3596a245'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Observations') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Patients', 'Able to get patients', 'd05118c6-2490-4d78-a41a-390e3596a244'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Patients') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Patient Identifiers', 'Able to get patient identifiers', 'd05118c6-2490-4d78-a41a-390e3596a243'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Patient Identifiers') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Patient Cohorts', 'Able to get patient cohorts', 'd05118c6-2490-4d78-a41a-390e3596a242'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Patient Cohorts') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Orders', 'Able to get orders', 'd05118c6-2490-4d78-a41a-390e3596a241'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Orders') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Forms', 'Able to get forms', 'd05118c6-2490-4d78-a41a-390e3596a240'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Forms') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Identifier Types', 'Able to get patient identifier types', 'd05118c6-2490-4d78-a41a-390e3596a239'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Identifier Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Concept Classes', 'Able to get concept classes', 'd05118c6-2490-4d78-a41a-390e3596a238'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Concept Classes') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Concept Datatypes', 'Able to get concept datatypes', 'd05118c6-2490-4d78-a41a-390e3596a237'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Concept Datatypes') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Privileges', 'Able to get user privileges', 'd05118c6-2490-4d78-a41a-390e3596a236'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Privileges') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Roles', 'Able to get user roles', 'd05118c6-2490-4d78-a41a-390e3596a235'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Roles') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Field Types', 'Able to get field types', 'd05118c6-2490-4d78-a41a-390e3596a234'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Field Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Order Types', 'Able to get order types', 'd05118c6-2490-4d78-a41a-390e3596a233'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Order Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Relationship Types', 'Able to get relationship types', 'd05118c6-2490-4d78-a41a-390e3596a232'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Relationship Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Concept Sources', 'Able to get concept sources', 'd05118c6-2490-4d78-a41a-390e3596a231'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Concept Sources') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Concept Map Types', 'Able to get concept map types', 'd05118c6-2490-4d78-a41a-390e3596a230'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Concept Map Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Concept Reference Terms', 'Able to get concept reference terms', 'd05118c6-2490-4d78-a41a-390e3596a229'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Concept Reference Terms') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Programs', 'Able to get patient programs', 'd05118c6-2490-4d78-a41a-390e3596a228'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Programs') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Patient Programs', 'Able to get which programs that patients are in', 'd05118c6-2490-4d78-a41a-390e3596a227'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Patient Programs') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Global Properties', 'Able to get global properties on the administration screen', 'd05118c6-2490-4d78-a41a-390e3596a226'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Global Properties') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Person Attribute Types', 'Able to get person attribute types', 'd05118c6-2490-4d78-a41a-390e3596a225'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Person Attribute Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get People', 'Able to get person objects', 'd05118c6-2490-4d78-a41a-390e3596a224'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get People') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Relationships', 'Able to get relationships', 'd05118c6-2490-4d78-a41a-390e3596a223'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Relationships') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Database Changes', 'Able to get database changes from the admin screen', 'd05118c6-2490-4d78-a41a-390e3596a222'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Database Changes') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Problems', 'Able to get problems', 'd05118c6-2490-4d78-a41a-390e3596a221'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Problems') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Allergies', 'Able to get allergies', 'd05118c6-2490-4d78-a41a-390e3596a220'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Allergies') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get HL7 Source', 'Able to get an HL7 Source', 'd05118c6-2490-4d78-a41a-390e3596a219'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get HL7 Source') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get HL7 Inbound Queue', 'Able to get an HL7 Queue item', 'd05118c6-2490-4d78-a41a-390e3596a218'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get HL7 Inbound Queue') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get HL7 Inbound Archive', 'Able to get an HL7 archive item', 'd05118c6-2490-4d78-a41a-390e3596a217'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get HL7 Inbound Archive') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get HL7 Inbound Exception', 'Able to get an HL7 error item', 'd05118c6-2490-4d78-a41a-390e3596a216'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get HL7 Inbound Exception') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Visit Types', 'Able to get visit types', 'd05118c6-2490-4d78-a41a-390e3596a215'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Visit Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Visits', 'Able to get visits', 'd05118c6-2490-4d78-a41a-390e3596a214'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Visits') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Visit Attribute Types', 'Able to get visit attribute types', 'd05118c6-2490-4d78-a41a-390e3596a213'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Visit Attribute Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Location Attribute Types', 'Able to get location attribute types', 'd05118c6-2490-4d78-a41a-390e3596a212'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Location Attribute Types') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Providers', 'Able to get Providers', 'd05118c6-2490-4d78-a41a-390e3596a211'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Providers') limit 1;
			
			insert into privilege (privilege, description, uuid) 
			select 'Get Encounter Roles', 'Able to get encounter roles', 'd05118c6-2490-4d78-a41a-390e3596a210'
			from privilege
			where not exists (select privilege from privilege where privilege = 'Get Encounter Roles') limit 1;
		</sql>
	</changeSet>
	
	<changeSet id="1-grant-new-dashboard-overview-tab-app-privileges" author="dkayiwa">
		<comment>Granting the new patient overview tab application privileges</comment>
		<sql>
			insert into role_privilege (role, privilege) 
			select role, 'Patient Overview - View Patient Actions' from role_privilege rp
			where rp.privilege = 'Patient Dashboard - View Overview Section'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Patient Overview - View Patient Actions' and rp2.role=rp.role);
		
			insert into role_privilege (role, privilege) 
			select role, 'Patient Overview - View Programs' from role_privilege rp
			where rp.privilege = 'View Patient Programs'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Patient Overview - View Programs' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Patient Overview - View Relationships' from role_privilege rp
			where rp.privilege = 'View Relationships'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Patient Overview - View Relationships' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Patient Overview - View Allergies' from role_privilege rp
			where rp.privilege = 'View Allergies'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Patient Overview - View Allergies' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Patient Overview - View Problem List' from role_privilege rp
			where rp.privilege = 'View Problems'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Patient Overview - View Problem List' and rp2.role=rp.role);
		</sql>
	</changeSet>
	
	<changeSet id="2-role-assign-new-api-privileges-to-renamed-ones" author="dkayiwa">
		<comment>Assigning the new API-level privileges to roles that used to have the renamed privileges</comment>
		<sql>
			insert into role_privilege (role, privilege) 
			select role, 'Get Concepts' from role_privilege rp
			where rp.privilege = 'View Concepts'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Concepts' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Concept Proposals' from role_privilege rp
			where rp.privilege = 'View Concept Proposals'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Concept Proposals' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Users' from role_privilege rp
			where rp.privilege = 'View Users'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Users' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Encounters' from role_privilege rp
			where rp.privilege = 'View Encounters'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Encounters' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Encounter Types' from role_privilege rp
			where rp.privilege = 'View Encounter Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Encounter Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Locations' from role_privilege rp
			where rp.privilege = 'View Locations'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Locations' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Observations' from role_privilege rp
			where rp.privilege = 'View Observations'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Observations' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Patients' from role_privilege rp
			where rp.privilege = 'View Patients'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Patients' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Patient Identifiers' from role_privilege rp
			where rp.privilege = 'View Patient Identifiers'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Patient Identifiers' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Patient Cohorts' from role_privilege rp
			where rp.privilege = 'View Patient Cohorts'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Patient Cohorts' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Orders' from role_privilege rp
			where rp.privilege = 'View Orders'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Orders' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Forms' from role_privilege rp
			where rp.privilege = 'View Forms'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Forms' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Identifier Types' from role_privilege rp
			where rp.privilege = 'View Identifier Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Identifier Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Concept Classes' from role_privilege rp
			where rp.privilege = 'View Concept Classes'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Concept Classes' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Concept Datatypes' from role_privilege rp
			where rp.privilege = 'View Concept Datatypes'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Concept Datatypes' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Privileges' from role_privilege rp
			where rp.privilege = 'View Privileges'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Privileges' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Roles' from role_privilege rp
			where rp.privilege = 'View Roles'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Roles' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Field Types' from role_privilege rp
			where rp.privilege = 'View Field Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Field Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Order Types' from role_privilege rp
			where rp.privilege = 'View Order Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Order Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Relationship Types' from role_privilege rp
			where rp.privilege = 'View Relationship Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Relationship Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Concept Sources' from role_privilege rp
			where rp.privilege = 'View Concept Sources'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Concept Sources' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Concept Map Types' from role_privilege rp
			where rp.privilege = 'View Concept Map Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Concept Map Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Concept Reference Terms' from role_privilege rp
			where rp.privilege = 'View Concept Reference Terms'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Concept Reference Terms' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Programs' from role_privilege rp
			where rp.privilege = 'View Programs'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Programs' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Patient Programs' from role_privilege rp
			where rp.privilege = 'View Patient Programs'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Patient Programs' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Global Properties' from role_privilege rp
			where rp.privilege = 'View Global Properties'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Global Properties' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Person Attribute Types' from role_privilege rp
			where rp.privilege = 'View Person Attribute Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Person Attribute Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get People' from role_privilege rp
			where rp.privilege = 'View People'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get People' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Relationships' from role_privilege rp
			where rp.privilege = 'View Relationships'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Relationships' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Database Changes' from role_privilege rp
			where rp.privilege = 'View Database Changes'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Database Changes' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Problems' from role_privilege rp
			where rp.privilege = 'View Problems'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Problems' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Allergies' from role_privilege rp
			where rp.privilege = 'View Allergies'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Allergies' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get HL7 Source' from role_privilege rp
			where rp.privilege = 'View HL7 Source'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get HL7 Source' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get HL7 Inbound Queue' from role_privilege rp
			where rp.privilege = 'View HL7 Inbound Queue'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get HL7 Inbound Queue' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get HL7 Inbound Archive' from role_privilege rp
			where rp.privilege = 'View HL7 Inbound Archive'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get HL7 Inbound Archive' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get HL7 Inbound Exception' from role_privilege rp
			where rp.privilege = 'View HL7 Inbound Exception'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get HL7 Inbound Exception' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Visit Types' from role_privilege rp
			where rp.privilege = 'View Visit Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Visit Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Visits' from role_privilege rp
			where rp.privilege = 'View Visits'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Visits' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Visit Attribute Types' from role_privilege rp
			where rp.privilege = 'View Visit Attribute Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Visit Attribute Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Location Attribute Types' from role_privilege rp
			where rp.privilege = 'View Location Attribute Types'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Location Attribute Types' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Providers' from role_privilege rp
			where rp.privilege = 'View Providers'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Providers' and rp2.role=rp.role);
			
			insert into role_privilege (role, privilege) 
			select role, 'Get Encounter Roles' from role_privilege rp
			where rp.privilege = 'View Encounter Roles'
			and not exists (select role, privilege from role_privilege rp2 where rp2.privilege='Get Encounter Roles' and rp2.role=rp.role);
		</sql>
	</changeSet>
	
	<changeSet id="1-increase-privilege-col-size-privilege" author="dkayiwa">
        <validCheckSum>3:b5f33650ea723f2304f40fd60fde36df</validCheckSum><!-- old -->
        <validCheckSum>3:6ecff8787eca17532e310087cfd65a06</validCheckSum><!-- New after fixing bug where we have to first drop constraints -->
        <preConditions onFail="MARK_RAN">
			<columnExists tableName="privilege" columnName="privilege"/>
		</preConditions>
		<comment>
			Increasing the size of the privilege column in the privilege table
		</comment>
        <dropForeignKeyConstraint constraintName="privilege_which_can_edit" baseTableName="person_attribute_type" />
        <dropForeignKeyConstraint constraintName="privilege_definitons" baseTableName="role_privilege" />
		<ext:modifyColumn tableName="privilege">
		    <column name="privilege" type="varchar(255)">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
        <addForeignKeyConstraint baseTableName="person_attribute_type" baseColumnNames="edit_privilege" constraintName="privilege_which_can_edit"
                                 referencedTableName="privilege" referencedColumnNames="privilege"/>
        <addForeignKeyConstraint constraintName="privilege_definitions"
                                 baseTableName="role_privilege" baseColumnNames="privilege"
                                 referencedTableName="privilege" referencedColumnNames="privilege"/>
	</changeSet>
	
	<changeSet id="2-increase-privilege-col-size-rol-privilege" author="dkayiwa">
        <validCheckSum>3:96a937a1719f8e7a98ad682a5608f54b</validCheckSum><!-- old -->
        <validCheckSum>3:6fc0247ae054fedeb32a4af3775046f4</validCheckSum><!-- New after fixing bug where we have to first drop constraints -->
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="role_privilege" columnName="privilege"/>
		</preConditions>
		<comment>
			Increasing the size of the privilege column in the role_privilege table
		</comment>
        <dropForeignKeyConstraint constraintName="privilege_definitions" baseTableName="role_privilege" />
		<ext:modifyColumn tableName="role_privilege">
		    <column name="privilege" type="varchar(255)">
				<constraints nullable="false" />
			</column>
		</ext:modifyColumn>
        <addForeignKeyConstraint constraintName="privilege_definitions"
                                 baseTableName="role_privilege" baseColumnNames="privilege"
                                 referencedTableName="privilege" referencedColumnNames="privilege"/>
	</changeSet>
	
	<changeSet id="201205241728-1" author="mvorobey">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="encounter_type" columnName="view_privilege"/></not>
		</preConditions>
		<comment>
			Add optional property view_privilege to encounter_type table
		</comment>		
		<addColumn tableName="encounter_type">
			<column name="view_privilege" type="varchar(255)">
				<constraints nullable="true"/>
			</column>
		</addColumn>
		<addForeignKeyConstraint constraintName="privilege_which_can_view_encounter_type"
			baseTableName="encounter_type" baseColumnNames="view_privilege"
			referencedTableName="privilege" referencedColumnNames="privilege"/>
	</changeSet>
	
	<changeSet id="201205241728-2" author="mvorobey">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="encounter_type" columnName="edit_privilege"/></not>
		</preConditions>
		<comment>
			Add optional property edit_privilege to encounter_type table
		</comment>		
		<addColumn tableName="encounter_type">
			<column name="edit_privilege" type="varchar(255)">
				<constraints nullable="true"/>
			</column>
		</addColumn>
		<addForeignKeyConstraint constraintName="privilege_which_can_edit_encounter_type"
			baseTableName="encounter_type" baseColumnNames="edit_privilege"
			referencedTableName="privilege" referencedColumnNames="privilege"/>
	</changeSet>
	
	<changeSet id="3-increase-privilege-col-size-person_attribute_type" author="dkayiwa">
		<validCheckSum>3:f8e6499f5839e64223d9fb7cbe8cdbc6</validCheckSum><!-- TRUNK-3909 -->
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="person_attribute_type" columnName="edit_privilege"/>
		</preConditions>
		<comment>
			Increasing the size of the edit_privilege column in the person_attribute_type table
		</comment>
		<dropForeignKeyConstraint baseTableName="person_attribute_type" constraintName="privilege_which_can_edit"/>
		<ext:modifyColumn tableName="person_attribute_type">
		    <column name="edit_privilege" type="varchar(255)" />
		</ext:modifyColumn>
		<addForeignKeyConstraint baseTableName="person_attribute_type" baseColumnNames="edit_privilege" constraintName="privilege_which_can_edit"
                                 referencedTableName="privilege" referencedColumnNames="privilege"/>
	</changeSet>
	
	<changeSet id="20120613-0930" author="wyclif">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="provider" columnName="identifier" />
		</preConditions>
		<comment>
			Dropping not null constraint from provider.identifier column
		</comment>
		<dropNotNullConstraint tableName="provider" columnName="identifier" columnDataType="varchar(255)" />
	</changeSet>
	
	<changeSet id="20101209-1353" author="wyclif">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="drug_order" columnName="as_needed"/>
		</preConditions>
		<comment>Adding not-null constraint to orders.as_needed</comment>
		<addNotNullConstraint tableName="drug_order" columnName="as_needed" columnDataType="smallint" />
	</changeSet>

    <changeSet id="20120503-djmod" author="dkayiwa and djazayeri">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="test_order" />
            </not>
        </preConditions>
        <comment>Create test_order table</comment>
        <createTable tableName="test_order">
            <column name="order_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="specimen_source" type="int" />
            <column name="laterality" type="varchar(20)" />
            <column name="clinical_history" type="text" />
        </createTable>
        <addForeignKeyConstraint constraintName="test_order_order_id_fk"
                                 baseTableName="test_order" baseColumnNames="order_id"
                                 referencedTableName="orders" referencedColumnNames="order_id" />
        <addForeignKeyConstraint constraintName="test_order_specimen_source_fk"
                                 baseTableName="test_order" baseColumnNames="specimen_source"
                                 referencedTableName="concept" referencedColumnNames="concept_id" />
    </changeSet>

    <changeSet id="20121007-orders_urgency" author="djazayeri">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="orders" columnName="urgency" /></not>
        </preConditions>
        <comment>Adding urgency column to orders table</comment>
        <addColumn tableName="orders">
            <column name="urgency" type="varchar(50)" defaultValue="ROUTINE">
                <constraints nullable="false" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="20121007-test_order_laterality" author="djazayeri">
        <comment>Changing test_order.laterality to be a varchar</comment>
        <modifyDataType tableName="test_order" columnName="laterality" newDataType="varchar(20)"/>
    </changeSet>

    <changeSet id="20121008-order_specimen_source_fk" author="djazayeri">
        <preConditions onFail="MARK_RAN">
            <not><foreignKeyConstraintExists foreignKeyName="test_order_specimen_source_fk"/></not>
        </preConditions>
        <comment>Adding FK constraint for test_order.specimen_source if necessary</comment>
        <addForeignKeyConstraint constraintName="test_order_specimen_source_fk"
                                 baseTableName="test_order" baseColumnNames="specimen_source"
                                 referencedTableName="concept" referencedColumnNames="concept_id" />
    </changeSet>
    
    <changeSet id="20121016-1504" author="wyclif">
    	<validCheckSum>3:ca4bde46e2fe247d1d4d227a539ff465</validCheckSum><!-- TRUNK-3909 -->
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="test_order" columnName="order_id"/>
		</preConditions>
		<comment>Removing auto increment from test_order.order_id column</comment>
		<dropForeignKeyConstraint baseTableName="test_order" constraintName="test_order_order_id_fk"/>
		<ext:modifyColumn tableName="test_order">
		    <column name="order_id" type="int" />
		</ext:modifyColumn>
		<addForeignKeyConstraint constraintName="test_order_order_id_fk"
			baseTableName="test_order" baseColumnNames="order_id"
			referencedTableName="orders" referencedColumnNames="order_id" />
	</changeSet>

    <changeSet id="20121020-TRUNK-3610" author="lluismf">
		<comment>
			Rename global property autoCloseVisits.visitType to visits.autoCloseVisitType
		</comment>
		<update tableName="global_property">
			<column name="property" value="visits.autoCloseVisitType"/>
			<where>property='autoCloseVisits.visitType'</where>
		</update>
		<update tableName="scheduler_task_config">
			<column name="description" value="Stops all active visits that match the visit type(s) specified by the value of the global property 'visits.autoCloseVisitType'"/>
			<where>name='Auto Close Visits Task'</where>
		</update>
	</changeSet>
	
	<changeSet id="20121025-TRUNK-213" author="lluismf">
		<comment>Normalize varchar length of locale columns</comment>
		<ext:modifyColumn tableName="concept_stop_word">
			<column name="locale" type="varchar(50)"/>
		</ext:modifyColumn>
		<ext:modifyColumn tableName="concept_word">
			<column name="locale" type="varchar(50)"/>
		</ext:modifyColumn>
	</changeSet>
    
    <changeSet id="20121021-TRUNK-333" author="lluismf">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="concept_set_derived" />
		</preConditions>
		<comment>Removing concept set derived table</comment>
		<dropTable tableName="concept_set_derived"/>
	</changeSet>
	
	<changeSet id="20121109-TRUNK-3474" author="patandre">
		<comment>
			Dropping not null constraint from concept_class.description column
		</comment>
		<dropNotNullConstraint tableName="concept_class" columnName="description" columnDataType="varchar(255)" />
	</changeSet>
	
	<changeSet id="20121112-TRUNK-3474" author="patandre">
		<comment>
			Dropping not null constraint from concept_datatype.description column
		</comment>
		<dropNotNullConstraint tableName="concept_datatype" columnName="description" columnDataType="varchar(255)" />
	</changeSet>

	<changeSet id="20121113-TRUNK-3474" author="patandre">
		<comment>
			Dropping not null constraint from patient_identifier_type.description column
		</comment>
		<dropNotNullConstraint tableName="patient_identifier_type" columnName="description" columnDataType="text" />
	</changeSet>

	<changeSet id="20121113-TRUNK-3474-person-attribute-type" author="patandre">
		<comment>
			Dropping not null constraint from person_attribute_type.description column
		</comment>
		<dropNotNullConstraint tableName="person_attribute_type" columnName="description" columnDataType="text" />
	</changeSet>

	<changeSet id="20121113-TRUNK-3474-privilege" author="patandre">
		<comment>
			Dropping not null constraint from privilege.description column
		</comment>
		<dropNotNullConstraint tableName="privilege" columnName="description" columnDataType="text" />
	</changeSet>

	<changeSet id="20121114-TRUNK-3474-role" author="patandre">
		<comment>
			Dropping not null constraint from role.description column
		</comment>
		<dropNotNullConstraint tableName="role" columnName="description" columnDataType="varchar(255)" />
	</changeSet>

	<changeSet id="20121114-TRUNK-3474-relationship_type" author="patandre">
		<comment>
			Dropping not null constraint from relationship_type.description column
		</comment>
		<dropNotNullConstraint tableName="relationship_type" columnName="description" columnDataType="varchar(255)" />
	</changeSet>

	<changeSet id="20121114-TRUNK-3474-encounter_type" author="patandre">
		<comment>
			Dropping not null constraint from encounter_type.description column
		</comment>
		<dropNotNullConstraint tableName="encounter_type" columnName="description" columnDataType="text" />
	</changeSet>

	<changeSet id="20121212-TRUNK-2768" author="patandre">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="person" columnName="deathdate_estimated"/></not>
		</preConditions>
		<comment>
			Adding deathdate_estimated column to person.
		</comment>
		<addColumn tableName="person">
                    <column defaultValueBoolean="false" name="deathdate_estimated" type="BOOLEAN">
                        <constraints nullable="false"/>
                    </column>
		</addColumn>
	</changeSet>
    <changeSet id="20130626-TRUNK-439" author="jthoenes">
        <comment>
            Adding configurability to Patient Header on Dashboard. Therefore the cd4_count property is dropped and
            replaced with a header.showConcept property.
        </comment>
        <update tableName="global_property">
            <column name="property"
                    value="dashboard.header.showConcept" />
            <column name="description"
                    value="Comma delimited list of concepts ids to show on the patient header overview" />
            <where>
                property='concept.cd4_count'
            </where>
        </update>
    </changeSet>

	<changeSet id="201306141103-TRUNK-3884" author="susantan">
		<comment>Adding 3 foreign key relationships (creator,created_by,voided_by) to encounter_provider table</comment>
		<addForeignKeyConstraint constraintName="encounter_provider_creator" baseTableName="encounter_provider" baseColumnNames="creator" referencedTableName="users" referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="encounter_provider_changed_by" baseTableName="encounter_provider" baseColumnNames="changed_by" referencedTableName="users" referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="encounter_provider_voided_by" baseTableName="encounter_provider" baseColumnNames="voided_by" referencedTableName="users" referencedColumnNames="user_id"/>
	</changeSet>
	<changeSet id="20130925-TRUNK-4105" author="hannes">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="idx_code_concept_reference_term"/></not>
		</preConditions>
		<comment>Adding index on concept_reference_term.code column</comment>
		<createIndex tableName="concept_reference_term" indexName="idx_code_concept_reference_term">
			<column name="code"/>
		</createIndex>
	</changeSet>
	<changeSet id="20131023-TRUNK-3903" author="k-joseph">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_numeric" columnName="display_precision"/></not>
		</preConditions>
		<comment>Adding "display_precision" column to concept_numeric table</comment>
		<addColumn tableName="concept_numeric">
			<column name="display_precision" type="int" />
		</addColumn>
	</changeSet>
	
 	<changeSet id="20130809-TRUNK-4044-duplicateEncounterRoleChangeSet" author="surangak">
		<preConditions onFail="MARK_RAN">
		<not>
			<sqlCheck expectedResult = "0">
				<![CDATA[
					SELECT count(*) from encounter_role;
				]]>
			</sqlCheck>
			</not>
		</preConditions>
		<comment>Custom changesets to identify and resolve duplicate EncounterRole names</comment>
		<customChange class="org.openmrs.util.databasechange.DuplicateEncounterRoleNameChangeSet"></customChange>
	</changeSet>
	
	<changeSet id="20130809-TRUNK-4044-duplicateEncounterTypeChangeSet" author="surangak">
		<preConditions onFail="MARK_RAN">
		<not>
			<sqlCheck expectedResult = "0">
				<![CDATA[
					SELECT count(*) from encounter_type;
				]]>
			</sqlCheck>
			</not>
		</preConditions>
		<comment>Custom changesets to identify and resolve duplicate EncounterType names</comment>
		<customChange class="org.openmrs.util.databasechange.DuplicateEncounterTypeNameChangeSet"></customChange>
	</changeSet>

	<changeSet id="20130809-TRUNK-4044-encounter_type_unique_name_constraint" author="surangak">
			<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="encounter_type_unique_name" />
			</not>
		</preConditions>
		<comment>
			Adding the unique constraint to the encounter_type.name column 
		</comment>
		<addUniqueConstraint tableName="encounter_type" columnNames="name" constraintName="encounter_type_unique_name"/>
	</changeSet>
	
		<changeSet id="20130809-TRUNK-4044-encounter_role_unique_name_constraint" author="surangak">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="encounter_role_unique_name" />
			</not>
		</preConditions>
		<comment>
			Adding the unique constraint to the encounter_role.name column 
		</comment>
		<addUniqueConstraint tableName="encounter_role" columnNames="name" constraintName="encounter_role_unique_name"/>
	</changeSet>

	<changeSet id="201401040436-TRUNK-3919" author="dkithmal">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="location_tag" columnName="changed_by" />
			</not>
		</preConditions>
		<comment>
			Add changed_by column to location_tag table
		</comment>
		<addColumn tableName="location_tag">
			<column name="changed_by" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="location_tag_changed_by"
			baseTableName="location_tag" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
		
	<changeSet id="201401040438-TRUNK-3919" author="dkithmal">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="location_tag" columnName="date_changed" />
			</not>
		</preConditions>
		<comment>
			Add date_changed column to location_tag table
		</comment>
		<addColumn tableName="location_tag">
			<column name="date_changed" type="datetime" />
		</addColumn>
	</changeSet>
		<changeSet id="201401040440-TRUNK-3919" author="dkithmal">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="location" columnName="changed_by" />
			</not>
		</preConditions>
		<comment>
			Add changed_by column to location table
		</comment>
		<addColumn tableName="location">
			<column name="changed_by" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="location_changed_by"
			baseTableName="location" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
		
	<changeSet id="201401040442-TRUNK-3919" author="dkithmal">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="location" columnName="date_changed" />
			</not>
		</preConditions>
		<comment>
			Add date_changed column to location table
		</comment>
		<addColumn tableName="location">
			<column name="date_changed" type="datetime" />
		</addColumn>
	</changeSet>

    <changeSet id="201401101647-TRUNK-4187" author="wyclif">
        <preConditions onFail="HALT" onFailMessage="Found unmapped drug order units or frequencies, for more details on how to fix this see https://wiki.openmrs.org/x/OALpAw">
            <customPrecondition className="org.openmrs.util.databasechange.CheckDrugOrderUnitAndFrequencyTextNotMappedToConcepts" />
        </preConditions>
        <comment>
            Checks that all existing free text drug order dose units and frequencies have been mapped to
            concepts, this will fail the upgrade process if any unmapped text is found
        </comment>
    </changeSet>

    <changeSet id="20140314-TRUNK-4283" author="dszafranek, wyclif">
        <preConditions onFail="HALT" onFailMessage="orders.start_date column is required as of version 1.10, for more details on how to fix this see https://wiki.openmrs.org/x/OALpAw">
            <sqlCheck expectedResult="0">SELECT COUNT(*) from orders where start_date is NULL</sqlCheck>
        </preConditions>
        <comment>Checking that all orders have start_date column set</comment>
    </changeSet>

    <changeSet id="20140635-TRUNK-4283" author="dszafranek, wyclif">
        <preConditions onFail="HALT" onFailMessage="orders.orderer column is required as of version 1.10, for more details on how to fix this see https://wiki.openmrs.org/x/OALpAw">
            <or>
                <sqlCheck expectedResult="0">SELECT COUNT(*) FROM orders WHERE orderer IS NULL</sqlCheck>
                <not>
                    <sqlCheck expectedResult="0">
                        SELECT COUNT(*) FROM provider
                        WHERE uuid = (SELECT property_value FROM global_property WHERE property = 'provider.unknownProviderUuid')
                    </sqlCheck>
                </not>
            </or>
        </preConditions>
        <comment>Checking that all orders have orderer column set</comment>
    </changeSet>

    <changeSet id="20140316-TRUNK-4283" author="dszafranek, wyclif">
        <preConditions onFail="HALT" onFailMessage="orders.encounter_id column is required as of version 1.10, for more details on how to fix this see https://wiki.openmrs.org/x/OALpAw">
            <sqlCheck expectedResult="0">SELECT COUNT(*) from orders where encounter_id is NULL</sqlCheck>
        </preConditions>
        <comment>Checking that all orders have encounter_id column set</comment>
    </changeSet>

    <changeSet id="201403262140-TRUNK-4265" author="wyclif">
        <preConditions onFail="HALT" onFailMessage="Found drugs with dose strength specified but no units, for more details on how to fix this see https://wiki.openmrs.org/x/OALpAw">
            <sqlCheck expectedResult="0">
                SELECT COUNT(drug_id) FROM drug WHERE dose_strength IS NOT NULL AND (units IS NULL OR units = '')
            </sqlCheck>
        </preConditions>
        <comment>Checking if there are any drugs with the dose_strength specified but no units</comment>
    </changeSet>

    <!-- If the order_type table is empty, or has already been updated(has the new columns added in 1.10),
        assume the admin has set up things properly, otherwise they should have exactly one order type
        row which MUST be for drug orders for the scripts to auto update the table for them -->
    <changeSet id="201404091110" author="wyclif">
        <preConditions onFail="HALT" onFailMessage="Cannot update order_type table, please see this page https://wiki.openmrs.org/x/OALpAw for how to modify the order_type table before upgrading">
            <or>
                <sqlCheck expectedResult="0">SELECT COUNT(*) FROM order_type</sqlCheck>
                <and>
                    <columnExists tableName="order_type" columnName="java_class_name" />
                    <columnExists tableName="order_type" columnName="parent" />
                </and>
                <and>
                    <sqlCheck expectedResult="1">SELECT COUNT(*) FROM order_type</sqlCheck>
                    <sqlCheck expectedResult="1">
                        SELECT COUNT(*) FROM order_type WHERE uuid = '131168f4-15f5-102d-96e4-000c29c2a5d7';
                    </sqlCheck>
                </and>
            </or>
        </preConditions>
        <comment>Checking if order_type table is already up to date or can be updated automatically</comment>
    </changeSet>

    <changeSet id="201406262016" author="wyclif">
        <preConditions onFail="HALT" onFailMessage="Order orderers need to have provider accounts in order to upgrade, for more details on how to fix this see https://wiki.openmrs.org/x/OALpAw">
            <sqlCheck expectedResult="0">
                SELECT count(o.order_id) FROM orders o, users u WHERE o.orderer = u.user_id
                AND o.orderer IS NOT NULL
                AND u.person_id NOT IN (SELECT DISTINCT person_id FROM provider where person_id is not null)
            </sqlCheck>
        </preConditions>
        <comment>Checking that all users that created orders have provider accounts</comment>
    </changeSet>

    <changeSet id="201406211643-TRUNK-4401" author="harsz89">
        <preConditions onFail="HALT" onFailMessage="discontinued orders cannot have null discontinued_date values, for more details on how to fix this see https://wiki.openmrs.org/x/OALpAw">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) from orders where discontinued = true and  discontinued_date is null
            </sqlCheck>
        </preConditions>
        <comment>Checking that all discontinued orders have the discontinued_date column set</comment>
    </changeSet>

    <changeSet id="201406211703-TRUNK-4401" author="harsz89">
        <preConditions onFail="HALT" onFailMessage="discontinued orders cannot have null discontinued_by values, for more details on how to fix this see https://wiki.openmrs.org/x/OALpAw">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) from orders where discontinued = true and discontinued_by is null
            </sqlCheck>
        </preConditions>
        <comment>Checking that all discontinued orders have the discontinued_by column set </comment>
    </changeSet>

    <changeSet id="201404091112" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="order_type" columnName="name" />
        </preConditions>
        <comment>Adding unique key constraint to order_type.name column</comment>
        <addUniqueConstraint tableName="order_type" columnNames="name" />
    </changeSet>

    <changeSet id="201404091128" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="order_type" columnName="java_class_name" /></not>
        </preConditions>
        <comment>Adding java_class_name column to order_type table</comment>
        <addColumn tableName="order_type">
            <column name="java_class_name" type="varchar(255)" />
        </addColumn>
    </changeSet>

    <changeSet id="201404091129" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="order_type" columnName="parent" /></not>
        </preConditions>
        <comment>Adding parent column to order_type table</comment>
        <addColumn tableName="order_type">
            <column name="parent" type="int"/>
        </addColumn>
    </changeSet>

    <changeSet id="201404101130" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM order_type
                WHERE uuid = '131168f4-15f5-102d-96e4-000c29c2a5d7' AND java_class_name IS NULL
            </sqlCheck>
        </preConditions>
        <comment>Setting java_class_name column for drug order type row</comment>
        <update tableName="order_type">
            <column name="java_class_name" value="org.openmrs.DrugOrder" />
            <where>uuid = '131168f4-15f5-102d-96e4-000c29c2a5d7'</where>
        </update>
    </changeSet>

    <changeSet id="201404091131" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="order_type" columnName="java_class_name" />
        </preConditions>
        <comment>Add not-null constraint on order_type.java_class_name column</comment>
        <addNotNullConstraint tableName="order_type" columnName="java_class_name" columnDataType="varchar(255)" />
    </changeSet>

    <changeSet id="201403070132-TRUNK-4286" author="andras-szell">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from order_type where java_class_name = 'org.openmrs.TestOrder'</sqlCheck>
        </preConditions>
        <comment>Insert order type for test orders</comment>
        <insert tableName="order_type">
            <column name="name" value="Test Order" />
            <column name="description" value="Order type for test orders" />
            <column name="java_class_name" value="org.openmrs.TestOrder" />
            <column name="creator" valueNumeric="1" />
            <column name="date_created" valueDate="2014-03-09" />
            <column name="retired" valueNumeric="0" />
            <column name="uuid" value="52a447d3-a64a-11e3-9aeb-50e549534c5e" />
        </insert>
    </changeSet>

    <changeSet id="201402241055" author="Akshika">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="orders" columnName="start_date" />
        </preConditions>
        <comment>Making orders.start_date not nullable</comment>
        <ext:modifyColumn tableName="orders">
            <column name="start_date" type="DATETIME">
                <constraints nullable="false" />
            </column>
        </ext:modifyColumn>
    </changeSet>

    <changeSet id="201402281648-TRUNK-4274" author="k-joseph">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="orders" columnName="encounter_id" />
        </preConditions>
        <comment>Making order.encounter required</comment>
        <ext:modifyColumn tableName="orders">
            <column name="encounter_id" type="int">
                <constraints nullable="false" />
            </column>
        </ext:modifyColumn>
    </changeSet>

    <changeSet id="201311041510" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug_order" columnName="as_needed" /></not>
            <columnExists tableName="drug_order" columnName="prn" />
        </preConditions>
        <comment>Renaming drug_order.prn column to drug_order.as_needed</comment>
        <renameColumn tableName="drug_order" oldColumnName="prn" newColumnName="as_needed" columnDataType="boolean" />
    </changeSet>

    <changeSet id="201311041511" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug_order" columnName="as_needed_condition"/></not>
        </preConditions>
        <comment>Adding as_needed_condition column to drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="as_needed_condition" type="varchar(255)" />
        </addColumn>
    </changeSet>

    <changeSet id="201311041512" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="orders" columnName="order_number"/></not>
        </preConditions>
        <comment>Adding order_number column to orders table</comment>
        <addColumn tableName="orders">
            <column name="order_number" type="varchar(50)" />
        </addColumn>
    </changeSet>

    <changeSet id="201311041513" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    select count(*) from orders
                </sqlCheck>
            </not>
        </preConditions>
        <comment>
            Setting order numbers for existing orders
        </comment>
        <update tableName="orders">
            <column name="order_number" valueComputed="order_id" />
        </update>
    </changeSet>

    <changeSet id="201311041515-TRUNK-4122" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="orders" columnName="order_number" />
        </preConditions>
        <comment>Making orders.order_number not nullable</comment>
        <addNotNullConstraint tableName="orders" columnName="order_number" columnDataType="varchar(50)" />
    </changeSet>

    <changeSet id="201310281153-TRUNK-4123" author="mujir,sushmitharaos">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="orders" columnName="previous_order_id"/></not>
        </preConditions>

        <comment>Adding previous_order_id to orders</comment>

        <addColumn tableName="orders">
            <column name="previous_order_id" type="int" />
        </addColumn>

        <addForeignKeyConstraint constraintName="previous_order_id_order_id" baseTableName="orders" baseColumnNames="previous_order_id" referencedTableName="orders" referencedColumnNames="order_id"/>
    </changeSet>

    <changeSet id="201310281153-TRUNK-4124" author="mujir,sushmitharaos">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="orders" columnName="order_action"/></not>
        </preConditions>

        <comment>Adding order_action to orders and setting order_actions as NEW for existing orders</comment>

        <addColumn tableName="orders">
            <column name="order_action" type="varchar(50)"/>
        </addColumn>

        <update tableName="orders">
            <column name="order_action" value="NEW"/>
        </update>

        <addNotNullConstraint tableName="orders" columnName="order_action" columnDataType="varchar(50)"/>
    </changeSet>

    <changeSet id="201312141400-TRUNK-4126" author="arathy">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug_order" columnName="dosing_type"/></not>
        </preConditions>
        <comment>Renaming drug_order.complex to dosing_type</comment>
        <modifyDataType tableName="drug_order" columnName="complex" newDataType="varchar(50)"/>
        <renameColumn tableName="drug_order" oldColumnName="complex" newColumnName="dosing_type" columnDataType="varchar(50)"/>
    </changeSet>

    <changeSet id="201312141401-TRUNK-4126" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="drug_order" columnName="dosing_type"/>
        </preConditions>
        <comment>Making drug_order.dosing_type nullable</comment>
        <dropNotNullConstraint tableName="drug_order" columnName="dosing_type" columnDataType="varchar(50)" />
    </changeSet>

    <changeSet id="201312141400-TRUNK-4127" author="arathy">
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">SELECT count(*) FROM drug_order</sqlCheck>
            </not>
        </preConditions>
        <comment>Converting values in drug_order.dosing_type column</comment>
        <update tableName="drug_order">
            <column name="dosing_type" value="SIMPLE"/>
            <where>dosing_type = '0'</where>
        </update>
        <update tableName="drug_order">
            <column name="dosing_type" value="FREE_TEXT"/>
            <where>dosing_type = '1'</where>
        </update>
    </changeSet>

    <changeSet id="20131210-TRUNK-4130" author="k-joseph">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug_order" columnName="num_refills"/></not>
        </preConditions>

        <comment>Adding num_refills column to drug_order table</comment>

        <addColumn tableName="drug_order">
            <column name="num_refills" type="int"/>
        </addColumn>
    </changeSet>

    <changeSet id="201312171559-TRUNK-4159" author="k-joseph">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="order_frequency"/></not>
        </preConditions>

        <comment>Create the order_frequency table</comment>
        <createTable tableName="order_frequency">
            <column autoIncrement="true" name="order_frequency_id" type="int">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="concept_id" type="int"><constraints nullable="false" unique="true"/></column>
            <column name="frequency_per_day" type="double"/>
            <column name="creator" type="int"><constraints nullable="false"/></column>
            <column name="date_created" type="datetime"><constraints nullable="false"/></column>
            <column name="retired" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="retired_by" type="int" />
            <column name="date_retired" type="datetime"/>
            <column name="retire_reason" type="varchar(255)" />
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime" />
            <column name="uuid" type="char(38)"><constraints nullable="false" unique="true"/></column>
        </createTable>

        <addForeignKeyConstraint constraintName="order_frequency_concept_id_fk" baseTableName="order_frequency" baseColumnNames="concept_id" referencedTableName="concept" referencedColumnNames="concept_id"/>
        <addForeignKeyConstraint constraintName="order_frequency_creator_fk" baseTableName="order_frequency" baseColumnNames="creator" referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="order_frequency_retired_by_fk" baseTableName="order_frequency" baseColumnNames="retired_by" referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="order_frequency_changed_by_fk" baseTableName="order_frequency" baseColumnNames="changed_by" referencedTableName="users" referencedColumnNames="user_id"/>

    </changeSet>

    <changeSet id="20131217-TRUNK-4157" author="banka">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug_order" columnName="dosing_instructions"/></not>
        </preConditions>
        <comment>Adding dosing_instructions column to drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="dosing_instructions" type="text"/>
        </addColumn>
    </changeSet>

    <changeSet id="20131217-TRUNK-4142" author="banka">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="orders" columnName="comment_to_fulfiller"/></not>
        </preConditions>
        <comment>Adding comment_to_fulfiller column to orders table</comment>
        <addColumn tableName="orders">
            <column name="comment_to_fulfiller" type="varchar(1024)"/>
        </addColumn>
    </changeSet>

    <changeSet id="201312162044-TRUNK-4126" author="k-joseph">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="drug_order" columnName="duration" />
            </not>
        </preConditions>
        <comment>Adding duration column to drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="duration" type="double" />
        </addColumn>
    </changeSet>

    <changeSet id="201312162059-TRUNK-4126" author="k-joseph">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="drug_order" columnName="duration_units" />
            </not>
        </preConditions>
        <comment>Adding duration_units column to drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="duration_units" type="int" />
        </addColumn>
        <addForeignKeyConstraint constraintName="drug_order_duration_units_fk"
                                 baseTableName="drug_order" baseColumnNames="duration_units"
                                 referencedTableName="concept" referencedColumnNames="concept_id" />
    </changeSet>

    <changeSet id="201312161618-TRUNK-4129" author="rkorytkowski">
        <preConditions onFail="MARK_RAN">
            <not><foreignKeyConstraintExists foreignKeyName="drug_order_quantity_units"/></not>
        </preConditions>
        <comment>Adding quantity_units column to drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="quantity_units" type="int" value="NULL"/>
        </addColumn>
        <addForeignKeyConstraint baseTableName="drug_order" baseColumnNames="quantity_units"
                                 constraintName="drug_order_quantity_units"
                                 referencedTableName="concept"
                                 referencedColumnNames="concept_id"/>
    </changeSet>

    <changeSet id="201312161713-TRUNK-4129" author="rkorytkowski">
        <comment>Changing quantity column of drug_order to double</comment>
        <modifyDataType tableName="drug_order" columnName="quantity" newDataType="double"/>
    </changeSet>

    <changeSet id="201312182214-TRUNK-4136" author="k-joseph">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="drug_order" columnName="route" />
            </not>
        </preConditions>
        <comment>Adding route column to drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="route" type="int" />
        </addColumn>
        <addForeignKeyConstraint constraintName="drug_order_route_fk"
                                 baseTableName="drug_order" baseColumnNames="route" referencedTableName="concept"
                                 referencedColumnNames="concept_id" />
    </changeSet>

    <changeSet id="201312182223-TRUNK-4136" author="k-joseph">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="drug_order" columnName="equivalent_daily_dose" />
        </preConditions>
        <comment>Dropping equivalent_daily_dose column from drug_order table
        </comment>
        <dropColumn tableName="drug_order" columnName="equivalent_daily_dose" />
    </changeSet>

    <changeSet id="201312191200-TRUNK-4167" author="banka">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug_order" columnName="dose_units"/></not>
        </preConditions>
        <comment>Adding dose_units column to drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="dose_units" type="int"/>
        </addColumn>
    </changeSet>

    <changeSet id="201312191300-TRUNK-4167" author="banka">
        <preConditions onFail="MARK_RAN">
            <not><foreignKeyConstraintExists foreignKeyName="drug_order_dose_units"/></not>
        </preConditions>
        <comment>Adding foreignKey constraint on dose_units</comment>
        <addForeignKeyConstraint baseTableName="drug_order" baseColumnNames="dose_units"
                                 constraintName="drug_order_dose_units"
                                 referencedTableName="concept"
                                 referencedColumnNames="concept_id"/>
    </changeSet>

    <changeSet id="201312201200-TRUNK-4167" author="banka">
        <preConditions onFail="MARK_RAN">
            <not><sqlCheck expectedResult="0">select count(*) from drug_order</sqlCheck></not>
        </preConditions>
        <comment>Migrating old text units to coded dose_units in drug_order</comment>
        <customChange class="org.openmrs.util.databasechange.MigrateDrugOrderUnitsToCodedDoseUnitsChangeset" />
    </changeSet>

    <changeSet id="201312201800-TRUNK-4167" author="banka">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="drug_order" columnName="units"/>
        </preConditions>
        <comment>Deleting units column</comment>
        <dropColumn tableName="drug_order" columnName="units"/>
    </changeSet>

    <changeSet id="201312181649-TRUNK-4137" author="k-joseph">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="test_order" columnName="frequency" />
            </not>
        </preConditions>
        <comment>Adding frequency column to test_order table</comment>
        <addColumn tableName="test_order">
            <column name="frequency" type="int" />
        </addColumn>
        <addForeignKeyConstraint constraintName="test_order_frequency_fk"
                                 baseTableName="test_order" baseColumnNames="frequency"
                                 referencedTableName="order_frequency" referencedColumnNames="order_frequency_id" />
    </changeSet>

    <changeSet id="201312181650-TRUNK-4137" author="k-joseph">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="test_order" columnName="number_of_repeats" />
            </not>
        </preConditions>
        <comment>Adding number_of_repeats column to test_order table</comment>
        <addColumn tableName="test_order">
            <column name="number_of_repeats" type="int" />
        </addColumn>
    </changeSet>

    <changeSet id="201312201640-TRUNK-4138" author="banka">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="orders" columnName="date_stopped"/></not>
        </preConditions>
        <comment>Rename orders.discontinued_date to date_stopped</comment>
        <renameColumn tableName="orders" oldColumnName="discontinued_date" newColumnName="date_stopped" columnDataType="datetime"/>
    </changeSet>

    <changeSet id="201312201523-TRUNK-4138" author="banka">
        <preConditions onFail="HALT" onFailMessage="Please make sure all discontinued orders have the date_stopped field set">
            <sqlCheck expectedResult="0">select count(*) from orders where discontinued = true and date_stopped is null</sqlCheck>
        </preConditions>
        <comment>Creating Discontinue Order for discontinued orders</comment>
        <customChange class="org.openmrs.util.databasechange.CreateDiscontinueOrders"/>
    </changeSet>

    <changeSet id="201312201425-TRUNK-4138" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="orders" columnName="discontinued_reason" />
            <not>
                <sqlCheck expectedResult="0">select count(*) from orders where discontinued = true</sqlCheck>
            </not>
        </preConditions>
        <comment>
            Setting order.discontinued_reason to null for stopped orders
        </comment>
        <update tableName="orders">
            <column name="discontinued_reason" value="NULL" />
            <where>discontinued = true</where>
        </update>
    </changeSet>

    <changeSet id="201312201525-TRUNK-4138" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="orders" columnName="discontinued_reason_non_coded" />
            <not>
                <sqlCheck expectedResult="0">select count(*) from orders where discontinued = true</sqlCheck>
            </not>
        </preConditions>
        <comment>
            Setting orders.discontinued_reason_non_coded to null for stopped orders
        </comment>
        <update tableName="orders">
            <column name="discontinued_reason_non_coded" value="NULL" />
            <where>discontinued = true</where>
        </update>
    </changeSet>

    <changeSet id="201312201651-TRUNK-4138" author="banka">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="orders" columnName="discontinued"/>
        </preConditions>
        <comment>Removing discontinued from orders</comment>
        <dropColumn tableName="orders" columnName="discontinued" />
    </changeSet>

    <changeSet id="201312201601-TRUNK-4138" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="user_who_discontinued_order" />
        </preConditions>
        <comment>Dropping fk constraint on orders.discontinued_by column to users.user_id column</comment>
        <dropForeignKeyConstraint baseTableName="orders" constraintName="user_who_discontinued_order" />
    </changeSet>

    <changeSet id="201312201700-TRUNK-4138" author="banka">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="orders" columnName="discontinued_by"/>
        </preConditions>
        <comment>Removing discontinued_by from orders</comment>
        <dropColumn tableName="orders" columnName="discontinued_by" />
    </changeSet>

    <changeSet id="201401031433-TRUNK-4135" author="rkorytkowski">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="drug_order" columnName="frequency" />
            <not><columnExists tableName="drug_order" columnName="frequency_text" /></not>
        </preConditions>
        <comment>Temporarily renaming drug_order.frequency column to frequency_text</comment>
        <renameColumn tableName="drug_order" oldColumnName="frequency" newColumnName="frequency_text" columnDataType="varchar(255)" />
    </changeSet>

    <changeSet id="201401031434-TRUNK-4135" author="rkorytkowski">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug_order" columnName="frequency" /></not>
            <not><foreignKeyConstraintExists foreignKeyName="drug_order_frequency_fk" /></not>
        </preConditions>
        <comment>Adding the frequency column to the drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="frequency" type="int" />
        </addColumn>
        <addForeignKeyConstraint baseTableName="drug_order" baseColumnNames="frequency"
                                 constraintName="drug_order_frequency_fk"
                                 referencedTableName="order_frequency"
                                 referencedColumnNames="order_frequency_id" />
    </changeSet>

    <changeSet id="201301031440-TRUNK-4135" author="rkorytkowski">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from order_frequency;
            </sqlCheck>
        </preConditions>
        <comment>Creating coded order frequencies for drug order frequencies</comment>
        <customChange class="org.openmrs.util.databasechange.CreateCodedOrderFrequencyForDrugOrderFrequencyChangeset"/>
    </changeSet>

    <changeSet id="201301031448-TRUNK-4135" author="rkorytkowski">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="drug_order" columnName="frequency_text" />
        </preConditions>
        <comment>Migrating drug order frequencies to coded order frequencies</comment>
        <customChange class="org.openmrs.util.databasechange.MigrateDrugOrderFrequencyToCodedOrderFrequencyChangeset" />
    </changeSet>

    <changeSet id="201301031455-TRUNK-4135" author="rkorytkowski">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="drug_order" columnName="frequency_text" />
        </preConditions>
        <comment>Dropping temporary column drug_order.frequency_text</comment>
        <dropColumn tableName="drug_order" columnName="frequency_text" />
    </changeSet>

    <changeSet id="201312271822-TRUNK-4156" author="vinay">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="care_setting"/></not>
        </preConditions>
        <comment>Adding care_setting table</comment>
        <createTable tableName="care_setting">
            <column name="care_setting_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" unique="true" />
            </column>
            <column name="description" type="varchar(255)"></column>
            <column name="care_setting_type" type="varchar(50)">
                <constraints nullable="false" />
            </column>
            <column name="creator" type="int" >
                <constraints nullable="false" />
            </column>
            <column name="date_created" type="datetime" >
                <constraints nullable="false"/>
            </column>
            <column name="retired" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="retired_by" type="int" />
            <column name="date_retired" type="datetime" />
            <column name="retire_reason" type="varchar(255)" />
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime" />
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="care_setting_creator"
                                 baseTableName="care_setting" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="care_setting_retired_by"
                                 baseTableName="care_setting" baseColumnNames="retired_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="care_setting_changed_by"
                                 baseTableName="care_setting" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
    </changeSet>

    <changeSet id="201312271823-TRUNK-4156" author="vinay">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM care_setting where care_setting_type = 'OUTPATIENT'
            </sqlCheck>
        </preConditions>
        <comment>Adding OUTPATIENT care setting</comment>
        <insert tableName="care_setting">
            <column name="name" value="Outpatient"/>
            <column name="description" value="Out-patient care setting"/>
            <column name="care_setting_type" value="OUTPATIENT"/>
            <column name="creator" valueNumeric="1"/>
            <column name="date_created" valueDate="2013-12-27T00:00:00"/>
            <column name="uuid" value="6f0c9a92-6f24-11e3-af88-005056821db0"/>
        </insert>
    </changeSet>

    <changeSet id="201312271824-TRUNK-4156" author="vinay">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM care_setting where care_setting_type = 'INPATIENT'
            </sqlCheck>
        </preConditions>
        <comment>Adding INPATIENT care setting</comment>
        <insert tableName="care_setting">
            <column name="name" value="Inpatient"/>
            <column name="description" value="In-patient care setting"/>
            <column name="care_setting_type" value="INPATIENT"/>
            <column name="creator" valueNumeric="1"/>
            <column name="date_created" valueDate="2013-12-27T00:00:00"/>
            <column name="uuid" value="c365e560-c3ec-11e3-9c1a-0800200c9a66"/>
        </insert>
    </changeSet>

    <changeSet id="201312271826-TRUNK-4156" author="vinay">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="orders" columnName="care_setting"/></not>
        </preConditions>
        <comment>Add care_setting column to orders table</comment>
        <addColumn tableName="orders">
            <column name="care_setting" type="int"/>
        </addColumn>
    </changeSet>

    <changeSet id="201312271827-TRUNK-4156" author="vinay">
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    SELECT count(*) FROM orders WHERE care_setting IS NULL
                </sqlCheck>
            </not>
        </preConditions>
        <comment>Set default value for orders.care_setting column for existing rows</comment>
        <sql splitStatements="false">
            <![CDATA[
				update orders set care_setting = (select care_setting_id from care_setting where care_setting_type = 'OUTPATIENT' limit 1)
				    where care_setting is null;
			]]>
        </sql>
    </changeSet>

    <changeSet id="201312271828-TRUNK-4156" author="vinay">
        <comment>Make care_setting column non-nullable</comment>
        <addNotNullConstraint tableName="orders" columnName="care_setting" columnDataType="int"/>
    </changeSet>

    <changeSet id="201312271829-TRUNK-4156" author="vinay">
        <preConditions onFail="MARK_RAN">
            <not><foreignKeyConstraintExists foreignKeyName="orders_care_setting"/></not>
        </preConditions>
        <comment>Add foreign key constraint</comment>
        <addForeignKeyConstraint constraintName="orders_care_setting"
                                 baseTableName="orders" baseColumnNames="care_setting"
                                 referencedTableName="care_setting" referencedColumnNames="care_setting_id"/>
    </changeSet>

    <changeSet id="20131216-1637" author="gitahi">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="drug_reference_map" />
            </not>
        </preConditions>
        <comment>Add drug_reference_map table</comment>
        <createTable tableName="drug_reference_map">
            <column name="drug_reference_map_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="drug_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="term_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="concept_map_type" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="retired" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="retired_by" type="int"/>
            <column name="date_retired" type="DATETIME"/>
            <column name="retire_reason" type="VARCHAR(255)"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="DATETIME"/>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="drug_reference_map" baseColumnNames="drug_id"
                                 constraintName="drug_for_drug_reference_map"
                                 referencedTableName="drug"
                                 referencedColumnNames="drug_id"/>
        <addForeignKeyConstraint baseTableName="drug_reference_map" baseColumnNames="term_id"
                                 constraintName="concept_reference_term_for_drug_reference_map"
                                 referencedTableName="concept_reference_term"
                                 referencedColumnNames="concept_reference_term_id"/>
        <addForeignKeyConstraint baseTableName="drug_reference_map" baseColumnNames="concept_map_type"
                                 constraintName="concept_map_type_for_drug_reference_map"
                                 referencedTableName="concept_map_type"
                                 referencedColumnNames="concept_map_type_id"/>
        <addForeignKeyConstraint baseColumnNames="changed_by" baseTableName="drug_reference_map"
                                 constraintName="user_who_changed_drug_reference_map"
                                 referencedColumnNames="user_id"
                                 referencedTableName="users"/>
        <addForeignKeyConstraint baseColumnNames="creator" baseTableName="drug_reference_map"
                                 constraintName="drug_reference_map_creator"
                                 referencedColumnNames="user_id"
                                 referencedTableName="users"/>
        <addForeignKeyConstraint baseColumnNames="retired_by" baseTableName="drug_reference_map"
                                 constraintName="user_who_retired_drug_reference_map"
                                 referencedColumnNames="user_id"
                                 referencedTableName="users"/>
    </changeSet>

    <changeSet id="201402041600-TRUNK-4138" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="discontinued_because" />
        </preConditions>
        <comment>Temporary dropping foreign key on orders.discontinued_reason column</comment>
        <dropForeignKeyConstraint baseTableName="orders" constraintName="discontinued_because" />
    </changeSet>

    <changeSet id="201402041601-TRUNK-4138" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="discontinued_reason" tableName="orders" />
        </preConditions>
        <comment>Renaming orders.discontinued_reason column to order_reason</comment>
        <renameColumn tableName="orders" newColumnName="order_reason" oldColumnName="discontinued_reason" columnDataType="int" />
    </changeSet>

    <changeSet id="201402041602-TRUNK-4138" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><foreignKeyConstraintExists foreignKeyName="discontinued_because" /></not>
        </preConditions>
        <comment>Adding back foreign key on orders.discontinued_reason column</comment>
        <addForeignKeyConstraint constraintName="discontinued_because" baseTableName="orders" baseColumnNames="order_reason"
                                 referencedTableName="concept" referencedColumnNames="concept_id" />
    </changeSet>

    <changeSet id="201402041604-TRUNK-4138" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="discontinued_reason_non_coded" tableName="orders" />
        </preConditions>
        <comment>Renaming orders.discontinued_reason_non_coded column to order_reason_non_coded</comment>
        <renameColumn tableName="orders" newColumnName="order_reason_non_coded" oldColumnName="discontinued_reason_non_coded" columnDataType="varchar(255)" />
    </changeSet>

    <changeSet id="201402051638-TRUNK-4202" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="orderer_not_drug" />
        </preConditions>
        <comment>Temporarily removing foreign key constraint from orders.orderer column</comment>
        <dropForeignKeyConstraint baseTableName="orders" constraintName="orderer_not_drug" />
    </changeSet>

    <changeSet id="201402042238-TRUNK-4202" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><sqlCheck expectedResult="0">select count(*) from orders</sqlCheck></not>
        </preConditions>
        <comment>Converting orders.orderer to reference provider.provider_id</comment>
        <customChange class="org.openmrs.util.databasechange.ConvertOrderersToProviders" />
    </changeSet>

    <changeSet id="201402051639-TRUNK-4202" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><foreignKeyConstraintExists foreignKeyName="fk_orderer_provider" /></not>
        </preConditions>
        <comment>Adding foreign key constraint to orders.orderer column</comment>
        <addForeignKeyConstraint constraintName="fk_orderer_provider" baseTableName="orders" baseColumnNames="orderer"
                                 referencedTableName="provider" referencedColumnNames="provider_id" />
    </changeSet>

    <!-- TRUNK-4690: Orders.orderer column cannot be set to NOT NULL until after user to provider migration occurs -->
    <changeSet id="201403011348" author="alexisduque">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="orders" columnName="orderer" />
        </preConditions>
        <comment>Make orders.orderer not NULLable</comment>
        <ext:modifyColumn tableName="orders">
            <column name="orderer" type="int">
                <constraints nullable="false" />
            </column>
        </ext:modifyColumn>
    </changeSet>

    <changeSet id="201403061758-TRUNK-4284" author="Banka, Vinay">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from concept_class where uuid = '8e071bfe-520c-44c0-a89b-538e9129b42a'</sqlCheck>
        </preConditions>
        <comment>Inserting Frequency concept class</comment>
        <insert tableName="concept_class">
            <column name="name" value="Frequency"/>
            <column name="description" value="A class for order frequencies"/>
            <column name="uuid" value="8e071bfe-520c-44c0-a89b-538e9129b42a" />
            <column name="creator" valueNumeric="1"/>
            <column name="date_created" valueDate="2014-03-06"/>
            <column name="retired" valueBoolean="false"/>
        </insert>
    </changeSet>

    <changeSet id="20140304816-TRUNK-4139" author="Akshika">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="orders" columnName="scheduled_date"/></not>
        </preConditions>
        <comment>Adding scheduled_date column to orders table</comment>
        <addColumn tableName="orders">
            <column name="scheduled_date" type="datetime"/>
        </addColumn>
    </changeSet>

    <changeSet id="20140313-TRUNK-4288" author="dszafranek">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="order_type_class_map"/></not>
        </preConditions>
        <comment>Add order_type_class_map table</comment>
        <createTable tableName="order_type_class_map">
            <column name="order_type_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="concept_class_id" type="int">
                <constraints nullable="false" unique="true" />
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="order_type_class_map" baseColumnNames="order_type_id" constraintName="fk_order_type_order_type_id"
                                 referencedTableName="order_type" referencedColumnNames="order_type_id"/>
        <addForeignKeyConstraint baseTableName="order_type_class_map" baseColumnNames="concept_class_id" constraintName="fk_order_type_class_map_concept_class_concept_class_id"
                                 referencedTableName="concept_class" referencedColumnNames="concept_class_id"/>
        <addPrimaryKey tableName="order_type_class_map" columnNames="order_type_id,concept_class_id" constraintName="primary_key_for_order_type_class_map" />
    </changeSet>

    <changeSet id="20140318-TRUNK-4265" author="jkondrat">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug" columnName="strength"/></not>
        </preConditions>
        <comment>Concatenate dose_strength and units to form the value for the new strength field</comment>
        <mergeColumns column1Name="dose_strength"
                      column2Name="units"
                      finalColumnName="strength"
                      finalColumnType="varchar(255)"
                      joinString=""
                      tableName="drug"/>
        <update tableName="drug">
            <column name="strength" value="NULL" />
            <where>strength = ''</where>
        </update>
    </changeSet>

    <changeSet id="201404091516" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="order_type" columnName="changed_by" /></not>
        </preConditions>
        <comment>Add changed_by column to order_type table</comment>
        <addColumn tableName="order_type">
            <column name="changed_by" type="int" />
        </addColumn>
        <addForeignKeyConstraint constraintName="order_type_changed_by" baseTableName="order_type" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id" />
    </changeSet>

    <changeSet id="201404091517" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="order_type" columnName="date_changed" /></not>
        </preConditions>
        <comment>Add date_changed column to order_type table</comment>
        <addColumn tableName="order_type">
            <column name="date_changed" type="datetime" />
        </addColumn>
    </changeSet>

    <changeSet id="201406201443" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug_order" columnName="brand_name" /></not>
        </preConditions>
        <comment>Add brand_name column to drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="brand_name" type="varchar(255)" />
        </addColumn>
    </changeSet>

    <changeSet id="201406201444" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="drug_order" columnName="dispense_as_written" /></not>
        </preConditions>
        <comment>Add dispense_as_written column to drug_order table</comment>
        <addColumn tableName="drug_order">
            <column name="dispense_as_written" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false" />
            </column>
        </addColumn>
    </changeSet>
	
	<changeSet id="201402120720-TRUNK-3902" author="k-joseph">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="concept_numeric" columnName="precise"/>
		</preConditions>
		<comment>Rename concept_numeric.precise to concept_numeric.allow_decimal</comment>
		<renameColumn oldColumnName="precise" newColumnName="allow_decimal" tableName="concept_numeric"  columnDataType="BOOLEAN"/>
	</changeSet>

    <changeSet id="20140304-TRUNK-4170-duplicateLocationAttributeTypeNameChangeSet" author="harsz89">
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult = "0">
                    <![CDATA[
 					SELECT count(*) from location_attribute_type;
				]]>
                </sqlCheck>
            </not>
        </preConditions>
        <comment>Custom changeset to identify and resolve duplicate Location Attribute Type names</comment>
        <customChange class="org.openmrs.util.databasechange.DuplicateLocationAttributeTypeNameChangeSet"></customChange>
    </changeSet>

    <changeSet id="20140304-TRUNK-4170-location_attribute_type_unique_name" author="harsz89">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="location_attribute_type_unique_name" />
            </not>
        </preConditions>
        <comment>
            Adding the unique constraint to the location_attribute_type.name column
        </comment>
        <addUniqueConstraint tableName="location_attribute_type" columnNames="name" constraintName="location_attribute_type_unique_name"/>
    </changeSet>
    
    <changeSet id="20140715-TRUNK-2999-remove_concept_word" author="rkorytkowski">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="concept_word"/>
        </preConditions>
        <comment>
            Removing the concept_word table (replaced by Lucene)
        </comment>
        <dropTable tableName="concept_word"/>
    </changeSet>
    
    <changeSet id="20140718-TRUNK-2999-remove_update_concept_index_task" author="rkorytkowski">
		<comment>Deleting the update concept index task</comment>
		<delete tableName="scheduler_task_config">
			<where>schedulable_class =  'org.openmrs.scheduler.tasks.ConceptIndexUpdateTask'</where>
		</delete>
	</changeSet>

    <changeSet id="20140724-1528" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="drug_order" columnName="drug_inventory_id" />
        </preConditions>
        <comment>Dropping default value for drug_order.drug_inventory_id </comment>
        <dropDefaultValue tableName="drug_order" columnName="drug_inventory_id" columnDataType="int" />
    </changeSet>

    <changeSet id="20140801-TRUNK-4443-rename_order_start_date_to_date_activated" author="bharti">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="start_date" tableName="orders" />
        </preConditions>
        <comment>Renaming the start_date in order table to date_activated</comment>
        <renameColumn tableName="orders" newColumnName="date_activated" oldColumnName="start_date" columnDataType="datetime" />
    </changeSet>

    <changeSet id="20140719-TRUNK-4445-update_dosing_type_to_varchar_255" author="mihir">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="dosing_type" tableName="drug_order" />
        </preConditions>
        <comment>Increase size of dosing type column to 255 characters</comment>
        <modifyDataType tableName="drug_order" columnName="dosing_type" newDataType="varchar(255)" />
    </changeSet>

    <changeSet id="201408200733-TRUNK-4446" author="Deepak">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="duration" tableName="drug_order" />
        </preConditions>
        <comment>Changing duration column of drug_order to int</comment>
        <modifyDataType tableName="drug_order" columnName="duration" newDataType="int"/>
    </changeSet>

    <changeSet id="20150428-TRUNK-4693-1" author="mseaton">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="order_type_parent"/>
        </preConditions>
        <comment>Removing invalid foreign key constraint from order_type.parent column to order.order_id column</comment>
        <dropForeignKeyConstraint baseTableName="order_type" constraintName="order_type_parent"/>
    </changeSet>

    <changeSet id="20150428-TRUNK-4693-2" author="mseaton">
        <preConditions onFail="MARK_RAN">
            <not><foreignKeyConstraintExists foreignKeyName="order_type_parent_order_type"/></not>
        </preConditions>
        <comment>Adding foreign key constraint from order_type.parent column to order_type.order_type_id column</comment>
        <addForeignKeyConstraint baseTableName="order_type" baseColumnNames="parent" constraintName="order_type_parent_order_type" referencedTableName="order_type" referencedColumnNames="order_type_id"/>
    </changeSet>
    
    <changeSet id="201409230113-TRUNK-3484" author="k-joseph">
		<preConditions onFail="MARK_RAN">
                <sqlCheck expectedResult="1">
                    SELECT count(*) FROM global_property WHERE property ='visits.encounterTypeToVisitTypeMapping'
                </sqlCheck>
        </preConditions>
		<comment>
			Updating description for visits.encounterTypeToVisitTypeMapping GP to the value set in OpenmrsContants
		</comment>
		<update tableName="global_property">
			<column name="description" value="Specifies how encounter types are mapped to visit types when automatically assigning encounters to visits. e.g 1:1, 2:1, 3:2 in the format encounterTypeId:visitTypeId or encounterTypeUuid:visitTypeUuid or a combination of encounter/visit type uuids and ids e.g 1:759799ab-c9a5-435e-b671-77773ada74e4"/>
			<where>property='visits.encounterTypeToVisitTypeMapping'</where>
		</update>
	</changeSet>

	<changeSet id="drop-tribe-foreign-key-TRUNK-4492" author="dkayiwa">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="belongs_to_tribe" />
		</preConditions>
		<comment>Dropping foreign key on patient.tribe</comment>
		<dropForeignKeyConstraint baseTableName="patient" constraintName="belongs_to_tribe" />
	</changeSet>
	
    <changeSet id="20141010-trunk-4492" author="alec" >
      <preConditions onFail="MARK_RAN">
        <columnExists tableName="patient" columnName="tribe"/>
      </preConditions>
      <comment>
          Dropping the tribe field from patient table because it has been moved to person_attribute.
      </comment>
      <dropColumn tableName="patient" columnName="tribe"/>
    </changeSet>

    <changeSet id="201410291606-TRUNK-3474" author="jbuczynski">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="program"/>
            <columnExists tableName="program" columnName="description"  />
        </preConditions>
        <comment>
            Dropping not null constraint from program.description column
        </comment>
        <dropNotNullConstraint tableName="program" columnName="description" columnDataType="text" />
    </changeSet>

    <changeSet id="201410291613-TRUNK-3474" author="jbuczynski">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="order_type"/>
            <columnExists tableName="order_type" columnName="description"  />
        </preConditions>
        <comment>
            Dropping not null constraint from order_type.description column
        </comment>
        <dropNotNullConstraint tableName="order_type" columnName="description" columnDataType="text" />
    </changeSet>

    <changeSet id="201410291614-TRUNK-3474" author="jbuczynski">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="concept_name_tag"/>
            <columnExists tableName="concept_name_tag" columnName="description"  />
        </preConditions>
        <comment>
            Dropping not null constraint from concept_name_tag.description column
        </comment>
        <dropNotNullConstraint tableName="concept_name_tag" columnName="description" columnDataType="text" />
    </changeSet>

    <changeSet id="201410291616-TRUNK-3474" author="jbuczynski">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="active_list_type"/>
            <columnExists tableName="active_list_type" columnName="description"  />
        </preConditions>
        <comment>
            Dropping not null constraint from active_list_type.description column
        </comment>
        <dropNotNullConstraint tableName="active_list_type" columnName="description" columnDataType="varchar(255)" />
    </changeSet>

    <changeSet id="20141103-1030" author="wyclif">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="obs" columnName="form_namespace_and_path" />
            </not>
        </preConditions>
        <comment>Adding form_namespace_and_path column to obs table</comment>
        <addColumn tableName="obs">
            <column name="form_namespace_and_path" type="varchar(255)" />
        </addColumn>
    </changeSet>

	<changeSet id="20141121-TRUNK-2193" author="raff" >
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="drug_ingredient" columnName="quantity"/>
		</preConditions>
		<comment>Renaming drug_ingredient.quantity to strength</comment>
		<renameColumn tableName="drug_ingredient"
			oldColumnName="quantity" newColumnName="strength" columnDataType="double"/>
	</changeSet>

	<changeSet id="20150108-TRUNK-3849" author="rpuzdrowski" >
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="1">SELECT count(*) FROM global_property WHERE property = 'layout.address.format'
				AND property_value LIKE '%org.openmrs.layout.web.%'
			</sqlCheck>
		</preConditions>
		<comment>Updating layout.address.format global property</comment>
		<customChange class="org.openmrs.util.databasechange.UpdateLayoutAddressFormatChangeSet"/>
	</changeSet>

	<changeSet id="20150108-TRUNK-14" author="rpuzdrowski">
		<comment>Removing dashboard.regimen.standardRegimens global property</comment>
		<delete tableName="global_property">
			<where>property = 'dashboard.regimen.standardRegimens'</where>
		</delete>
	</changeSet>

	<changeSet id="20150211-TRUNK-3709" author="jkondrat">
		<comment>Encrypting the users.secret_answer column</comment>
		<customChange class="org.openmrs.util.databasechange.EncryptSecretAnswersChangeSet"/>
	</changeSet>

    <changeSet id="201411101055-TRUNK-3386" author="pmuchowski">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="privilege_which_can_edit" />
        </preConditions>
        <comment>Temporarily removing foreign key constraint from person_attribute_type.edit_privilege column</comment>
        <dropForeignKeyConstraint baseTableName="person_attribute_type" constraintName="privilege_which_can_edit" />
    </changeSet>

    <changeSet id="201411101056-TRUNK-3386" author="pmuchowski">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="privilege_definitions" />
        </preConditions>
        <comment>Temporarily removing foreign key constraint from role_privilege.privilege column</comment>
        <dropForeignKeyConstraint baseTableName="role_privilege" constraintName="privilege_definitions" />
    </changeSet>

    <changeSet id="201411101057-TRUNK-3386" author="pmuchowski">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="privilege" columnName="privilege"/>
        </preConditions>
        <comment>Increasing the size of the privilege column in the privilege table</comment>
        <ext:modifyColumn tableName="privilege">
            <column name="privilege" type="varchar(255)">
                <constraints nullable="false" />
            </column>
        </ext:modifyColumn>
    </changeSet>

    <changeSet id="201411101058-TRUNK-3386" author="pmuchowski">
        <preConditions onFail="MARK_RAN">
            <not><foreignKeyConstraintExists foreignKeyName="privilege_which_can_edit" /></not>
        </preConditions>
        <comment>Adding foreign key constraint to person_attribute_type.edit_privilege column</comment>
        <addForeignKeyConstraint constraintName="privilege_which_can_edit" baseTableName="person_attribute_type" baseColumnNames="edit_privilege"
                                 referencedTableName="privilege" referencedColumnNames="privilege" />
    </changeSet>

    <changeSet id="201411101106-TRUNK-3386" author="pmuchowski">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="role_privilege" columnName="privilege"/>
        </preConditions>
        <comment>Increasing the size of the privilege column in the role_privilege table</comment>
        <ext:modifyColumn tableName="role_privilege">
            <column name="privilege" type="varchar(255)">
                <constraints nullable="false" />
            </column>
        </ext:modifyColumn>
    </changeSet>

    <changeSet id="201411101107-TRUNK-3386" author="pmuchowski">
        <preConditions onFail="MARK_RAN">
            <not><foreignKeyConstraintExists foreignKeyName="privilege_definitions" /></not>
        </preConditions>
        <comment>Adding foreign key constraint to role_privilege.privilege column</comment>
        <addForeignKeyConstraint constraintName="privilege_definitions" baseTableName="role_privilege" baseColumnNames="privilege"
                                 referencedTableName="privilege" referencedColumnNames="privilege" />
    </changeSet>
    <changeSet id="20150221-1644" author="sandeepraparthi">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="patient_id" tableName="patient_identifier" />
            <not><foreignKeyConstraintExists foreignKeyName="fk_patient_id_patient_identifier"/></not>
        </preConditions>
         <comment>Adding foreign key on patient_identifier.patient_id column</comment>
        <addForeignKeyConstraint constraintName="fk_patient_id_patient_identifier" baseTableName="patient_identifier" baseColumnNames="patient_id"	referencedTableName="patient" referencedColumnNames="patient_id" /> 
 	</changeSet>

	<changeSet id="201506051103-TRUNK-4727" author="Chethan, Preethi">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="person" columnName="birthtime" /></not>
		</preConditions>
		<comment>Adding birthtime column to person</comment>

		<addColumn tableName="person">
			<column name="birthtime" type="time" />
		</addColumn>
	</changeSet>

	<changeSet id="201506192000-TRUNK-4729" author="thomasvandoren">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="encounter_type" columnName="changed_by" /></not>
		</preConditions>
		<comment>Add changed_by column to encounter_type table</comment>

		<addColumn tableName="encounter_type">
			<column name="changed_by" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="encounter_type_changed_by"
			baseTableName="encounter_type" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="201506192001-TRUNK-4729" author="thomasvandoren">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="encounter_type" columnName="date_changed" /></not>
		</preConditions>
		<comment>Add date_changed column to encounter_type table</comment>

		<addColumn tableName="encounter_type">
			<column name="date_changed" type="datetime" />
		</addColumn>
	</changeSet>

	<changeSet id="201508111304" author="sns.recommind" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="global_property_property_index"/></not></preConditions>
		<comment>Add an index to the global_property.property column</comment>
		<createIndex tableName="global_property" indexName="global_property_property_index">
			<column name="property" />
		</createIndex>
	</changeSet>

	<changeSet id="201508111412" author="sns.recommind" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_class_name_index"/></not></preConditions>
		<comment>Add an index to the concept_class.name column</comment>
		<createIndex tableName="concept_class" indexName="concept_class_name_index">
			<column name="name" />
		</createIndex>
	</changeSet>

	<changeSet id="201508111415" author="sns.recommind" dbms="mysql">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_datatype_name_index"/></not></preConditions>
		<comment>Add an index to the concept_datatype.name column</comment>
		<createIndex tableName="concept_datatype" indexName="concept_datatype_name_index">
			<column name="name" />
		</createIndex>
	</changeSet>

    <!--
        Create allergy table
    -->
    <changeSet id="RA-354-create-allergy-table-rev1" author="fbiedrzycki">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="allergy"/>
            </not>
        </preConditions>
        <comment>Create allergy table</comment>
        <createTable tableName="allergy">
            <column name="allergy_id" autoIncrement="true" type="int">
                <constraints nullable="false" unique="true"  primaryKey="true"/>
            </column>
            <column name="patient_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="severity_concept_id" type="int"/>
            <column name="coded_allergen" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="non_coded_allergen" type="varchar(255)">
            </column>
            <column name="allergen_type" type="varchar(50)">
            <constraints nullable="false"/></column>
            <column name="comment" type="varchar(1024)"></column>
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="voided" type="boolean" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"></column>
            <column name="date_voided" type="datetime"></column>
            <column name="void_reason" type="varchar(255)"></column>
            <column name="uuid" type="char(38)"></column>
        </createTable>
        <addForeignKeyConstraint baseTableName="allergy" baseColumnNames="patient_id"
                                 constraintName="allergy_patient_id_fk" referencedColumnNames="patient_id"
                                 referencedTableName="patient"/>
        <addForeignKeyConstraint baseTableName="allergy" baseColumnNames="coded_allergen"
                                 constraintName="allergy_coded_allergen_fk" referencedColumnNames="concept_id"
                                 referencedTableName="concept"/>
        <addForeignKeyConstraint baseTableName="allergy" baseColumnNames="severity_concept_id"
                                 constraintName="allergy_severity_concept_id_fk" referencedColumnNames="concept_id"
                                 referencedTableName="concept"/>
        <addForeignKeyConstraint baseTableName="allergy" baseColumnNames="creator" constraintName="allergy_creator_fk"
                                 referencedColumnNames="user_id" referencedTableName="users"/>
        <addForeignKeyConstraint baseTableName="allergy" baseColumnNames="changed_by" constraintName="allergy_changed_by_fk"
                                 referencedColumnNames="user_id" referencedTableName="users"/>
        <addForeignKeyConstraint baseTableName="allergy" baseColumnNames="voided_by"
                                 constraintName="allergy_voided_by_fk" referencedColumnNames="user_id"
                                 referencedTableName="users"/>
    </changeSet>
    
    <!--
            Create allergy_reaction table
        -->
    <changeSet id="RA-355-create-allergy-reaction-table" author="fbiedrzycki">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="allergy_reaction"/>
            </not>
            <tableExists tableName="allergy"></tableExists>
        </preConditions>
        <comment>Create allergy_reaction table</comment>
        <createTable tableName="allergy_reaction">
            <column name="allergy_reaction_id" autoIncrement="true" type="int">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="allergy_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="reaction_concept_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="reaction_non_coded" type="varchar(255)">
            </column>
            <column name="uuid" type="char(38)"></column>
        </createTable>
        <addForeignKeyConstraint baseTableName="allergy_reaction" baseColumnNames="allergy_id"
                                 constraintName="allergy_reaction_allergy_id_fk" referencedColumnNames="allergy_id"
                                 referencedTableName="allergy"/>
        <addForeignKeyConstraint baseTableName="allergy_reaction" baseColumnNames="reaction_concept_id"
                                 constraintName="allergy_reaction_reaction_concept_id_fk"
                                 referencedColumnNames="concept_id"
                                 referencedTableName="concept"/>
    </changeSet>

    <changeSet id="RA-360-Add-allergy-status-to-patient-2" author="rpuzdrowski">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="patient"></tableExists>
            <not>
                <columnExists tableName="patient" columnName="allergy_status"/>
            </not>
        </preConditions>
        <comment>Add allergy_status field to the patient table</comment>
        <addColumn tableName="patient">
            <column name="allergy_status" type="varchar(50)" defaultValue="Unknown">
            	<constraints nullable="false" />
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet id="TRUNK-4548-MigrateAllergiesChangeSet1" author="dkayiwa">
    	<preConditions onFail="MARK_RAN">
    		<not>
				<sqlCheck expectedResult="0">
					select count(*) from active_list al 
					inner join active_list_allergy ala on al.active_list_id=ala.active_list_id
					where voided = 0 and active_list_type_id = (select active_list_type_id 
					from active_list_type where name = 'Allergy')
				</sqlCheck>
			</not>
		</preConditions>
		<comment>Custom changeset to migrate allergies from old to new tables</comment>
		<customChange class="org.openmrs.util.databasechange.MigrateAllergiesChangeSet"></customChange>
	</changeSet>
   
    <changeSet id="20151007-TRUNK-4747-remove_active_list_problem" author="jdegraft">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="active_list_problem"/>
        </preConditions>
        <comment>
            Removing the active_list_problem table (active_list feature removed)
        </comment>
        <dropTable tableName="active_list_problem"/>
    </changeSet>
    
    <changeSet id="20151007-TRUNK-4747-remove_active_list_allergy" author="jdegraft">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="active_list_allergy"/>
        </preConditions>
        <comment>
            Removing the active_list_allergy table (active_list feature removed)
        </comment>
        <dropTable tableName="active_list_allergy"/>
    </changeSet>
    
    <changeSet id="20151007-TRUNK-4747-remove_active_list" author="jdegraft">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="active_list"/>
        </preConditions>
        <comment>
            Removing the active_list table (active_list feature removed)
        </comment>
        <dropTable tableName="active_list"/>
    </changeSet>
    
    <changeSet id="20151007-TRUNK-4747-remove_active_list_type" author="jdegraft">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="active_list_type"/>
        </preConditions>
        <comment>
            Removing the active_list_type table (active_list feature removed)
        </comment>
        <dropTable tableName="active_list_type"/>
    </changeSet>

	<changeSet id="201509281653" author="Sravanthi">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="drug_order" columnName="drug_non_coded" /></not>
		</preConditions>
		<comment>Add drug_non_coded column to drug_order table</comment>
		<addColumn tableName="drug_order">
			<column name="drug_non_coded" type="varchar(255)" />
		</addColumn>
	</changeSet>

    <changeSet id="20151022-TRUNK-4750" author="gwasilwa">
        <comment>
            Adding address columns (7-15) to person_address and location
        </comment>
        <addColumn tableName="person_address">
            <column name="address7" type="varchar(255)"></column>
            <column name="address8" type="varchar(255)"></column>
            <column name="address9" type="varchar(255)"></column>
            <column name="address10" type="varchar(255)"></column>
            <column name="address11" type="varchar(255)"></column>
            <column name="address12" type="varchar(255)"></column>
            <column name="address13" type="varchar(255)"></column>
            <column name="address14" type="varchar(255)"></column>
            <column name="address15" type="varchar(255)"></column>
        </addColumn>
        <addColumn tableName="location">
            <column name="address7" type="varchar(255)"></column>
            <column name="address8" type="varchar(255)"></column>
            <column name="address9" type="varchar(255)"></column>
            <column name="address10" type="varchar(255)"></column>
            <column name="address11" type="varchar(255)"></column>
            <column name="address12" type="varchar(255)"></column>
            <column name="address13" type="varchar(255)"></column>
            <column name="address14" type="varchar(255)"></column>
            <column name="address15" type="varchar(255)"></column>
        </addColumn>
    </changeSet>

	<changeSet id="20160201-TRUNK-1505" author="mnagasowmya">
		<preConditions onFail="MARK_RAN">
			<and>
				<columnExists tableName="obs" columnName="value_boolean"/>
				<sqlCheck expectedResult="0">
					select count(*) from obs where value_boolean is NOT NULL
				</sqlCheck>
			</and>
		</preConditions>
		<comment>
			Removing a column value_boolean from obs table
		</comment>
		<dropColumn columnName="value_boolean" tableName="obs"/>
	</changeSet>
	
	<changeSet id="20160216-1700" author="bahmni">
		<comment>
			Set uuid for columns in all tables which has uuid as null. This is required for successful run of next changeSet.
		</comment>
		<customChange class="org.openmrs.util.databasechange.GenerateUuid">
			<param name="tableNames">
				cohort concept concept_answer concept_class concept_datatype concept_description
				concept_name concept_name_tag concept_proposal concept_reference_map concept_reference_source
				concept_set concept_state_conversion drug encounter encounter_type field field_answer field_type form
				form_field global_property hl7_in_archive hl7_in_error hl7_in_queue hl7_source location location_tag
				note notification_alert notification_template obs order_type orders patient_identifier
				patient_identifier_type patient_program patient_state person person_address person_attribute
				person_attribute_type person_name privilege program program_workflow program_workflow_state relationship
				relationship_type report_object report_schema_xml role serialized_object
			</param>
			<param name="columnName" value="uuid"/>
			<param name="idExceptions">
				field_answer_id=field_id|role_id=role|privilege_id=privilege|global_property_id=property
				|notification_alert_id=alert_id|notification_template_id=template_id|orders_id=order_id
				|report_schema_xml_id=report_schema_id|concept_reference_map_id=concept_map_id
				|concept_reference_source_id=concept_source_id
			</param>
		</customChange>
	</changeSet>

	<changeSet id="20160202-1743" author="rkorytkowski">
		<comment>
			Set uuid columns to "NOT NULL", if not set already for 1.9.x tables
		</comment>
		<!-- clob_data_storage does not have uuid -->
		<addNotNullConstraint tableName="cohort" columnName="uuid" columnDataType="char(38)"/>
		<!-- cohort_memeber does not have uuid -->
		<addNotNullConstraint tableName="concept" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_answer" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_class" columnName="uuid" columnDataType="char(38)" />
		<!-- concept_complex does not have uuid -->
		<addNotNullConstraint tableName="concept_datatype" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_description" columnName="uuid" columnDataType="char(38)" />
		<!-- concept_map_type has not null constraint on uuid -->
		<addNotNullConstraint tableName="concept_name" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_name_tag" columnName="uuid" columnDataType="char(38)" />
		<!-- concept_name_tag_map does not have uuid -->
		<addNotNullConstraint tableName="concept_proposal" columnName="uuid" columnDataType="char(38)" />
		<!-- concept_proposal_tag_map does not have uuid -->
		<addNotNullConstraint tableName="concept_reference_map" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_reference_source" columnName="uuid" columnDataType="char(38)" />
		<!-- concept_reference_term has not null constraint on uuid -->
		<!-- concept_reference_term_map has not null constraint on uuid -->
		<addNotNullConstraint tableName="concept_set" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_state_conversion" columnName="uuid" columnDataType="char(38)" />
		<!-- concept_stop_word has not null constraint on uuid -->
		<addNotNullConstraint tableName="drug" columnName="uuid" columnDataType="char(38)" />
		<!-- drug_ingredient has not null constraint on uuid -->
		<!-- drug_order does not have uuid -->
		<!-- drug_reference_map has not null constraint on uuid -->
		<addNotNullConstraint tableName="encounter" columnName="uuid" columnDataType="char(38)" />
		<!-- encounter_provider has not null constraint on uuid -->
		<!-- encounter_role has not null constraint on uuid -->
		<addNotNullConstraint tableName="encounter_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="field" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="field_answer" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="field_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="form" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="form_field" columnName="uuid" columnDataType="char(38)" />
		<!-- form_resource has not null constraint on uuid -->
		<addNotNullConstraint tableName="global_property" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_in_archive" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_in_error" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_in_queue" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_source" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="location" columnName="uuid" columnDataType="char(38)" />
		<!-- location_attribute has not null constraint on uuid -->
		<!-- location_attribute_type has not null constraint on uuid -->
		<addNotNullConstraint tableName="location_tag" columnName="uuid" columnDataType="char(38)" />
		<!-- location_tag_map does not have uuid -->
		<addNotNullConstraint tableName="note" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="notification_alert" columnName="uuid" columnDataType="char(38)" />
		<!-- notification_alert_recipient has not null constraint on uuid -->
		<addNotNullConstraint tableName="notification_template" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="obs" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="order_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="orders" columnName="uuid" columnDataType="char(38)" />
		<!-- patient does not have uuid -->
		<addNotNullConstraint tableName="patient_identifier" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_identifier_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_program" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_state" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_address" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_attribute" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_attribute_type" columnName="uuid" columnDataType="char(38)" />
		<!-- person_merge_log has not null constraint on uuid -->
		<addNotNullConstraint tableName="person_name" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="privilege" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="program" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="program_workflow" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="program_workflow_state" columnName="uuid" columnDataType="char(38)" />
		<!-- provider has not null constraint on uuid -->
		<!-- provider_attribute has not null constraint on uuid -->
		<!-- provider_attribute_type has not null constraint on uuid -->
		<addNotNullConstraint tableName="relationship" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="relationship_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="report_object" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="report_schema_xml" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="role" columnName="uuid" columnDataType="char(38)" />
		<!-- role_privilege does not have uuid -->
		<!-- role_role does not have uuid -->
		<!-- scheduler_task_config has not null constraint on uuid -->
		<!-- scheduler_task_config_property does not have uuid -->
		<addNotNullConstraint tableName="serialized_object" columnName="uuid" columnDataType="char(38)" />
		<!-- test_order does not have uuid -->
		<!-- user_property does not have uuid -->
		<!-- user_role does not have uuid -->
		<!-- users has not null constraint on uuid -->
		<!-- visit has not null constraint on uuid -->
		<!-- visit_attribute has not null constraint on uuid -->
		<!-- visit_attribute_type has not null constraint on uuid -->
		<!-- visit_type has not null constraint on uuid -->
	</changeSet>
	
	<changeSet id="20151006-1530" author="bahmni">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="order_set" />
			</not>
		</preConditions>
		<comment>
			Create order_set table
		</comment>
		<createTable tableName="order_set">
			<column name="order_set_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="operator" type="varchar(50)">
				<constraints nullable="false"/>
			</column>
			<column name="name" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(1000)"/>
			<column name="creator" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column defaultValueBoolean="false" name="retired" type="BOOLEAN">
				<constraints nullable="false"/>
			</column>
			<column name="retired_by" type="int"/>
			<column name="date_retired" type="DATETIME"/>
			<column name="retire_reason" type="varchar(255)"/>
			<column name="changed_by" type="int"/>
			<column name="date_changed" type="DATETIME"/>
			<column name="uuid" type="char(38)">
				<constraints unique="true" nullable="false"/>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="order_set_creator_fk"
								 baseTableName="order_set" baseColumnNames="creator"
								 referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="order_set_retired_by_fk"
								 baseTableName="order_set" baseColumnNames="retired_by"
								 referencedTableName="users" referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="order_set_changed_by_fk"
								 baseTableName="order_set" baseColumnNames="changed_by"
								 referencedTableName="users" referencedColumnNames="user_id"/>
	</changeSet>
	<changeSet id="20151006-1537" author="bahmni">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="order_set_member" />
			</not>
		</preConditions>
		<comment>
			Create order_set_member table
		</comment>
		<createTable tableName="order_set_member">
			<column name="order_set_member_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="order_type" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="order_template" type="text"/>
			<column name="order_template_type" type="varchar(1024)"/>
			<column name="order_set_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="sequence_number" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="concept_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="creator" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column defaultValueBoolean="false" name="retired" type="BOOLEAN">
				<constraints nullable="false"/>
			</column>
			<column name="retired_by" type="int"/>
			<column name="date_retired" type="DATETIME"/>
			<column name="retire_reason" type="varchar(255)"/>
			<column name="changed_by" type="int"/>
			<column name="date_changed" type="DATETIME"/>
			<column name="uuid" type="char(38)">
				<constraints unique="true" nullable="false"/>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="order_set_member_creator_fk"
								 baseTableName="order_set_member" baseColumnNames="creator"
								 referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="order_set_member_order_set_id_fk"
								 baseTableName="order_set_member" baseColumnNames="order_set_id"
								 referencedTableName="order_set" referencedColumnNames="order_set_id" />
		<addForeignKeyConstraint constraintName="order_set_member_concept_id_fk"
								 baseTableName="order_set_member" baseColumnNames="concept_id"
								 referencedTableName="concept" referencedColumnNames="concept_id"/>
		<addForeignKeyConstraint constraintName="order_set_member_order_type_fk"
								 baseTableName="order_set_member" baseColumnNames="order_type"
								 referencedTableName="order_type" referencedColumnNames="order_type_id"/>
		<addForeignKeyConstraint constraintName="order_set_member_retired_by_fk"
								 baseTableName="order_set_member" baseColumnNames="retired_by"
								 referencedTableName="users" referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="order_set_member_changed_by_fk"
								 baseTableName="order_set_member" baseColumnNames="changed_by"
								 referencedTableName="users" referencedColumnNames="user_id"/>
	</changeSet>

	<changeSet id="20151118-1630" author="bahmni">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="order_group" />
			</not>
		</preConditions>
		<comment>
			Create order_group table
		</comment>
		<createTable tableName="order_group">
			<column name="order_group_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="order_set_id" type="int"/>
			<column name="patient_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="encounter_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="creator" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column name="voided" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
			<column name="voided_by" type="int"/>
			<column name="date_voided" type="DATETIME"/>
			<column name="void_reason" type="varchar(255)"/>
			<column name="changed_by" type="int"/>
			<column name="date_changed" type="DATETIME"/>
			<column name="uuid" type="char(38)">
				<constraints unique="true" nullable="false"/>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="order_group_patient_id_fk"
								 baseTableName="order_group" baseColumnNames="patient_id"
								 referencedTableName="patient" referencedColumnNames="patient_id"/>
		<addForeignKeyConstraint constraintName="order_group_encounter_id_fk"
								 baseTableName="order_group" baseColumnNames="encounter_id"
								 referencedTableName="encounter" referencedColumnNames="encounter_id"/>
		<addForeignKeyConstraint constraintName="order_group_creator_fk"
								 baseTableName="order_group" baseColumnNames="creator"
								 referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="order_group_set_id_fk"
								 baseTableName="order_group" baseColumnNames="order_set_id"
								 referencedTableName="order_set" referencedColumnNames="order_set_id" />
		<addForeignKeyConstraint constraintName="order_group_voided_by_fk"
								 baseTableName="order_group" baseColumnNames="voided_by"
								 referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="order_group_changed_by_fk"
								 baseTableName="order_group" baseColumnNames="changed_by"
								 referencedTableName="users" referencedColumnNames="user_id"/>
	</changeSet>

	<changeSet id="20151118-1640" author="bahmni">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists columnName="order_group_id" tableName="orders"/>
			</not>
		</preConditions>
		<comment>Adding 'order_group_id' column to orders table</comment>
		<addColumn tableName="orders">
			<column name="order_group_id" type="int"></column>
		</addColumn>
		<addForeignKeyConstraint constraintName="orders_order_group_id_fk"
										 baseTableName="orders" baseColumnNames="order_group_id"
										 referencedTableName="order_group" referencedColumnNames="order_group_id" />
	</changeSet>


	<changeSet id="20160212-1020" author="bahmni">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists columnName="sort_weight" tableName="orders"/>
			</not>
		</preConditions>
		<comment>Adding 'sort_weight' column to orders table</comment>
		<addColumn tableName="orders">
			<column name="sort_weight" type="double"></column>
		</addColumn>
	</changeSet>

	<changeSet id="201604281645" author="vishnuraom">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">SELECT count(*) FROM drug_order WHERE dosing_type = 'SIMPLE'</sqlCheck>
			</not>
		</preConditions>
		<comment>Converting values in drug_order.dosing_type column from SIMPLE to org.openmrs.SimpleDosingInstructions (TRUNK-4845)</comment>
		<update tableName="drug_order">
			<column name="dosing_type" value="org.openmrs.SimpleDosingInstructions" />
			<where>dosing_type = 'SIMPLE'</where>
		</update>
	</changeSet>

	<changeSet id="201604281646" author="vishnuraom">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">SELECT count(*) FROM drug_order WHERE dosing_type = 'FREE_TEXT'</sqlCheck>
			</not>
		</preConditions>
		<comment>Converting values in drug_order.dosing_type column from FREE_TEXT to org.openmrs.FreeTextDosingInstructions(TRUNK-4845)</comment>
		<update tableName="drug_order">
			<column name="dosing_type" value="org.openmrs.FreeTextDosingInstructions" />
			<where>dosing_type = 'FREE_TEXT'</where>
		</update>
	</changeSet>

	<changeSet id="20160427-0950-create-concept-attribute-type-table" author="bahmni">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="concept_attribute_type"/>
			</not>
		</preConditions>
		<comment>Creating concept_attribute_type table</comment>
		<createTable tableName="concept_attribute_type">
			<column name="concept_attribute_type_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(1024)"/>
			<column name="datatype" type="varchar(255)"/>
			<column name="datatype_config" type="text"/>
			<column name="preferred_handler" type="varchar(255)"/>
			<column name="handler_config" type="text"/>
			<column name="min_occurs" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="max_occurs" type="int"></column>
			<column name="creator" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false"/>
			</column>
			<column name="changed_by" type="int"/>
			<column name="date_changed" type="datetime"/>
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
			<column name="retired_by" type="int"/>
			<column name="date_retired" type="datetime"/>
			<column name="retire_reason" type="varchar(255)" defaultValue="null"/>
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"/>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="concept_attribute_type_creator_fk"
								 baseTableName="concept_attribute_type" baseColumnNames="creator"
								 referencedTableName="users"
								 referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="concept_attribute_type_changed_by_fk"
								 baseTableName="concept_attribute_type" baseColumnNames="changed_by"
								 referencedTableName="users"
								 referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="concept_attribute_type_retired_by_fk"
								 baseTableName="concept_attribute_type" baseColumnNames="retired_by"
								 referencedTableName="users"
								 referencedColumnNames="user_id"/>
	</changeSet>

	<changeSet id="20160427-0954-create-concept-attribute-table" author="bahmni">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="concept_attribute"/>
			</not>
		</preConditions>
		<comment>Creating concept_attribute table</comment>
		<createTable tableName="concept_attribute">
			<column name="concept_attribute_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="concept_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="attribute_type_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="value_reference" type="text">
				<constraints nullable="false"/>
			</column>
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="creator" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false"/>
			</column>
			<column name="changed_by" type="int"/>
			<column name="date_changed" type="datetime"/>
			<column name="voided" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false"/>
			</column>
			<column name="voided_by" type="int"/>
			<column name="date_voided" type="datetime"/>
			<column name="void_reason" type="varchar(255)" defaultValue="null"/>
		</createTable>
		<addForeignKeyConstraint constraintName="concept_attribute_concept_fk"
								 baseTableName="concept_attribute" baseColumnNames="concept_id"
								 referencedTableName="concept"
								 referencedColumnNames="concept_id"/>
		<addForeignKeyConstraint constraintName="concept_attribute_attribute_type_id_fk"
								 baseTableName="concept_attribute" baseColumnNames="attribute_type_id"
								 referencedTableName="concept_attribute_type"
								 referencedColumnNames="concept_attribute_type_id"/>
		<addForeignKeyConstraint constraintName="concept_attribute_creator_fk"
								 baseTableName="concept_attribute" baseColumnNames="creator" referencedTableName="users"
								 referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="concept_attribute_changed_by_fk"
								 baseTableName="concept_attribute" baseColumnNames="changed_by"
								 referencedTableName="users"
								 referencedColumnNames="user_id"/>
		<addForeignKeyConstraint constraintName="concept_attribute_voided_by_fk"
								 baseTableName="concept_attribute" baseColumnNames="voided_by"
								 referencedTableName="users"
								 referencedColumnNames="user_id"/>
	</changeSet>

    <changeSet id="TRUNK-3422-20160216-1700" author="Wyclif" >
		<validCheckSum>3:474feb8369313b4d680197f9bac6ec20</validCheckSum> <!-- old checksum -->
		<validCheckSum>3:a517d5e30d3814f5b186cbc93aa359de</validCheckSum> <!-- checksum when "View" is replaced with "Get" -->
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM privilege  WHERE privilege='Get Visits';
            </sqlCheck>
        </preConditions>
        <comment>Add "Get Visits" privilege</comment>
        <insert tableName="privilege">
            <column name="privilege" value="Get Visits" />
            <column name="description" value="Able to get visits" />
            <column name="uuid" value="4e7bdbc8-3975-11e6-899a-a4d646d86a8a" />
        </insert>
    </changeSet>

    <changeSet id="TRUNK-3422-20160216-1701" author="Wyclif" >
		<validCheckSum>3:cc913159fdb532c487941d23ac9c79c9</validCheckSum> <!-- old checksum -->
		<validCheckSum>3:e5e5b2b92bbceeb4041166cd3b86803e</validCheckSum> <!-- checksum when "View" is replaced with "Get" -->
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM privilege  WHERE privilege='Get Providers';
            </sqlCheck>
        </preConditions>
        <comment>Add "Get Providers" privilege</comment>
        <insert tableName="privilege">
            <column name="privilege" value="Get Providers" />
            <column name="description" value="Able to get Providers" />
            <column name="uuid" value="5594745c-3988-11e6-899a-a4d646d86a8a" />
        </insert>
    </changeSet>

    <changeSet id="TRUNK-3422-20160216-1702" author="Wyclif" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM privilege  WHERE privilege='Add Visits';
            </sqlCheck>
        </preConditions>
        <comment>Add "Add Visits" privilege</comment>
        <insert tableName="privilege">
            <column name="privilege" value="Add Visits" />
            <column name="description" value="Able to add visits" />
            <column name="uuid" value="65d14b28-3989-11e6-899a-a4d646d86a8a" />
        </insert>
    </changeSet>

    <changeSet id="TRUNK-3422-20160216-1703" author="PralayRamteke" >
		<validCheckSum>3:693ea38e8702b7c1afef81ceefef9844</validCheckSum> <!-- old checksum -->
		<validCheckSum>3:2188e5d96b696afc752217843a7fa697</validCheckSum> <!-- checksum when "View" is replaced with "Get" -->
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    SELECT count(*) FROM role_privilege  WHERE privilege='Get Encounters';
                </sqlCheck>
            </not>
        </preConditions>
        <comment>Add "Get Visits" privilege to the roles having "Get Encounter"</comment>
        <sql>
            INSERT INTO role_privilege (role, privilege)
            SELECT role, 'Get Visits' from role_privilege rp
            WHERE rp.privilege = 'Get Encounters'
            AND NOT EXISTS (SELECT role, privilege FROM role_privilege rp2 WHERE rp2.privilege='Get Visits'
            AND rp2.role=rp.role);
        </sql>
    </changeSet>

    <changeSet id="TRUNK-3422-20160216-1704" author="PralayRamteke" >
		<validCheckSum>3:b4caee668484f1d2759bbf3feeba2daa</validCheckSum> <!-- old checksum -->
		<validCheckSum>3:13b334dbd8fba2fea886d1c9aab40e16</validCheckSum> <!-- checksum when "View" is replaced with "Get" -->
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    SELECT count(*) FROM role_privilege  WHERE privilege='Get Encounters';
                </sqlCheck>
            </not>
        </preConditions>
        <comment>Add "Get Providers" privilege to the roles having "Get Encounter"</comment>
        <sql>
            INSERT INTO role_privilege (role, privilege)
            SELECT role, 'Get Providers' from role_privilege rp
            WHERE rp.privilege = 'Get Encounters'
            AND NOT EXISTS (SELECT role, privilege FROM role_privilege rp2 WHERE rp2.privilege='Get Providers'                  AND rp2.role=rp.role);
        </sql>
    </changeSet>

    <changeSet id="TRUNK-3422-20160216-1705" author="Wyclif" >
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    SELECT count(*) FROM role_privilege  WHERE privilege='Add Encounters';
                </sqlCheck>
            </not>
        </preConditions>
        <comment>Add "Add Visits" privilege to the roles having "Add Encounters"</comment>
        <sql>
            INSERT INTO role_privilege (role, privilege)
            SELECT role, 'Add Visits' from role_privilege rp
            WHERE rp.privilege = 'Add Encounters'
            AND NOT EXISTS (SELECT role, privilege FROM role_privilege rp2 WHERE rp2.privilege='Add Visits'                     AND rp2.role=rp.role);
        </sql>
    </changeSet>

    <changeSet id="TRUNK-3422-20160216-1706" author="Wyclif" >
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    SELECT count(*) FROM role_privilege  WHERE privilege='Edit Encounters';
                </sqlCheck>
            </not>
        </preConditions>
        <comment>Add "Add Visits" privilege to the roles having "Edit Encounters"</comment>
        <sql>
            INSERT INTO role_privilege (role, privilege)
            SELECT role, 'Add Visits' from role_privilege rp
            WHERE rp.privilege = 'Edit Encounters'
            AND NOT EXISTS (SELECT role, privilege FROM role_privilege rp2 WHERE rp2.privilege='Add Visits'                     AND rp2.role=rp.role);
        </sql>
    </changeSet>

	<changeSet id="20170707-TRUNK-5185-1" author="mogoodrich">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="concept_reference_source_uuid_id"/></not>
		</preConditions>
		<comment>Adding unique index on concept_reference_source uuid column</comment>
		<createIndex tableName="concept_reference_source" indexName="concept_reference_source_uuid_id" unique="true">
			<column name="uuid"/>
		</createIndex>
	</changeSet>

	<changeSet id="20170707-TRUNK-5185-2" author="mogoodrich">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="concept_reference_map_uuid_id"/></not>
		</preConditions>
		<comment>Adding unique index on concept_reference_map uuid column</comment>
		<createIndex tableName="concept_reference_map" indexName="concept_reference_map_uuid_id" unique="true">
			<column name="uuid"/>
		</createIndex>
	</changeSet>

</databaseChangeLog>
